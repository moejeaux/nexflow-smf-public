{"version":3,"sources":["turbopack:///[project]/edge-wrapper.js","turbopack:///[project]/src/instrumentation.ts"],"sourcesContent":["self._ENTRIES ||= {};\nconst modProm = import('MODULE');\nmodProm.catch(() => {});\nself._ENTRIES[\"middleware_instrumentation\"] = new Proxy(modProm, {\n    get(modProm, name) {\n        if (name === \"then\") {\n            return (res, rej) => modProm.then(res, rej);\n        }\n        let result = (...args) => modProm.then((mod) => (0, mod[name])(...args));\n        result.then = (res, rej) => modProm.then((mod) => mod[name]).then(res, rej);\n        return result;\n    },\n});\n","// =============================================================================\n// NEXT.JS INSTRUMENTATION\n// =============================================================================\n// This file runs once when the Next.js server starts\n// Used to:\n// 1. Validate environment configuration (fail fast in production)\n// 2. Initialize background jobs like facilitator probes\n\nexport async function register() {\n  if (process.env.NEXT_RUNTIME === 'nodejs') {\n    // Only run in Node.js runtime (not Edge)\n    \n    // 1. Run production environment validation\n    try {\n      const { runStartupValidation } = await import('@/lib/startup/validate-env');\n      runStartupValidation();\n    } catch (error) {\n      console.error('[FATAL] Startup validation failed:', error);\n      // In production, this prevents the app from starting with bad config\n      if (process.env.NODE_ENV === 'production') {\n        throw error;\n      }\n    }\n    \n    // 2. Determine if we should start probes\n    const env = process.env.NODE_ENV || 'development';\n    const enableProbes = process.env.ENABLE_FACILITATOR_PROBES === 'true';\n    const isProduction = env === 'production';\n    const isTest = env === 'test';\n    \n    // Probes only run in production when explicitly enabled\n    // Never run in local dev (next dev) or test environments\n    if (isTest) {\n      console.log('[SMF] Probes disabled: test environment');\n      return;\n    }\n    \n    if (!isProduction) {\n      console.log('[SMF] Probes disabled: not in production environment');\n      console.log(`[SMF] Current NODE_ENV: ${env}`);\n      console.log('[SMF] Probes will run in production when ENABLE_FACILITATOR_PROBES=true is set');\n      return;\n    }\n    \n    if (!enableProbes) {\n      console.log('[SMF] Probes disabled: ENABLE_FACILITATOR_PROBES not set to \"true\"');\n      console.log('[SMF] Set ENABLE_FACILITATOR_PROBES=true in Vercel environment variables to enable');\n      return;\n    }\n    \n    // Production + ENABLE_FACILITATOR_PROBES=true: Probes are now handled by Vercel Cron\n    // The old setInterval-based probes are deprecated in favor of cron-based probes\n    // Cron endpoint: /api/cron/facilitator-probes (runs every minute)\n    console.log('[SMF] ========================================');\n    console.log('[SMF] Facilitator probes are now handled by Vercel Cron');\n    console.log(`[SMF] Environment: ${env}`);\n    console.log(`[SMF] ENABLE_FACILITATOR_PROBES: ${enableProbes}`);\n    console.log('[SMF] Cron endpoint: /api/cron/facilitator-probes');\n    console.log('[SMF] Cron schedule: Every minute (* * * * *)');\n    console.log('[SMF] Probe intervals enforced in code (30s for Base, 2m for Solana)');\n    console.log('[SMF] Check /api/v1/smf/probes/status for probe status');\n    console.log('[SMF] ========================================');\n  }\n}\n"],"names":[],"mappings":"gGAAA,KAAK,QAAQ,GAAK,CAAC,EACnB,IAAM,EAAA,QAAA,OAAA,GAAA,IAAA,CAAA,IAAA,EAAA,CAAA,CAAA,QACN,EAAQ,KAAK,CAAC,KAAO,GACrB,KAAK,QAAQ,CAAC,0BAA6B,CAAG,IAAI,MAAM,EAAS,CAC7D,IAAI,CAAO,CAAE,CAAI,EACb,GAAa,QAAQ,CAAjB,EACA,MAAO,CAAC,EAAK,IAAQ,EAAQ,IAAI,CAAC,EAAK,GAE3C,IAAI,EAAS,CAAC,GAAG,IAAS,EAAQ,IAAI,CAAC,AAAC,GAAQ,CAAC,EAAG,CAAG,CAAC,EAAA,AAAK,KAAK,IAElE,OADA,EAAO,IAAI,CAAG,CAAC,EAAK,IAAQ,EAAQ,IAAI,CAAC,AAAC,GAAQ,CAAG,CAAC,EAAK,EAAE,IAAI,CAAC,EAAK,GAChE,CACX,CACJ,2BCJO,eAAe,IAuDtB"}