module.exports=[36011,e=>{"use strict";let t=(0,e.i(50377).createLogger)({component:"SecurityMonitor"}),o="false"!==process.env.SECURITY_SHADOW_MODE,r={sql_injection:"true"===process.env.SECURITY_ENFORCE_SQL_INJECTION,xss:"true"===process.env.SECURITY_ENFORCE_XSS,path_traversal:"true"===process.env.SECURITY_ENFORCE_PATH_TRAVERSAL,command_injection:"true"===process.env.SECURITY_ENFORCE_COMMAND_INJECTION,auth_bypass:"true"===process.env.SECURITY_ENFORCE_AUTH_BYPASS,suspicious_user_agent:"true"===process.env.SECURITY_ENFORCE_SUSPICIOUS_UA,suspicious_path:"true"===process.env.SECURITY_ENFORCE_SUSPICIOUS_PATH,missing_auth:!1},a=parseInt(process.env.SECURITY_VIOLATION_THRESHOLD||"10",10),n=parseInt(process.env.SECURITY_VIOLATION_WINDOW_MS||"300000",10),l=parseInt(process.env.SECURITY_MAX_BLOCKS_PER_HOUR||"100",10),s=parseInt(process.env.SECURITY_MAX_BLOCKS_PER_DAY||"1000",10),c=new Map,i=new Map,u=new Map,S=new Map,d={startTime:Date.now(),totalScanned:0,wouldHaveBlocked:0,blockedByCategory:new Map,actuallyBlocked:0,actuallyAllowed:0,threatsByCategory:new Map};function E(){return{shadowMode:o,enforcementFlags:{...r},violationThreshold:a,violationWindowMs:n,maxBlocksPerHour:l,maxBlocksPerDay:s}}function _(e){return c.get(e)||null}function w(){let e=[];return c.forEach((a,d)=>{(function(e){if(function(e){let t=i.get(e);if(!t)return!1;let o=Date.now();return o-t.windowStart>n?(t.blocked=!1,t.violations=0,t.windowStart=o,!1):t.blocked}(e))return!o||(t.info({ip:e},"IP would be blocked (violation rate limit) - SHADOW MODE"),!1);if(o)return!1;let a=u.get(e)||0,d=S.get(e)||0;if(a>=l)return t.warn({ip:e,hourCount:a},"Block cap reached for hour"),!1;if(d>=s)return t.warn({ip:e,dayCount:d},"Block cap reached for day"),!1;let E=c.get(e);if(!E)return!1;let _=Date.now()-36e5,w=E.events.filter(e=>new Date(e.timestamp).getTime()>_);return(w.length>10||w.filter(e=>"critical"===e.severity&&(r[e.category]??!1)).length>0)&&(u.set(e,a+1),S.set(e,d+1),!0)})(d)&&e.push(d)}),e}function p(){let e={};d.threatsByCategory.forEach((t,o)=>{e[o]=t});let t={};d.blockedByCategory.forEach((e,o)=>{t[o]=e});let a={};Object.keys(r).forEach(o=>{let r=e[o]||0,n=t[o]||0;a[o]={blocked:n,allowed:r-n}});let l=0,s=0,c=Date.now();return i.forEach(e=>{e.blocked&&c-e.windowStart<n&&l++,c-e.windowStart<n&&(s+=e.violations)}),{threatsByCategory:e,shadowModeStats:{enabled:o,wouldHaveBlocked:d.wouldHaveBlocked,totalScanned:d.totalScanned,blockedCategories:t},enforcementStats:{blocked:d.actuallyBlocked,allowed:d.actuallyAllowed,byCategory:a},violationRateLimiting:{ipsRateLimited:l,violationsInWindow:s},since:new Date(d.startTime).toISOString()}}setInterval(()=>{u.clear()},36e5),setInterval(()=>{S.clear()},864e5),setInterval(()=>{let e=Date.now(),t=[];c.forEach((o,r)=>{e-o.lastSeen>864e5&&t.push(r)}),t.forEach(e=>c.delete(e))},6e5),setInterval(()=>{let e=Date.now(),t=[];i.forEach((o,r)=>{e-o.windowStart>2*n&&t.push(r)}),t.forEach(e=>i.delete(e))},6e5),e.s(["getBlockedIps",()=>w,"getSecurityConfig",()=>E,"getSecurityMetrics",()=>p,"getThreatHistory",()=>_])}];

//# sourceMappingURL=src_lib_security-monitor_ts_45724728._.js.map