module.exports=[5767,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(91938),e=a.i(41710),f=a.i(96221),g=a.i(92e3),h=a.i(73570),i=a.i(16201),j=a.i(62722),k=a.i(69520),l=a.i(25015);let m=(0,a.i(70106).default)("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);var n=a.i(90669),o=a.i(1027),p=a.i(41675),q=a.i(5784),r=a.i(67552);function s(){let[a,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!0),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(!0),F=(0,c.useCallback)(async()=>{try{w(null);let a=await d.cronJobsApi.list({includeRuns:!0,limit:100});s(a),C(new Date)}catch(a){a instanceof d.ApiError?w(401===a.status?"Please log in to view scheduled jobs.":403===a.status?"Access denied. Admin access may be required.":`${a.message} (Status: ${a.status})`):a instanceof Error?w(`Failed to load data: ${a.message}`):w("Failed to load data: Unknown error")}finally{u(!1)}},[]);(0,c.useEffect)(()=>{F()},[F]),(0,c.useEffect)(()=>{if(!D)return;let a=setInterval(F,3e4);return()=>clearInterval(a)},[D,F]);let G=async a=>{A(a);try{await d.cronJobsApi.trigger(a),setTimeout(F,2e3)}catch(a){a instanceof d.ApiError&&alert(`Failed to trigger job: ${a.message}`)}finally{A(null)}},H=a=>{switch(a){case"completed":return"text-green-400 bg-green-900/20 border-green-700";case"running":return"text-blue-400 bg-blue-900/20 border-blue-700";case"pending":return"text-yellow-400 bg-yellow-900/20 border-yellow-700";case"failed":case"timeout":return"text-red-400 bg-red-900/20 border-red-700";default:return"text-gray-400 bg-gray-900/20 border-gray-700"}},I=a=>{switch(a){case"completed":return(0,b.jsx)(i.CheckCircle,{className:"w-4 h-4"});case"running":return(0,b.jsx)(f.Loader2,{className:"w-4 h-4 animate-spin"});case"pending":return(0,b.jsx)(e.Clock,{className:"w-4 h-4"});case"failed":case"timeout":return(0,b.jsx)(j.XCircle,{className:"w-4 h-4"});default:return(0,b.jsx)(n.Activity,{className:"w-4 h-4"})}},J=a=>null==a?"-":a<1e3?`${a}ms`:a<6e4?`${(a/1e3).toFixed(1)}s`:`${Math.round(a/6e4)}m ${Math.round(a%6e4/1e3)}s`,K=a=>{if(!a)return"Never";let b=new Date(a),c=Math.floor((new Date().getTime()-b.getTime())/6e4),d=Math.floor(c/60),e=Math.floor(d/24);return c<1?"Just now":c<60?`${c}m ago`:d<24?`${d}h ago`:`${e}d ago`};return t&&!a?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(f.Loader2,{className:"w-8 h-8 animate-spin mx-auto text-lime-400"}),(0,b.jsx)("p",{className:"mt-4 text-gray-400",children:"Loading scheduled jobs..."})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[(0,b.jsx)(p.Calendar,{className:"w-8 h-8 text-lime-400"}),"Scheduled Jobs"]}),(0,b.jsx)("p",{className:"text-gray-400 mt-1",children:"Monitor and manage cron jobs across the system"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-400",children:[(0,b.jsx)("input",{type:"checkbox",checked:D,onChange:a=>E(a.target.checked),className:"rounded border-gray-600 bg-gray-800 text-lime-400 focus:ring-lime-400"}),"Auto-refresh"]}),(0,b.jsxs)("button",{onClick:F,disabled:t,className:"flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50",children:[(0,b.jsx)(k.RefreshCw,{className:`w-4 h-4 ${t?"animate-spin":""}`}),"Refresh"]})]})]}),B&&(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Last updated: ",B.toLocaleTimeString()]}),v&&(0,b.jsxs)("div",{className:"p-4 bg-red-900/20 border border-red-800 rounded-lg flex items-center gap-3",children:[(0,b.jsx)(g.AlertCircle,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),(0,b.jsx)("span",{className:"text-red-400",children:v})]}),a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[(0,b.jsx)(n.Activity,{className:"w-4 h-4"}),"Total Jobs"]}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:a.summary.totalJobs})]}),(0,b.jsxs)("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[(0,b.jsx)(o.Zap,{className:"w-4 h-4 text-green-400"}),"Active"]}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-400",children:a.summary.activeJobs})]}),(0,b.jsxs)("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[(0,b.jsx)(f.Loader2,{className:"w-4 h-4 text-blue-400"}),"Running Now"]}),(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-400",children:a.summary.runningJobs})]}),(0,b.jsxs)("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[(0,b.jsx)(h.AlertTriangle,{className:"w-4 h-4 text-red-400"}),"Failing"]}),(0,b.jsx)("p",{className:"text-2xl font-bold text-red-400",children:a.summary.recentlyFailed})]})]}),a.summary.recentlyFailed>0&&(0,b.jsxs)("div",{className:"bg-red-900/20 border border-red-800 rounded-lg p-4",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold text-red-400 flex items-center gap-2 mb-3",children:[(0,b.jsx)(h.AlertTriangle,{className:"w-5 h-5"}),"Jobs Requiring Attention"]}),(0,b.jsx)("div",{className:"space-y-2",children:a.jobs.filter(a=>a.consecutiveFailures>0).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between bg-gray-900/50 rounded-lg p-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:a.displayName}),(0,b.jsxs)("span",{className:"text-gray-400 ml-2",children:["(",a.jobId,")"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("span",{className:"text-red-400",children:[a.consecutiveFailures," consecutive failures"]}),a.lastFailureAt&&(0,b.jsxs)("span",{className:"text-gray-500 text-sm",children:["Last failed: ",K(a.lastFailureAt)]})]})]},a.jobId))})]}),(0,b.jsxs)("div",{className:"bg-gray-900 rounded-lg border border-gray-800 overflow-hidden",children:[(0,b.jsx)("div",{className:"px-6 py-4 border-b border-gray-800",children:(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"All Scheduled Jobs"})}),(0,b.jsx)("div",{className:"divide-y divide-gray-800",children:0===a.jobs.length?(0,b.jsxs)("div",{className:"px-6 py-12 text-center text-gray-400",children:[(0,b.jsx)(e.Clock,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{children:"No scheduled jobs configured"})]}):a.jobs.map(c=>{let d=c.consecutiveFailures>=3?"critical":c.consecutiveFailures>0?"warning":c.enabled?null===c.stats.successRate?"unknown":c.stats.successRate>=.95?"healthy":c.stats.successRate>=.8?"warning":"critical":"disabled",g=x===c.jobId,k=a.recentRuns?.filter(a=>a.jobId===c.jobId)||[];return(0,b.jsxs)("div",{className:"bg-gray-900",children:[(0,b.jsx)("div",{className:"px-6 py-4 hover:bg-gray-800/50 cursor-pointer transition-colors",onClick:()=>y(g?null:c.jobId),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:`${(a=>{switch(a){case"healthy":return"text-green-400";case"warning":return"text-yellow-400";case"critical":return"text-red-400";case"disabled":return"text-gray-500";default:return"text-gray-400"}})(d)}`,children:"critical"===d?(0,b.jsx)(j.XCircle,{className:"w-5 h-5"}):"warning"===d?(0,b.jsx)(h.AlertTriangle,{className:"w-5 h-5"}):"disabled"===d?(0,b.jsx)(e.Clock,{className:"w-5 h-5 opacity-50"}):(0,b.jsx)(i.CheckCircle,{className:"w-5 h-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"font-medium flex items-center gap-2",children:[c.displayName,!c.enabled&&(0,b.jsx)("span",{className:"text-xs bg-gray-700 text-gray-400 px-2 py-0.5 rounded",children:"Disabled"})]}),(0,b.jsx)("p",{className:"text-sm text-gray-400",children:c.description||c.jobId})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsxs)("div",{className:"hidden md:flex items-center gap-6 text-sm",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-gray-500",children:"Success Rate"}),(0,b.jsx)("p",{className:`font-medium ${null===c.stats.successRate?"text-gray-400":c.stats.successRate>=.95?"text-green-400":c.stats.successRate>=.8?"text-yellow-400":"text-red-400"}`,children:null!==c.stats.successRate?`${(100*c.stats.successRate).toFixed(0)}%`:"-"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-gray-500",children:"Avg Duration"}),(0,b.jsx)("p",{className:"font-medium",children:J(c.stats.avgDurationMs)})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-gray-500",children:"Last Run"}),(0,b.jsx)("p",{className:"font-medium",children:c.lastRun?K(c.lastRun.startedAt):"Never"})]})]}),c.lastRun&&(0,b.jsxs)("div",{className:`px-3 py-1 rounded-full text-xs flex items-center gap-1 border ${H(c.lastRun.status)}`,children:[I(c.lastRun.status),c.lastRun.status]}),(0,b.jsxs)("button",{onClick:a=>{a.stopPropagation(),G(c.jobId)},disabled:z===c.jobId,className:"flex items-center gap-1 px-3 py-1.5 bg-lime-600 hover:bg-lime-500 text-black text-sm font-medium rounded-lg transition-colors disabled:opacity-50",children:[z===c.jobId?(0,b.jsx)(f.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(l.Play,{className:"w-4 h-4"}),"Run"]}),g?(0,b.jsx)(r.ChevronUp,{className:"w-5 h-5 text-gray-400"}):(0,b.jsx)(q.ChevronDown,{className:"w-5 h-5 text-gray-400"})]})]})}),g&&(0,b.jsxs)("div",{className:"px-6 py-4 bg-gray-800/30 border-t border-gray-800",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-gray-400 mb-3",children:"Configuration"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Schedule"}),(0,b.jsx)("code",{className:"text-lime-400 bg-gray-800 px-2 py-0.5 rounded",children:c.schedule||"Not set"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Timeout"}),(0,b.jsx)("span",{children:J(c.timeoutMs)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Max Retries"}),(0,b.jsx)("span",{children:c.maxRetries})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Alert on Failure"}),(0,b.jsx)("span",{children:c.alertOnFailure?"Yes":"No"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Last Success"}),(0,b.jsx)("span",{children:K(c.lastSuccessAt)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-500",children:"Last Failure"}),(0,b.jsx)("span",{className:c.lastFailureAt?"text-red-400":"",children:K(c.lastFailureAt)})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"text-sm font-medium text-gray-400 mb-3",children:["Recent Runs (",k.length,")"]}),0===k.length?(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"No runs recorded yet"}):(0,b.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:k.slice(0,10).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm bg-gray-800/50 rounded p-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:`flex items-center gap-1 ${H(a.status)} px-2 py-0.5 rounded text-xs`,children:[I(a.status),a.status]}),(0,b.jsx)("span",{className:"text-gray-500 text-xs",children:a.triggerSource})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"text-gray-400",children:J(a.durationMs)}),(0,b.jsx)("span",{className:"text-gray-500 text-xs",children:K(a.startedAt)})]})]},a.id))})]})]}),c.lastRun?.errorMessage&&(0,b.jsxs)("div",{className:"mt-4 p-3 bg-red-900/20 border border-red-800 rounded text-sm",children:[(0,b.jsx)("p",{className:"text-red-400 font-medium mb-1",children:"Last Error:"}),(0,b.jsx)("code",{className:"text-red-300 text-xs break-all",children:c.lastRun.errorMessage})]})]})]},c.jobId)})})]}),a.recentRuns&&a.recentRuns.length>0&&(0,b.jsxs)("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,b.jsx)(m,{className:"w-5 h-5"}),"Recent Activity (Last 50 Runs)"]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,b.jsx)("th",{className:"text-left py-2 text-gray-400",children:"Job"}),(0,b.jsx)("th",{className:"text-left py-2 text-gray-400",children:"Status"}),(0,b.jsx)("th",{className:"text-left py-2 text-gray-400",children:"Trigger"}),(0,b.jsx)("th",{className:"text-left py-2 text-gray-400",children:"Duration"}),(0,b.jsx)("th",{className:"text-left py-2 text-gray-400",children:"Started"}),(0,b.jsx)("th",{className:"text-left py-2 text-gray-400",children:"Error"})]})}),(0,b.jsx)("tbody",{children:a.recentRuns.slice(0,20).map(c=>{var d;let e=a.jobs.find(a=>a.jobId===c.jobId);return(0,b.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,b.jsx)("td",{className:"py-2",children:(0,b.jsx)("span",{className:"font-medium",children:e?.displayName||c.jobId})}),(0,b.jsx)("td",{className:"py-2",children:(0,b.jsxs)("span",{className:`flex items-center gap-1 w-fit px-2 py-0.5 rounded text-xs ${H(c.status)}`,children:[I(c.status),c.status]})}),(0,b.jsx)("td",{className:"py-2 text-gray-400",children:c.triggerSource}),(0,b.jsx)("td",{className:"py-2",children:J(c.durationMs)}),(0,b.jsx)("td",{className:"py-2 text-gray-400",children:(d=c.startedAt)?new Date(d).toLocaleString():"-"}),(0,b.jsx)("td",{className:"py-2",children:c.errorMessage?(0,b.jsxs)("span",{className:"text-red-400 truncate max-w-xs block",title:c.errorMessage,children:[c.errorMessage.substring(0,50),"..."]}):(0,b.jsx)("span",{className:"text-gray-500",children:"-"})})]},c.id)})})]})})]})]})]})}a.s(["default",()=>s],5767)}];

//# sourceMappingURL=src_app_dashboard_cron-jobs_page_tsx_8f08732b._.js.map