module.exports=[75297,e=>e.a(async(t,a)=>{try{var r=e.i(24924),n=t([r]);function o(e){return e&&("pool"in e||"function"==typeof e?.pool?.query)}async function s(e){let t=(0,r.getDb)();if(o(t)){let a=await t.pool.query("SELECT key, value, updated_at, updated_by FROM governance_config WHERE key = $1",[e]);if(0===a.rows.length)return null;let r=a.rows[0];return{key:r.key,value:JSON.parse(r.value),updated_at:new Date(r.updated_at),updated_by:r.updated_by}}let a=await t.query("SELECT key, value, updated_at, updated_by FROM governance_config WHERE key = ?",[e]);if(0===a.rows.length)return null;let n=a.rows[0];return{key:n.key,value:JSON.parse(n.value),updated_at:new Date(n.updated_at),updated_by:n.updated_by}}async function i(){let e=(0,r.getDb)();return o(e)?(await e.pool.query("SELECT key, value, updated_at, updated_by FROM governance_config ORDER BY key")).rows.map(e=>({key:e.key,value:JSON.parse(e.value),updated_at:new Date(e.updated_at),updated_by:e.updated_by})):(await e.query("SELECT key, value, updated_at, updated_by FROM governance_config ORDER BY key")).rows.map(e=>({key:e.key,value:JSON.parse(e.value),updated_at:new Date(e.updated_at),updated_by:e.updated_by}))}async function l(e,t,a){let n=(0,r.getDb)(),s=new Date().toISOString(),i=JSON.stringify(t);o(n)?await n.pool.query(`INSERT INTO governance_config (key, value, updated_at, updated_by)
       VALUES ($1, $2, $3, $4)
       ON CONFLICT (key) DO UPDATE SET value = $2, updated_at = $3, updated_by = $4`,[e,i,s,a]):await n.exec(`INSERT OR REPLACE INTO governance_config (key, value, updated_at, updated_by)
     VALUES (?, ?, ?, ?)`,[e,i,s,a])}async function d(){let t=await i(),a=new Map(t.map(e=>[e.key,e.value])),{DEFAULT_GOVERNANCE_CONFIG:r}=await e.A(30742);return{platform_fee_percentage:a.get("platform_fee_percentage")??r.platform_fee_percentage,min_fee_wei:a.get("min_fee_wei")??r.min_fee_wei,max_fee_percentage:a.get("max_fee_percentage")??r.max_fee_percentage,anomaly_thresholds:a.get("anomaly_thresholds")??r.anomaly_thresholds,load_thresholds:a.get("load_thresholds")??r.load_thresholds,circuit_breaker:a.get("circuit_breaker")??r.circuit_breaker,batch_max_size:a.get("batch_max_size")??r.batch_max_size,batch_min_size:a.get("batch_min_size")??r.batch_min_size,batch_timeout_minutes:a.get("batch_timeout_minutes")??r.batch_timeout_minutes,default_canary_share:a.get("default_canary_share")??r.default_canary_share,max_canary_share:a.get("max_canary_share")??r.max_canary_share,promotion_success_threshold:a.get("promotion_success_threshold")??r.promotion_success_threshold}}async function c(e){let t=(0,r.getDb)(),a=crypto.randomUUID(),n=new Date().toISOString(),s=JSON.stringify(e.old_value),i=JSON.stringify(e.new_value),l=e.ready_at.toISOString();return o(t)?await t.pool.query(`INSERT INTO governance_proposals 
       (id, key, old_value, new_value, status, created_by, created_at, ready_at)
       VALUES ($1, $2, $3, $4, 'pending', $5, $6, $7)`,[a,e.key,s,i,e.created_by,n,l]):await t.exec(`INSERT INTO governance_proposals 
       (id, key, old_value, new_value, status, created_by, created_at, ready_at)
       VALUES (?, ?, ?, ?, 'pending', ?, ?, ?)`,[a,e.key,s,i,e.created_by,n,l]),{id:a,key:e.key,old_value:e.old_value,new_value:e.new_value,status:"pending",created_by:e.created_by,created_at:new Date(n),ready_at:e.ready_at,applied_at:null}}async function u(e){let t,a=(0,r.getDb)();if(o(a)){let r=await a.pool.query("SELECT * FROM governance_proposals WHERE id = $1",[e]);if(0===r.rows.length)return null;t=r.rows[0]}else{let r=await a.query("SELECT * FROM governance_proposals WHERE id = ?",[e]);if(0===r.rows.length)return null;t=r.rows[0]}return{id:t.id,key:t.key,old_value:t.old_value?JSON.parse(t.old_value):null,new_value:JSON.parse(t.new_value),status:t.status,created_by:t.created_by,created_at:new Date(t.created_at),ready_at:new Date(t.ready_at),applied_at:t.applied_at?new Date(t.applied_at):null,rejection_reason:t.rejection_reason}}async function p(){let e=(0,r.getDb)();return(o(e)?(await e.pool.query("SELECT * FROM governance_proposals WHERE status = 'pending' ORDER BY ready_at ASC")).rows:(await e.query("SELECT * FROM governance_proposals WHERE status = 'pending' ORDER BY ready_at ASC")).rows).map(e=>({id:e.id,key:e.key,old_value:e.old_value?JSON.parse(e.old_value):null,new_value:JSON.parse(e.new_value),status:e.status,created_by:e.created_by,created_at:new Date(e.created_at),ready_at:new Date(e.ready_at),applied_at:e.applied_at?new Date(e.applied_at):null,rejection_reason:e.rejection_reason}))}async function _(e){let t=(0,r.getDb)(),{status:a,key:n,limit:s=100,offset:i=0}=e||{},l=[],d=[],c=1;a&&(l.push(o(t)?`status = $${c++}`:"status = ?"),d.push(a)),n&&(l.push(o(t)?`key = $${c++}`:"key = ?"),d.push(n));let u=l.length>0?`WHERE ${l.join(" AND ")}`:"";return(o(t)?(await t.pool.query(`SELECT * FROM governance_proposals ${u} 
       ORDER BY created_at DESC LIMIT $${c++} OFFSET $${c++}`,[...d,s,i])).rows:(await t.query(`SELECT * FROM governance_proposals ${u} 
       ORDER BY created_at DESC LIMIT ? OFFSET ?`,[...d,s,i])).rows).map(e=>({id:e.id,key:e.key,old_value:e.old_value?JSON.parse(e.old_value):null,new_value:JSON.parse(e.new_value),status:e.status,created_by:e.created_by,created_at:new Date(e.created_at),ready_at:new Date(e.ready_at),applied_at:e.applied_at?new Date(e.applied_at):null,rejection_reason:e.rejection_reason}))}async function g(){let e=(0,r.getDb)(),t=new Date().toISOString();return(o(e)?(await e.pool.query(`SELECT * FROM governance_proposals 
       WHERE status = 'pending' AND ready_at <= $1 
       ORDER BY ready_at ASC`,[t])).rows:(await e.query(`SELECT * FROM governance_proposals 
       WHERE status = 'pending' AND ready_at <= ? 
       ORDER BY ready_at ASC`,[t])).rows).map(e=>({id:e.id,key:e.key,old_value:e.old_value?JSON.parse(e.old_value):null,new_value:JSON.parse(e.new_value),status:e.status,created_by:e.created_by,created_at:new Date(e.created_at),ready_at:new Date(e.ready_at),applied_at:e.applied_at?new Date(e.applied_at):null,rejection_reason:e.rejection_reason}))}async function f(e,t){let a=(0,r.getDb)(),n=t.toISOString();o(a)?await a.pool.query("UPDATE governance_proposals SET status = 'applied', applied_at = $2 WHERE id = $1",[e,n]):await a.exec("UPDATE governance_proposals SET status = 'applied', applied_at = ? WHERE id = ?",[n,e])}async function h(e,t){let a=(0,r.getDb)();o(a)?await a.pool.query("UPDATE governance_proposals SET status = 'rejected', rejection_reason = $2 WHERE id = $1",[e,t||null]):await a.exec("UPDATE governance_proposals SET status = 'rejected', rejection_reason = ? WHERE id = ?",[t||null,e])}async function y(){let e,t=(0,r.getDb)();e=o(t)?(await t.pool.query("SELECT status, COUNT(*) as count FROM governance_proposals GROUP BY status")).rows:(await t.query("SELECT status, COUNT(*) as count FROM governance_proposals GROUP BY status")).rows;let a={draft:0,pending:0,applied:0,rejected:0};for(let t of e)a[t.status]=parseInt(t.count,10);return a}[r]=n.then?(await n)():n,e.s(["countProposalsByStatus",()=>y,"createProposal",()=>c,"getConfigValue",()=>s,"getFullConfig",()=>d,"getProposalById",()=>u,"listDueProposals",()=>g,"listPendingProposals",()=>p,"listProposals",()=>_,"markProposalApplied",()=>f,"markProposalRejected",()=>h,"setConfigValue",()=>l]),a()}catch(e){a(e)}},!1),57941,e=>e.a(async(t,a)=>{try{var r=e.i(50377),n=e.i(75297),o=e.i(44094),s=t([n]);[n]=s.then?(await s)():s;let l=(0,r.createLogger)({component:"GovernanceConfigService"});class d{configCache=null;configCacheTime=0;changeListeners=[];constructor(){}async getConfig(){if(this.configCache&&Date.now()-this.configCacheTime<3e5)return this.configCache;try{return this.configCache=await (0,n.getFullConfig)(),this.configCacheTime=Date.now(),this.configCache}catch(e){return l.warn({error:e},"Failed to load config from DB, using defaults"),o.DEFAULT_GOVERNANCE_CONFIG}}async getConfigValue(e){return(await this.getConfig())[e]}async getNestedValue(e){let t=await this.getConfig(),a=e.split("."),r=t;for(let e of a){if(null==r)return;r=r[e]}return r}clearCache(){this.configCache=null,this.configCacheTime=0}async proposeChange(e){let{key:t,new_value:a,created_by:r,timelock_hours:s=o.DEFAULT_TIMELOCK_HOURS}=e;if(!(0,o.isValidConfigKey)(t))throw Error(`Invalid configuration key: ${t}. Valid keys: ${this.getValidKeys().join(", ")}`);let i=await this.getNestedValue(t),d=new Date(Date.now()+60*s*6e4),c=await (0,n.createProposal)({key:t,old_value:i,new_value:a,created_by:r,ready_at:d});return l.info({proposal_id:c.id,key:t,old_value:i,new_value:a,ready_at:d.toISOString(),created_by:r},"Governance proposal created"),c}async getProposal(e){return(0,n.getProposalById)(e)}async listProposals(e){return(0,n.listProposals)(e)}async listPending(){return(0,n.listPendingProposals)()}async getProposalStats(){return(0,n.countProposalsByStatus)()}async rejectProposal(e,t){let a=await (0,n.getProposalById)(e);if(!a)throw Error(`Proposal not found: ${e}`);if("pending"!==a.status)throw Error(`Cannot reject proposal with status: ${a.status}`);await (0,n.markProposalRejected)(e,t),l.info({proposal_id:e,key:a.key,reason:t},"Governance proposal rejected")}async applyDueProposals(){let e=await (0,n.listDueProposals)(),t={applied:[],failed:[]};if(0===e.length)return l.debug("No due proposals to apply"),t;for(let a of(l.info({count:e.length},"Applying due governance proposals"),e))try{await this.applyProposal(a),t.applied.push(a)}catch(r){let e=r instanceof Error?r.message:String(r);l.error({proposal_id:a.id,key:a.key,error:e},"Failed to apply governance proposal"),t.failed.push({proposal:a,error:e})}return l.info({applied:t.applied.length,failed:t.failed.length},"Finished applying governance proposals"),t}async forceApplyProposal(e){let t=await (0,n.getProposalById)(e);if(!t)throw Error(`Proposal not found: ${e}`);if("pending"!==t.status)throw Error(`Cannot apply proposal with status: ${t.status}`);await this.applyProposal(t),l.warn({proposal_id:e,key:t.key},"Governance proposal force-applied (timelock bypassed)")}async applyProposal(e){let{id:t,key:a,new_value:r,created_by:o}=e;await this.applyConfigChange(a,r,o),await (0,n.markProposalApplied)(t,new Date),this.clearCache(),this.notifyListeners(a,e.old_value,r),l.info({proposal_id:t,key:a,new_value:r},"Governance proposal applied"),"platform_fee_percentage"===a&&l.warn({key:a,new_value:r},"Platform fee changed - ON-CHAIN UPDATE REQUIRED. Use contract-admin to update AtomicBatchSettlement.")}async applyConfigChange(e,t,a){let r=e.split(".");if(1===r.length)await (0,n.setConfigValue)(e,t,a);else{let e=r[0],s=r.slice(1),i=await (0,n.getConfigValue)(e),l=i?.value??o.DEFAULT_GOVERNANCE_CONFIG[e]??{},d=this.setNestedValue({...l},s,t);await (0,n.setConfigValue)(e,d,a)}}setNestedValue(e,t,a){if(0===t.length)return a;let[r,...n]=t;return 0===n.length?e[r]=a:(e[r]&&"object"==typeof e[r]||(e[r]={}),this.setNestedValue(e[r],n,a)),e}onConfigChange(e){this.changeListeners.push(e)}notifyListeners(e,t,a){for(let r of this.changeListeners)try{r(e,t,a)}catch(t){l.error({error:t,key:e},"Config change listener failed")}}getValidKeys(){let{VALID_CONFIG_KEYS:t}=e.r(44094);return[...t]}validateValue(e,t){switch(e){case"platform_fee_percentage":case"max_fee_percentage":if("number"!=typeof t||t<0||t>1e4)return{valid:!1,error:"Fee must be a number between 0 and 10000 basis points"};break;case"min_fee_wei":if("string"!=typeof t||!/^\d+$/.test(t))return{valid:!1,error:"min_fee_wei must be a numeric string"};break;case"batch_max_size":case"batch_min_size":case"batch_timeout_minutes":if("number"!=typeof t||t<1)return{valid:!1,error:"Must be a positive integer"};break;case"default_canary_share":case"max_canary_share":case"promotion_success_threshold":if("number"!=typeof t||t<0||t>1)return{valid:!1,error:"Must be a number between 0 and 1"};break;default:if((e.startsWith("anomaly_thresholds.")||e.startsWith("load_thresholds.")||e.startsWith("circuit_breaker."))&&"number"!=typeof t)return{valid:!1,error:"Threshold values must be numbers"}}return{valid:!0}}}let c=null;function i(){return c||(c=new d),c}e.s(["getGovernanceConfigService",()=>i]),a()}catch(e){a(e)}},!1),98250,e=>{"use strict";var t=e.i(50377),a=e.i(97739),r=e.i(88391),n=e.i(57264),o=e.i(54735),s=e.i(87349),i=e.i(92687);let l=(0,e.i(64572).defineChain)({...i.chainConfig,id:84532,network:"base-sepolia",name:"Base Sepolia",nativeCurrency:{name:"Sepolia Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://sepolia.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://sepolia.basescan.org",apiUrl:"https://api-sepolia.basescan.org/api"}},contracts:{...i.chainConfig.contracts,disputeGameFactory:{0xaa36a7:{address:"0xd6E6dBf4F7EA0ac412fD8b65ED297e64BB7a06E1"}},l2OutputOracle:{0xaa36a7:{address:"0x84457ca9D0163FbC4bbfe4Dfbb20ba46e48DF254"}},portal:{0xaa36a7:{address:"0x49f53e41452c74589e85ca1677426ba426459e85",blockCreated:4446677}},l1StandardBridge:{0xaa36a7:{address:"0xfd0Bf71F60660E2f608ed56e1659C450eB113120",blockCreated:4446677}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:1059647}},testnet:!0,sourceId:0xaa36a7});({...l,experimental_preconfirmationTime:200,rpcUrls:{default:{http:["https://sepolia-preconf.base.org"]}}});let d=(0,t.createLogger)({component:"ContractAdmin"}),c=(0,o.parseAbi)(["function platformFeePercentage() view returns (uint256)","function admin() view returns (address)","function proposeFeeUpdate(uint256 newFee)","function executeFeeUpdate()"]);class u{contractAddress;chainId;constructor(e,t){const a=e||process.env.ATOMIC_BATCH_SETTLEMENT_ADDRESS||"";this.contractAddress=a&&a.startsWith("0x")?a:null,this.chainId=t||process.env.DEFAULT_CHAIN_ID||"base:mainnet"}async getCurrentFeePercentage(){if(!this.contractAddress)return d.warn("Contract address not configured, returning default fee"),25;try{let e=this.getClient();if(!e)return 25;let t=await e.readContract({address:this.contractAddress,abi:c,functionName:"platformFeePercentage"});return Number(t)}catch(e){return d.error({error:e},"Failed to get current fee from contract"),25}}async prepareFeeUpdate(e){let t=await this.getCurrentFeePercentage();if(e<0||e>1e4)throw Error("Fee must be between 0 and 10000 basis points");let a=(0,n.encodeFunctionData)({abi:c,functionName:"proposeFeeUpdate",args:[BigInt(e)]}),r=(0,n.encodeFunctionData)({abi:c,functionName:"executeFeeUpdate"});return d.info({current_fee:t,new_fee:e,contract:this.contractAddress},"Fee update prepared"),{type:"fee_update",current_value:t,new_value:e,requires_multisig:!0,instructions:`
ON-CHAIN FEE UPDATE REQUIRED
=============================

Contract: ${this.contractAddress||"NOT CONFIGURED"}
Chain: ${this.chainId}
Current Fee: ${t} basis points (${t/100}%)
New Fee: ${e} basis points (${e/100}%)

Steps:
1. Call proposeFeeUpdate(${e}) on the contract
   TX Data: ${a}

2. Wait for the timelock period (typically 24-48 hours)

3. Call executeFeeUpdate() to finalize
   TX Data: ${r}

Use your multisig wallet (e.g., Gnosis Safe) to execute these transactions.
`.trim()}}logFeeUpdateRequired(e,t){d.warn({new_fee:e,proposal_id:t,contract:this.contractAddress,chain:this.chainId},"ON-CHAIN ACTION REQUIRED: Platform fee update must be applied to AtomicBatchSettlement contract")}async getStatus(){let e=await this.getCurrentFeePercentage(),t=await this.getAdminAddress();return{contract_address:this.contractAddress||"",chain_id:this.chainId,current_fee_percentage:e,admin_address:t,pending_updates:[]}}async getAdminAddress(){if(!this.contractAddress)return"";try{let e=this.getClient();if(!e)return"";return await e.readContract({address:this.contractAddress,abi:c,functionName:"admin"})}catch(e){return d.debug({error:e},"Failed to get admin address (may not be available)"),process.env.ADMIN_MULTISIG_ADDRESS||""}}getClient(){let e=this.getRpcUrl(),t=this.chainId.includes("sepolia")?l:s.base;try{return(0,a.createPublicClient)({chain:t,transport:e?(0,r.http)(e):(0,r.http)()})}catch(e){return d.debug({error:e},"Failed to create client"),null}}getRpcUrl(){let e=`${this.chainId.replace(":","_").toUpperCase()}_RPC_URL`,t=process.env[e]||process.env.RPC_URL||"";return t||d.debug({chain:this.chainId},"No RPC URL configured for chain"),t}}let p=null;function _(){return p||(p=new u),p}e.s(["getContractAdminService",()=>_],98250)},38029,e=>e.a(async(t,a)=>{try{var r=e.i(89171),n=e.i(50377),o=e.i(57941),s=e.i(98250),i=t([o]);[o]=i.then?(await i)():i;let _=(0,n.createLogger)({component:"GovernanceAPI"});async function l(e){let t=e.headers.get("authorization");if(!t)return{valid:!1,error:"Missing authorization header"};let a=t.replace("Bearer ",""),r=process.env.GOVERNANCE_ADMIN_API_KEY;return r?a!==r?{valid:!1,error:"Invalid API key"}:{valid:!0,user:"admin"}:(_.warn("GOVERNANCE_ADMIN_API_KEY not configured"),{valid:!1,error:"Governance API not configured"})}async function d(e){let t=Date.now();try{let a=await l(e);if(!a.valid)return r.NextResponse.json({error:"UNAUTHORIZED",message:a.error},{status:401});let n=e.nextUrl.searchParams,s=n.get("status"),i=n.get("key"),d=parseInt(n.get("limit")||"100",10),c=parseInt(n.get("offset")||"0",10),u="true"===n.get("config"),p=(0,o.getGovernanceConfigService)(),g=await p.listProposals({status:s||void 0,key:i||void 0,limit:d,offset:c}),f={proposals:g,total:g.length};return u&&(f.config=await p.getConfig(),f.config_last_updated=new Date),_.debug({count:g.length,status:s,key:i,duration_ms:Date.now()-t},"Listed governance proposals"),r.NextResponse.json(f)}catch(e){return _.error({error:e,duration_ms:Date.now()-t},"Failed to list proposals"),r.NextResponse.json({error:"INTERNAL_ERROR",message:"Failed to list proposals"},{status:500})}}async function c(e){let t=Date.now();try{let a=await l(e);if(!a.valid)return r.NextResponse.json({error:"UNAUTHORIZED",message:a.error},{status:401});let n=e.nextUrl.searchParams.get("action"),s=(0,o.getGovernanceConfigService)();if("apply"===n)return await p(s,t);if("reject"===n){let{id:n,reason:o}=await e.json();if(!n)return r.NextResponse.json({error:"INVALID_REQUEST",message:"Missing proposal id"},{status:400});return await s.rejectProposal(n,o),_.info({proposal_id:n,reason:o,user:a.user,duration_ms:Date.now()-t},"Governance proposal rejected via API"),r.NextResponse.json({success:!0,message:"Proposal rejected"})}if("force-apply"===n){let{id:n}=await e.json();if(!n)return r.NextResponse.json({error:"INVALID_REQUEST",message:"Missing proposal id"},{status:400});return await s.forceApplyProposal(n),_.warn({proposal_id:n,user:a.user,duration_ms:Date.now()-t},"Governance proposal force-applied via API"),r.NextResponse.json({success:!0,message:"Proposal force-applied (timelock bypassed)"})}return await u(e,s,a.user,t)}catch(a){let e=a instanceof Error?a.message:"Unknown error";return _.error({error:a,duration_ms:Date.now()-t},"Governance API error"),r.NextResponse.json({error:"INTERNAL_ERROR",message:e},{status:500})}}async function u(e,t,a,n){let o=await e.json();if(!o.key||void 0===o.new_value)return r.NextResponse.json({error:"INVALID_REQUEST",message:"Missing required fields: key, new_value"},{status:400});let s=t.validateValue(o.key,o.new_value);if(!s.valid)return r.NextResponse.json({error:"INVALID_VALUE",message:s.error},{status:400});let i=await t.proposeChange({key:o.key,new_value:o.new_value,created_by:a,timelock_hours:o.timelock_hours}),l={proposal:i,message:`Proposal created. Will be ready for application at ${i.ready_at.toISOString()}`};return _.info({proposal_id:i.id,key:i.key,user:a,ready_at:i.ready_at.toISOString(),duration_ms:Date.now()-n},"Governance proposal created via API"),r.NextResponse.json(l,{status:201})}async function p(e,t){let a=await e.applyDueProposals(),n=(0,s.getContractAdminService)();for(let e of a.applied)"platform_fee_percentage"===e.key&&n.logFeeUpdateRequired(e.new_value,e.id);let o={applied_count:a.applied.length,applied:a.applied,failed_count:a.failed.length,failed:a.failed.map(e=>({id:e.proposal.id,error:e.error}))};return _.info({applied:a.applied.length,failed:a.failed.length,duration_ms:Date.now()-t},"Applied due governance proposals via API"),r.NextResponse.json(o)}e.s(["GET",()=>d,"POST",()=>c]),a()}catch(e){a(e)}},!1),11860,e=>e.a(async(t,a)=>{try{var r=e.i(47909),n=e.i(74017),o=e.i(96250),s=e.i(59756),i=e.i(61916),l=e.i(14444),d=e.i(37092),c=e.i(69741),u=e.i(16795),p=e.i(87718),_=e.i(95169),g=e.i(47587),f=e.i(66012),h=e.i(70101),y=e.i(26937),w=e.i(10372),v=e.i(93695);e.i(52474);var E=e.i(220),m=e.i(38029),R=t([m]);[m]=R.then?(await R)():R;let D=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/v1/governance/proposals/route",pathname:"/api/v1/governance/proposals",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/governance/proposals/route.ts",nextConfigOutput:"standalone",userland:m}),{workAsyncStorage:A,workUnitAsyncStorage:S,serverHooks:N}=D;function C(){return(0,o.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:S})}async function b(e,t,a){D.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/v1/governance/proposals/route";r=r.replace(/\/index$/,"")||"/";let o=await D.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:m,params:R,nextConfig:C,parsedUrl:b,isDraftMode:A,prerenderManifest:S,routerServerContext:N,isOnDemandRevalidate:O,revalidateOnlyGenerated:I,resolvedPathname:P,clientReferenceManifest:T,serverActionsManifest:k}=o,x=(0,c.normalizeAppPath)(r),U=!!(S.dynamicRoutes[x]||S.routes[P]),F=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,b,!1):t.end("This page could not be found"),null);if(U&&!A){let e=!!S.routes[P],t=S.dynamicRoutes[x];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await F();throw new v.NoFallbackError}}let $=null;!U||D.isDev||A||($=P,$="/index"===$?"/":$);let L=!0===D.isDev||!U,j=U&&!L;k&&T&&(0,l.setReferenceManifestsSingleton)({page:r,clientReferenceManifest:T,serverActionsManifest:k,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:k})});let M=e.method||"GET",H=(0,i.getTracer)(),q=H.getActiveScopeSpan(),B={params:R,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>D.onRequestError(e,t,r,N)},sharedContext:{buildId:m}},V=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),W=p.NextRequestAdapter.fromNodeNextRequest(V,(0,p.signalFromNodeResponse)(t));try{let o=async e=>D.handle(W,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=H.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==_.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${M} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${r}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var i,d;let c=async({previousCacheEntry:n})=>{try{if(!l&&O&&I&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await o(s);e.fetchMetrics=B.renderOpts.fetchMetrics;let i=B.renderOpts.pendingWaitUntil;i&&a.waitUntil&&(a.waitUntil(i),i=void 0);let d=B.renderOpts.collectedTags;if(!U)return await (0,f.sendResponse)(V,G,r,B.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(r.headers);d&&(t[w.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,n=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await D.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:O})},N),t}},u=await D.handleResponse({req:e,nextConfig:C,cacheKey:$,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:I,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:l});if(!U)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",O?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&U||p.delete(w.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,y.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)(V,G,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};q?await d(q):await H.withPropagatedContext(e.headers,()=>H.trace(_.BaseServerSpan.handleRequest,{spanName:`${M} ${r}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},d))}catch(t){if(t instanceof v.NoFallbackError||await D.onRequestError(e,t,{routerKind:"App Router",routePath:x,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:O})}),U)throw t;return await (0,f.sendResponse)(V,G,new Response(null,{status:500})),null}}e.s(["handler",()=>b,"patchFetch",()=>C,"routeModule",()=>D,"serverHooks",()=>N,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>S]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=_b92f390d._.js.map