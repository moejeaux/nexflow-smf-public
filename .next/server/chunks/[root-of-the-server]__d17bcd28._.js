module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},30056,e=>e.a(async(t,r)=>{try{let t=await e.y("pg");e.n(t),r()}catch(e){r(e)}},!0),14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},87769,(e,t,r)=>{t.exports=e.x("node:events",()=>require("node:events"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},49719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},62562,(e,t,r)=>{t.exports=e.x("module",()=>require("module"))},50227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},94346,e=>{e.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},37702,(e,t,r)=>{t.exports=e.x("worker_threads",()=>require("worker_threads"))},60526,(e,t,r)=>{t.exports=e.x("node:os",()=>require("node:os"))},77652,(e,t,r)=>{t.exports=e.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},59670,e=>e.a(async(t,r)=>{try{var s=e.i(24924),a=e.i(50377),n=t([s]);[s]=n.then?(await n)():n;let u=(0,a.createLogger)({component:"AgentRecommendationsDB"});async function i(e){let t=(0,s.getDb)(),r=crypto.randomUUID(),a=new Date,n="pool"in t||"function"==typeof t.pool?.query,i={id:r,createdAt:a,agent:e.agent,type:e.type,facilitatorId:e.facilitatorId,resourceId:e.resourceId,priority:e.priority,confidence:e.confidence,details:e.details,reasoning:e.reasoning,status:"PENDING",expiresAt:e.expiresAt};return n?await t.pool.query(`INSERT INTO agent_recommendations (
        id, created_at, agent, type, facilitator_id, resource_id,
        priority, confidence, details, reasoning, status, expires_at
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)`,[r,a.toISOString(),e.agent,e.type,e.facilitatorId||null,e.resourceId||null,e.priority,e.confidence,JSON.stringify(e.details),e.reasoning,"PENDING",e.expiresAt?.toISOString()||null]):t.prepare(`
      INSERT INTO agent_recommendations (
        id, created_at, agent, type, facilitator_id, resource_id,
        priority, confidence, details, reasoning, status, expires_at
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(r,a.toISOString(),e.agent,e.type,e.facilitatorId||null,e.resourceId||null,e.priority,e.confidence,JSON.stringify(e.details),e.reasoning,"PENDING",e.expiresAt?.toISOString()||null),u.info({recommendationId:r,agent:e.agent,type:e.type,priority:e.priority,msg:"Created agent recommendation"}),i}async function o(e){let t=[];for(let r of e){let e=await i(r);t.push(e)}return t}async function p(e={}){let t=(0,s.getDb)(),r="pool"in t||"function"==typeof t.pool?.query,a="SELECT * FROM agent_recommendations WHERE 1=1",n=[],i=1;return e.agent&&(a+=r?` AND agent = $${i++}`:" AND agent = ?",n.push(e.agent)),e.type&&(a+=r?` AND type = $${i++}`:" AND type = ?",n.push(e.type)),e.status&&(a+=r?` AND status = $${i++}`:" AND status = ?",n.push(e.status)),e.facilitatorId&&(a+=r?` AND facilitator_id = $${i++}`:" AND facilitator_id = ?",n.push(e.facilitatorId)),e.priority&&(a+=r?` AND priority = $${i++}`:" AND priority = ?",n.push(e.priority)),e.since&&(a+=r?` AND created_at >= $${i++}`:" AND created_at >= ?",n.push(e.since.toISOString())),a+=" ORDER BY created_at DESC",e.limit&&(a+=r?` LIMIT $${i++}`:" LIMIT ?",n.push(e.limit)),(r?(await t.pool.query(a,n)).rows:t.prepare(a).all(...n)).map(l)}async function d(e,t,r){let a=(0,s.getDb)(),n=new Date().toISOString();"pool"in a||"function"==typeof a.pool?.query?await a.pool.query(`UPDATE agent_recommendations
       SET status = 'APPLIED', reviewed_by = $1, reviewed_at = $2,
           details = details || $3
       WHERE id = $4`,[t,n,JSON.stringify(r||{}),e]):a.prepare(`
      UPDATE agent_recommendations
      SET status = 'APPLIED', reviewed_by = ?, reviewed_at = ?
      WHERE id = ?
    `).run(t,n,e),u.info({recommendationId:e,reviewedBy:t,msg:"Recommendation applied"})}async function c(){let e=(0,s.getDb)(),t=new Date().toISOString();return"pool"in e||"function"==typeof e.pool?.query?(await e.pool.query(`UPDATE agent_recommendations
       SET status = 'EXPIRED'
       WHERE status = 'PENDING' AND expires_at IS NOT NULL AND expires_at < $1`,[t])).rowCount||0:e.prepare(`
      UPDATE agent_recommendations
      SET status = 'EXPIRED'
      WHERE status = 'PENDING' AND expires_at IS NOT NULL AND expires_at < ?
    `).run(t).changes||0}function l(e){return{id:e.id,createdAt:new Date(e.created_at),agent:e.agent,type:e.type,facilitatorId:e.facilitator_id||void 0,resourceId:e.resource_id||void 0,priority:e.priority,confidence:parseFloat(e.confidence),details:"string"==typeof e.details?JSON.parse(e.details):e.details,reasoning:e.reasoning,status:e.status,reviewedBy:e.reviewed_by||void 0,reviewedAt:e.reviewed_at?new Date(e.reviewed_at):void 0,expiresAt:e.expires_at?new Date(e.expires_at):void 0}}e.s(["createRecommendations",()=>o,"expirePendingRecommendations",()=>c,"listRecommendations",()=>p,"markRecommendationApplied",()=>d]),r()}catch(e){r(e)}},!1),2759,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__7ebfd264._.js","server/chunks/node_modules_@upstash_redis_nodejs_mjs_85cd95da._.js"].map(t=>e.l(t))).then(()=>t(58119)))},6538,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__bc7866ad._.js","server/chunks/[root-of-the-server]__bbbc7a9e._.js","server/chunks/node_modules_@ioredis_commands_built_commands_json_862661ff._.js"].map(t=>e.l(t))).then(()=>t(42512)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d17bcd28._.js.map