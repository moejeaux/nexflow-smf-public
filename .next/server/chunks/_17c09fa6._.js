module.exports=[42235,e=>{"use strict";var t=e.i(50377);let r=(0,t.createLogger)({component:"LLM"}),a=new class{config;constructor(){this.config=function(){let e,t,r,a=process.env.LLM_PROVIDER||"openai";return"anthropic"===a?(e=process.env.ANTHROPIC_API_KEY||"",t=process.env.LLM_MODEL||"claude-3-haiku-20240307",r=process.env.ANTHROPIC_BASE_URL):(e=process.env.OPENAI_API_KEY||"",t=process.env.LLM_MODEL||"gpt-4o-mini",r=process.env.OPENAI_BASE_URL),{provider:a,apiKey:e,model:t,baseUrl:r}}()}async generateJson(e){let{system:t,prompt:a,temperature:n=.7,maxTokens:s=1024}=e;if(!this.config.apiKey)return r.warn({msg:"LLM API key not configured, returning null"}),null;try{let e;e="anthropic"===this.config.provider?await this.callAnthropic(t,a,n,s):await this.callOpenAI(t,a,n,s);let o=this.extractJson(e);if(!o)return r.error({msg:"Failed to extract JSON from LLM response",rawContent:e.slice(0,500)}),null;return JSON.parse(o)}catch(e){return r.error({error:e instanceof Error?e.message:"Unknown error",msg:"LLM generation failed"}),null}}async callOpenAI(e,t,r,a){let n=this.config.baseUrl||"https://api.openai.com",s=`${n}/v1/chat/completions`,o=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({model:this.config.model,messages:[{role:"system",content:e},{role:"user",content:t}],temperature:r,max_tokens:a,response_format:{type:"json_object"}})});if(!o.ok){let e=await o.text();throw Error(`OpenAI API error (${o.status}): ${e}`)}let i=await o.json();return i.choices?.[0]?.message?.content||""}async callAnthropic(e,t,r,a){let n=this.config.baseUrl||"https://api.anthropic.com",s=`${n}/v1/messages`,o=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.config.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.config.model,max_tokens:a,system:e,messages:[{role:"user",content:t}],temperature:r})});if(!o.ok){let e=await o.text();throw Error(`Anthropic API error (${o.status}): ${e}`)}let i=await o.json();return i.content?.[0]?.text||""}extractJson(e){let t=e.trim();if(t.startsWith("[")||t.startsWith("{"))return t;let r=e.match(/```(?:json)?\s*([\s\S]*?)```/);if(r)return r[1].trim();let a=e.match(/(\[[\s\S]*\]|\{[\s\S]*\})/);return a?a[1].trim():null}isConfigured(){return!!this.config.apiKey}getConfigSummary(){return{provider:this.config.provider,model:this.config.model,hasApiKey:!!this.config.apiKey,hasBaseUrl:!!this.config.baseUrl}}},n=(0,t.createLogger)({component:"ReplyAgent"}),s=`
You are an AI reply agent for NexFlow SMF, a meta-facilitator that routes x402 payments across multiple facilitators with observability, risk, and policy built in.

Your job is to decide whether to reply to a given post about x402/agents/infrastructure and, if yes, generate a concise, high-signal reply that explains SMF's role without being spammy.

SMF FACTS (you must respect these exactly):

smf_role: "SMF is a meta-facilitator for x402 that chooses which facilitator to route a payment through, based on health, latency, cost, and risk."

smf_layers:
${["Observability: pulls facilitator health and performance (e.g., from x402scan / internal metrics).","Policy & risk: OFAC/KYT checks, risk scores, trust tiers, blocking risky flows.","Coordinator & bandit: offline 'shadow routing' that simulates alternative routing decisions before they ever touch production.","Dev UX: intended to feel like a single facilitator endpoint or SDK for apps and agents."].map((e,t)=>`${t+1}. ${e}`).join("\n")}

zauth_positioning: "Zauth focuses on autonomous security testing and 'truth' about x402 endpoints (pentesting, correctness, abuse prevention). SMF focuses on routing, payments, and policy. They are complementary."

WHEN TO REPLY:
ONLY reply if ALL are true:
- The post is clearly about at least one of: x402, AI agents, facilitators, agent infra, security around x402, or agent payments.
- SMF's role is relevant (e.g., they mention routing, payments, facilitators, reliability, or infra gaps).
- The tone is neutral or positive (no hostile threads; don't argue).

DO NOT reply if:
- The post is pure trading/price talk without infra/product discussion.
- The thread is an argument, drama, or off-topic for x402/agents.
- The already_replied flag is true.

HOW TO REPLY (if you do):
Guidelines for reply_text:
- Length: 1-2 sentences, max ~260 characters.
- Tone: technical, matter-of-fact, no hype, no emojis.
- Content rules:
  - Acknowledge the original work when appropriate (e.g., "Love seeing more x402 security infra here.").
  - Briefly position SMF using smf_role in your own words.
  - If the post is about Zauth / security, emphasize complementarity using zauth_positioning.
  - Optional soft pointer like "we're building this into NexFlow's SMF" or "SMF sits on the routing side of x402 for agents."
  - No links.

STYLE CONSTRAINTS:
- Never oversell or promise features that are not part of smf_facts.
- Do not discuss internal file paths, implementation details, or roadmap specifics.
- Do not criticize other projects; always frame SMF as complementary infra.

OUTPUT FORMAT:
Return ONLY valid JSON in one of these shapes:

If you decide NOT to reply:
{
  "should_reply": false,
  "reason": "short explanation"
}

If you decide TO reply:
{
  "should_reply": true,
  "reply_text": "your reply here, max 260 characters",
  "angle": "which angle you chose: e.g., 'routing vs security', 'meta-facilitator explainer', 'agent-friendly payments'"
}
`.trim();async function o(e){if(e.alreadyReplied)return{shouldReply:!1,reason:"Already replied to this author/thread in the last 7 days."};if(!a.isConfigured())return n.warn({msg:"LLM not configured, cannot evaluate for reply"}),{shouldReply:!1,reason:"LLM not configured."};n.info({postAuthor:e.postAuthor,postLength:e.postText.length,hasContext:!!e.threadContext?.length,msg:"Evaluating post for reply"});try{let t,r=((t=[]).push("POST TO EVALUATE:"),t.push(`Author: ${e.postAuthor}`),t.push(`Text: "${e.postText}"`),e.threadContext&&e.threadContext.length>0&&(t.push(`
THREAD CONTEXT (previous posts):`),e.threadContext.forEach((e,r)=>{t.push(`${r+1}. "${e}"`)})),t.push(`
already_replied: ${e.alreadyReplied?"true":"false"}`),t.push(`
Decide whether to reply and output JSON.`),t.join("\n")),o=await a.generateJson({system:s,prompt:r,schemaHint:"ReplyDecision object",temperature:.5,maxTokens:512});if(!o)return n.warn({msg:"LLM returned null result"}),{shouldReply:!1,reason:"LLM returned invalid response."};if(!0!==o.should_reply)return n.info({postAuthor:e.postAuthor,reason:o.reason,msg:"Decided not to reply"}),{shouldReply:!1,reason:o.reason||"No relevant angle for SMF."};{if(!o.reply_text||"string"!=typeof o.reply_text)return n.warn({msg:"LLM returned should_reply=true but no reply_text"}),{shouldReply:!1,reason:"Invalid reply generated."};let t=o.reply_text.trim();if(t.length>280&&(t=t.slice(0,277)+"..."),!function(e){for(let t of i)if(t.test(e))return n.warn({pattern:t.source,msg:"Reply blocked by guardrail"}),!1;let t=(e.match(/\p{Emoji}/gu)||[]).length;return t>0&&n.warn({emojiCount:t,msg:"Reply has emojis (style violation)"}),!0}(t))return n.warn({msg:"Reply failed content validation"}),{shouldReply:!1,reason:"Generated reply failed content validation."};return n.info({postAuthor:e.postAuthor,angle:o.angle,replyLength:t.length,msg:"Generated reply"}),{shouldReply:!0,replyText:t,angle:o.angle||"general"}}}catch(e){return n.error({error:e instanceof Error?e.message:"Unknown error",msg:"Reply evaluation failed"}),{shouldReply:!1,reason:"Evaluation error."}}}let i=[/localhost/i,/127\.0\.0\.1/i,/internal/i,/roadmap/i,/soon/i,/guaranteed/i,/moon/i,/pump/i,/dump/i,/\bshit\b/i,/\bfuck\b/i,/http[s]?:\/\//i];e.s(["evaluateForReply",()=>o],42235)},46529,e=>{"use strict";class t extends Error{response;constructor(e,t){super(e),this.response=t,this.name="XPostingError"}}class r{config;constructor(e){this.config=e}async postTweet(e,r,a){let n=a?.maxRetries??2,s=a?.initialDelayMs??5e3,o=0,i=s;for(;;){o++;let a=await this.doPostTweet(e,r);if(a.ok)return a;if("RATE_LIMIT"===a.code&&o<=n){let e=a.retryAfterSeconds?1e3*a.retryAfterSeconds:i;console.log(`[X-CLIENT] Rate limited. Retrying in ${Math.ceil(e/1e3)}s (attempt ${o}/${n+1})`),await function(e){return new Promise(t=>setTimeout(t,e))}(e),i*=2;continue}throw new t(`Failed to post tweet: ${a.code} - ${a.message}`,a)}}async doPostTweet(e,t){let r=`${this.config.baseUrl}/x/tweet`,a={"Content-Type":"application/json"};this.config.apiKey&&(a.Authorization=`Bearer ${this.config.apiKey}`);try{let n=await fetch(r,{method:"POST",headers:a,body:JSON.stringify({text:e,meta:t})});return await n.json()}catch(e){return{ok:!1,status:0,code:"UNKNOWN",message:`Network error connecting to X service: ${e.message}`}}}async checkStatus(){try{let e=await fetch(`${this.config.baseUrl}/auth/x/status`),t=await e.json();return{connected:t.connected??!1,message:t.message}}catch(e){return{connected:!1,message:`Failed to connect to X service: ${e.message}`}}}async healthCheck(){try{return(await fetch(`${this.config.baseUrl}/health`)).ok}catch{return!1}}}function a(){return new r({baseUrl:process.env.X_POSTING_BASE_URL||"http://localhost:3001",apiKey:process.env.X_POSTING_API_KEY})}e.s(["createXPostingClientFromEnv",()=>a])},70117,e=>e.a(async(t,r)=>{try{var a=e.i(50377),n=e.i(42235),s=e.i(46529),o=e.i(30056),i=t([o]);[o]=i.then?(await i)():i;let f=(0,a.createLogger)({component:"ReplyRunner"}),w=null;function l(){if(w)return w;let e=process.env.DATABASE_URL;return e&&e.startsWith("postgresql://")?w=new o.Pool({connectionString:e,max:3,idleTimeoutMillis:3e4,connectionTimeoutMillis:5e3}):(f.warn({msg:"DATABASE_URL not configured for social reply state"}),null)}let _=parseFloat(process.env.REPLY_SCORE_THRESHOLD??"0.7"),T=["@x402protocol","@coinaboratory","@zauthx402","@payloaddotxyz"],R=["launching","announcing","introducing","release","mainnet","partnership","integration"],E="smf-reply-agent",A={async ensureTable(){let e=l();e&&await e.query(`
      CREATE TABLE IF NOT EXISTS social_reply_state (
        id TEXT PRIMARY KEY,
        last_checked_post_id TEXT,
        last_reply_at TIMESTAMPTZ,
        replies_last_24h INTEGER DEFAULT 0,
        replies_window_start TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW()
      )
    `)},async get(){let e=l(),t={lastCheckedPostId:null,lastReplyAt:null,repliesLast24h:0,repliesWindowStart:new Date};if(!e)return f.warn({msg:"No database, using default state"}),t;try{await this.ensureTable();let r=await e.query("SELECT * FROM social_reply_state WHERE id = $1",[E]);if(0===r.rows.length)return await e.query(`
          INSERT INTO social_reply_state (id, replies_window_start)
          VALUES ($1, NOW())
          ON CONFLICT (id) DO NOTHING
        `,[E]),f.info({msg:"Initialized social reply state in database"}),t;let a=r.rows[0];return{lastCheckedPostId:a.last_checked_post_id,lastReplyAt:a.last_reply_at?new Date(a.last_reply_at):null,repliesLast24h:a.replies_last_24h||0,repliesWindowStart:new Date(a.replies_window_start||Date.now())}}catch(e){return f.error({error:e,msg:"Failed to get social state from DB"}),t}},async update(e){let t=l();if(!t)return void f.warn({updates:e,msg:"No database, skipping state update"});try{await this.ensureTable();let r=["updated_at = NOW()"],a=[],n=1;void 0!==e.lastCheckedPostId&&(r.push(`last_checked_post_id = $${n++}`),a.push(e.lastCheckedPostId)),void 0!==e.lastReplyAt&&(r.push(`last_reply_at = $${n++}`),a.push(e.lastReplyAt)),void 0!==e.repliesLast24h&&(r.push(`replies_last_24h = $${n++}`),a.push(e.repliesLast24h)),void 0!==e.repliesWindowStart&&(r.push(`replies_window_start = $${n++}`),a.push(e.repliesWindowStart)),a.push(E),await t.query(`
        INSERT INTO social_reply_state (id, ${void 0!==e.lastCheckedPostId?"last_checked_post_id,":""}${void 0!==e.lastReplyAt?"last_reply_at,":""}${void 0!==e.repliesLast24h?"replies_last_24h,":""}${void 0!==e.repliesWindowStart?"replies_window_start,":""} updated_at)
        VALUES ($${n}, ${a.slice(0,-1).map((e,t)=>`$${t+1}`).join(", ")}${a.length>1?",":""} NOW())
        ON CONFLICT (id) DO UPDATE SET ${r.join(", ")}
      `,a),f.debug({updates:e,msg:"Updated social reply state in database"})}catch(e){f.error({error:e,msg:"Failed to update social state in DB"})}}};async function c(e){let t=process.env.X_SEARCH_BEARER_TOKEN;if(!t)return f.info({sinceId:e.sinceId,limit:e.limit,msg:"X search not configured (X_SEARCH_BEARER_TOKEN missing), returning empty"}),[];try{let r=new URL("https://api.twitter.com/2/tweets/search/recent");r.searchParams.set("query",e.query),r.searchParams.set("max_results",String(Math.min(e.limit,100))),r.searchParams.set("tweet.fields","author_id,conversation_id,created_at,public_metrics"),r.searchParams.set("expansions","author_id"),r.searchParams.set("user.fields","username"),e.sinceId&&r.searchParams.set("since_id",e.sinceId);let a=await fetch(r.toString(),{headers:{Authorization:`Bearer ${t}`}});if(!a.ok){let e=await a.text();return f.error({status:a.status,error:e,msg:"X search API error"}),[]}let n=await a.json(),s=n.data||[],o=n.includes?.users||[],i=new Map(o.map(e=>[e.id,e.username])),l=s.map(e=>({id:e.id,text:e.text,author:`@${i.get(e.author_id)||"unknown"}`,threadId:e.conversation_id||e.id,postedAt:new Date(e.created_at),likes:e.public_metrics?.like_count||0,replies:e.public_metrics?.reply_count||0,inReplyTo:e.in_reply_to_user_id?e.id:void 0}));return f.info({fetched:l.length,sinceId:e.sinceId,msg:"Fetched posts from X search API"}),l}catch(e){return f.error({error:e instanceof Error?e.message:"Unknown",msg:"Failed to fetch posts from X"}),[]}}async function d(e){let t=(0,s.createXPostingClientFromEnv)();try{let r=await t.checkStatus();if(!r.connected)return f.warn({message:r.message,msg:"X service not connected, cannot post reply"}),{success:!1,error:"X service not connected"};let a=await t.postTweet(e.text,{agentId:"smf-reply-agent",topic:"reply",correlationId:e.inReplyToId});return f.info({tweetId:a.tweetId,inReplyToId:e.inReplyToId,msg:"Reply posted successfully via X Posting Service"}),{success:!0,tweetId:a.tweetId}}catch(r){let t=r instanceof Error?r.message:"Unknown error";return f.error({error:t,inReplyToId:e.inReplyToId,msg:"Failed to post reply"}),{success:!1,error:t}}}async function p(){let e=l();e&&(await e.query(`
    CREATE TABLE IF NOT EXISTS social_replies (
      id SERIAL PRIMARY KEY,
      thread_id TEXT NOT NULL,
      post_id TEXT NOT NULL,
      reply_text TEXT,
      angle TEXT,
      replied_at TIMESTAMPTZ DEFAULT NOW(),
      UNIQUE(thread_id, post_id)
    )
  `),await e.query(`
    CREATE INDEX IF NOT EXISTS idx_social_replies_thread_id 
    ON social_replies(thread_id)
  `))}async function u(e){let t=l();if(!t)return f.debug({threadId:e,msg:"No database, assuming not replied"}),!1;try{await p();let r=(await t.query(`SELECT 1 FROM social_replies 
       WHERE thread_id = $1 
       AND replied_at > NOW() - INTERVAL '7 days'
       LIMIT 1`,[e])).rows.length>0;return f.debug({threadId:e,hasReplied:r,msg:"Checked thread reply status"}),r}catch(t){return f.error({error:t,threadId:e,msg:"Failed to check thread reply status"}),!1}}async function h(e){let t=l();if(!t)return void f.warn({params:e,msg:"No database, skipping reply record"});try{await p(),await t.query(`INSERT INTO social_replies (thread_id, post_id, reply_text, angle, replied_at)
       VALUES ($1, $2, $3, $4, NOW())
       ON CONFLICT (thread_id, post_id) DO UPDATE SET
         reply_text = EXCLUDED.reply_text,
         angle = EXCLUDED.angle,
         replied_at = NOW()`,[e.threadId,e.postId,e.replyText,e.angle]),f.info({threadId:e.threadId,postId:e.postId,angle:e.angle,msg:"Recorded reply in database"})}catch(t){f.error({error:t,params:e,msg:"Failed to record reply"})}}function g(e){let t=e.author.toLowerCase();if(T.some(e=>t.includes(e.toLowerCase().replace("@",""))))return!0;let r=e.text.toLowerCase();return!!R.some(e=>r.includes(e))}function y(e){let t,r,a=(new Date().getTime()-e.postedAt.getTime())/36e5,n=g(e)?72:48;if(a>n)return f.debug({postId:e.id,ageHours:Math.round(a),maxAge:n,isBigAnnouncement:g(e),msg:"Post too old, score = 0"}),0;let s=Math.exp(-3*a/n),o=Math.max(0,Math.min(1,s)),i=e.likes??0,l=e.replies??0,c=Math.min(i+2*l,50)/50,d=e.relevanceScore??(t=e.text.toLowerCase(),r=0,t.includes("x402")&&(r+=10),t.includes("facilitator")&&(r+=8),t.includes("agent payment")&&(r+=8),t.includes("zauth")&&(r+=7),t.includes("routing")&&(r+=5),t.includes("infrastructure")&&(r+=4),t.includes("payment")&&(r+=3),t.includes("agent")&&(r+=2),Math.min(r/30,1)),p=.4*o+.3*c+.3*d;return e.inReplyTo&&l>2&&(p+=.1),p=Math.max(0,Math.min(1,p)),f.debug({postId:e.id,ageHours:Math.round(10*a)/10,recency:Math.round(100*o)/100,engagement:Math.round(100*c)/100,relevance:Math.round(100*d)/100,activeThreadBoost:e.inReplyTo&&l>2,finalScore:Math.round(100*p)/100,msg:"Calculated post score"}),p}async function m(){var e,t;let r,a,s,o,i=Date.now();f.info({msg:"ðŸ” Starting reply scan tick"});let l=await A.get();e=l,l=(a=new Date).getTime()-e.repliesWindowStart.getTime()>=864e5?{...e,repliesLast24h:0,repliesWindowStart:a}:e;let p=new Date,g=l.lastReplyAt?(p.getTime()-l.lastReplyAt.getTime())/6e4:1/0,m=g>=120,w=l.repliesLast24h<8;f.info({minutesSinceLastReply:Math.round(g),repliesLast24h:l.repliesLast24h,canPostBasedOnTime:m,withinDailyLimit:w,msg:"Rate limit check"});let T=await c({sinceId:l.lastCheckedPostId,limit:30,query:'x402 OR facilitator OR "agent payments" OR ZAUTH OR "payment infrastructure"'}),R=(t=l.lastCheckedPostId,0===T.length?t:[...T].sort((e,t)=>t.postedAt.getTime()-e.postedAt.getTime())[0].id);if(0===T.length){await A.update({lastCheckedPostId:R});let e={postedReply:!1,candidatesFetched:0,candidatesEvaluated:0,skipReason:"no_candidates",durationMs:Date.now()-i};return f.info({...e,msg:"âœ… Reply scan complete (no candidates)"}),e}let E=((s=T.map(e=>({post:e,score:y(e)}))).sort((e,t)=>t.score-e.score),s.map(e=>e.post));if(f.info({topCandidates:E.slice(0,5).map(e=>({id:e.id,author:e.author,score:Math.round(100*y(e))/100,ageHours:Math.round((Date.now()-e.postedAt.getTime())/36e5*10)/10})),msg:"Top candidates by score"}),!m){await A.update({lastCheckedPostId:R});let e={postedReply:!1,candidatesFetched:T.length,candidatesEvaluated:0,skipReason:"cooldown_not_elapsed",durationMs:Date.now()-i};return f.info({...e,minutesRemaining:Math.round(120-g),msg:"âœ… Reply scan complete (cooldown)"}),e}if(!w){await A.update({lastCheckedPostId:R});let e={postedReply:!1,candidatesFetched:T.length,candidatesEvaluated:0,skipReason:"daily_cap_reached",durationMs:Date.now()-i};return f.info({...e,repliesUsed:l.repliesLast24h,maxReplies:8,msg:"âœ… Reply scan complete (daily cap)"}),e}let v=!1,I=0,x=0;for(let e of E){let t=y(e);if(t<_){x++,f.debug({postId:e.id,score:t,threshold:_,msg:"Skipping candidate below score threshold"});continue}I++;let r=await u(e.threadId),a={postText:e.text,postAuthor:e.author,threadContext:e.threadContext,alreadyReplied:r},s=await (0,n.evaluateForReply)(a);if(f.debug({postId:e.id,author:e.author,shouldReply:s.shouldReply,reason:s.shouldReply?void 0:s.reason,msg:"Agent evaluation result"}),!s.shouldReply)continue;let i=await d({inReplyToId:e.id,text:s.replyText});if(!i.success){f.error({postId:e.id,error:i.error,msg:"Failed to post reply"});continue}await h({threadId:e.threadId,postId:e.id,replyText:s.replyText,angle:s.angle}),await A.update({lastCheckedPostId:R,lastReplyAt:p,repliesLast24h:l.repliesLast24h+1}),v=!0,o={inReplyToId:e.id,text:s.replyText,angle:s.angle},f.info({postId:e.id,author:e.author,angle:s.angle,replyPreview:s.replyText.slice(0,50),msg:"âœ… Reply posted successfully"});break}v||await A.update({lastCheckedPostId:R}),v||(r=x===E.length?"no_candidate_above_threshold":I>0?"agent_returned_none":"no_good_candidates");let S={postedReply:v,candidatesFetched:T.length,candidatesEvaluated:I,skipReason:r,replyPosted:o,durationMs:Date.now()-i};return f.info({...S,candidatesBelowThreshold:x,scoreThreshold:_,msg:`âœ… Reply scan complete (${v?"replied":"no reply"})`}),S}e.s(["runReplyScanTick",()=>m]),r()}catch(e){r(e)}},!1),98990,e=>e.a(async(t,r)=>{try{var a=e.i(70117),n=e.i(50377),s=e.i(7484),o=t([a,s]);[a,s]=o.then?(await o)():o;let l=(0,n.createLogger)({component:"SocialReplyCron"});async function i(e,t){let{runId:r,requestId:n}=t;l.info({runId:r,requestId:n,msg:"Starting social reply scan"});let s=await (0,a.runReplyScanTick)();return l.info({runId:r,requestId:n,...s,msg:"Social reply scan completed"}),{ok:!0,...s}}let c=(0,s.withCronJobTracking)(i,{jobId:"social-reply",enabledEnvVar:"SOCIAL_REPLY_ENABLED",timeout:55e3,minInterval:84e4});e.s(["GET",0,c,"dynamic",0,"force-dynamic","maxDuration",0,60]),r()}catch(e){r(e)}},!1),36160,e=>e.a(async(t,r)=>{try{var a=e.i(47909),n=e.i(74017),s=e.i(96250),o=e.i(59756),i=e.i(61916),l=e.i(14444),c=e.i(37092),d=e.i(69741),p=e.i(16795),u=e.i(87718),h=e.i(95169),g=e.i(47587),y=e.i(66012),m=e.i(70101),f=e.i(26937),w=e.i(10372),_=e.i(93695);e.i(52474);var T=e.i(220),R=e.i(98990),E=t([R]);[R]=E.then?(await E)():E;let I=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/cron/social-reply/route",pathname:"/api/cron/social-reply",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/cron/social-reply/route.ts",nextConfigOutput:"standalone",userland:R}),{workAsyncStorage:x,workUnitAsyncStorage:S,serverHooks:O}=I;function A(){return(0,s.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:S})}async function v(e,t,r){I.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/cron/social-reply/route";a=a.replace(/\/index$/,"")||"/";let s=await I.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:E,nextConfig:A,parsedUrl:v,isDraftMode:x,prerenderManifest:S,routerServerContext:O,isOnDemandRevalidate:L,revalidateOnlyGenerated:C,resolvedPathname:N,clientReferenceManifest:b,serverActionsManifest:P}=s,k=(0,d.normalizeAppPath)(a),M=!!(S.dynamicRoutes[k]||S.routes[N]),$=async()=>((null==O?void 0:O.render404)?await O.render404(e,t,v,!1):t.end("This page could not be found"),null);if(M&&!x){let e=!!S.routes[N],t=S.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await $();throw new _.NoFallbackError}}let D=null;!M||I.isDev||x||(D=N,D="/index"===D?"/":D);let U=!0===I.isDev||!M,F=M&&!U;P&&b&&(0,l.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:b,serverActionsManifest:P,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:P})});let H=e.method||"GET",X=(0,i.getTracer)(),j=X.getActiveScopeSpan(),K={params:E,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>I.onRequestError(e,t,a,O)},sharedContext:{buildId:R}},q=new p.NodeNextRequest(e),W=new p.NodeNextResponse(t),B=u.NextRequestAdapter.fromNodeNextRequest(q,(0,u.signalFromNodeResponse)(t));try{let s=async e=>I.handle(B,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=X.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${a}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),c=async o=>{var i,c;let d=async({previousCacheEntry:n})=>{try{if(!l&&L&&C&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(o);e.fetchMetrics=K.renderOpts.fetchMetrics;let i=K.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let c=K.renderOpts.collectedTags;if(!M)return await (0,y.sendResponse)(q,W,a,K.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[w.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,n=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:T.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:L})},O),t}},p=await I.handleResponse({req:e,nextConfig:A,cacheKey:D,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:L,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:l});if(!M)return null;if((null==p||null==(i=p.value)?void 0:i.kind)!==T.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(c=p.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",L?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,m.fromNodeOutgoingHttpHeaders)(p.value.headers);return l&&M||u.delete(w.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,f.getCacheControlHeader)(p.cacheControl)),await (0,y.sendResponse)(q,W,new Response(p.value.body,{headers:u,status:p.value.status||200})),null};j?await c(j):await X.withPropagatedContext(e.headers,()=>X.trace(h.BaseServerSpan.handleRequest,{spanName:`${H} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},c))}catch(t){if(t instanceof _.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:L})}),M)throw t;return await (0,y.sendResponse)(q,W,new Response(null,{status:500})),null}}e.s(["handler",()=>v,"patchFetch",()=>A,"routeModule",()=>I,"serverHooks",()=>O,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>S]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=_17c09fa6._.js.map