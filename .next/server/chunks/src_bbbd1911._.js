module.exports=[33215,e=>e.a(async(t,n)=>{try{var o=e.i(50848),i=t([o]);function a(e){return{id:e.id,endpointId:e.endpoint_id||void 0,url:e.url,secret:e.secret,events:e.events,enabled:e.enabled,createdAt:e.created_at,updatedAt:e.updated_at}}async function d(t){let{getDb:n}=await e.A(36784),i=n(),d="pool"in i||"function"==typeof i.pool?.query,r="SELECT * FROM webhook_configs WHERE 1=1",s=[],u=1;return t?.apiKeyId&&(d?r+=` AND api_key_id = $${u++}`:r+=" AND api_key_id = ?",s.push(t.apiKeyId)),t?.endpointId&&(d?r+=` AND endpoint_id = $${u++}`:r+=" AND endpoint_id = ?",s.push(t.endpointId)),t?.enabled!==void 0&&(d?r+=` AND enabled = $${u++}`:r+=" AND enabled = ?",s.push(t.enabled?!!d||1:!d&&0)),r+=" ORDER BY created_at DESC",(await (0,o.executeQuery)(r,s)).map(e=>({...a(e),events:"string"==typeof e.events?JSON.parse(e.events):Array.isArray(e.events)?e.events:[]}))}async function r(t){let{getDb:n}=await e.A(36784),i=n(),d="pool"in i||"function"==typeof i.pool?.query,r=await (0,o.executeQueryOne)(d?"SELECT * FROM webhook_configs WHERE id = $1":"SELECT * FROM webhook_configs WHERE id = ?",[t]);return r?{...a(r),events:"string"==typeof r.events?JSON.parse(r.events):Array.isArray(r.events)?r.events:[]}:null}async function s(t){let n=t.id||`wh_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,i=new Date().toISOString(),{getDb:a}=await e.A(36784),d=a(),r="pool"in d||"function"==typeof d.pool?.query,s=r?`INSERT INTO webhook_configs (id, api_key_id, endpoint_id, url, secret, events, enabled, created_at, updated_at)
       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)`:`INSERT INTO webhook_configs (id, api_key_id, endpoint_id, url, secret, events, enabled, created_at, updated_at)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,u=r?[n,t.apiKeyId,t.endpointId||null,t.url,t.secret,JSON.stringify(t.events),!1!==t.enabled,i,i]:[n,t.apiKeyId,t.endpointId||null,t.url,t.secret,JSON.stringify(t.events),+(!1!==t.enabled),i,i];return await (0,o.executeUpdate)(s,u),{id:n,endpointId:t.endpointId,url:t.url,secret:t.secret,events:t.events,enabled:!1!==t.enabled,createdAt:i,updatedAt:i}}async function u(t,n){let{getDb:i}=await e.A(36784),a=i(),d="pool"in a||"function"==typeof a.pool?.query,s=new Date().toISOString(),u=[],p=[],c=1;u.push(d?`updated_at = $${c++}`:"updated_at = ?"),p.push(s),void 0!==n.url&&(u.push(d?`url = $${c++}`:"url = ?"),p.push(n.url)),void 0!==n.events&&(u.push(d?`events = $${c++}`:"events = ?"),p.push(JSON.stringify(n.events))),void 0!==n.enabled&&(u.push(d?`enabled = $${c++}`:"enabled = ?"),p.push(n.enabled?!!d||1:!d&&0)),p.push(t);let l=d?`$${c}`:"?",f=`UPDATE webhook_configs SET ${u.join(", ")} WHERE id = ${l}`;return await (0,o.executeUpdate)(f,p),r(t)}async function p(t){let{getDb:n}=await e.A(36784),i=n(),a="pool"in i||"function"==typeof i.pool?.query,d=await (0,o.executeUpdate)(a?"DELETE FROM webhook_configs WHERE id = $1":"DELETE FROM webhook_configs WHERE id = ?",[t]);return(d.rowCount??d.changes??0)>0}[o]=i.then?(await i)():i,e.s(["createWebhookConfig",()=>s,"deleteWebhookConfig",()=>p,"getWebhookConfig",()=>r,"getWebhookConfigs",()=>d,"updateWebhookConfig",()=>u]),n()}catch(e){n(e)}},!1),18770,e=>e.a(async(t,n)=>{try{var o=e.i(33215),i=t([o]);async function a(e){return o.getWebhookConfigs(e)}async function d(e){return await o.getWebhookConfig(e)||void 0}async function r(e){return await o.getWebhookConfig(e.id)?await o.updateWebhookConfig(e.id,{url:e.url,events:e.events,enabled:e.enabled})||e:o.createWebhookConfig(e)}async function s(e){return o.deleteWebhookConfig(e)}[o]=i.then?(await i)():i,e.s(["deleteWebhookConfig",()=>s,"getWebhookConfig",()=>d,"getWebhookConfigs",()=>a,"setWebhookConfig",()=>r]),n()}catch(e){n(e)}},!1),36784,e=>{e.v(e=>Promise.resolve().then(()=>e(24924)))}];

//# sourceMappingURL=src_bbbd1911._.js.map