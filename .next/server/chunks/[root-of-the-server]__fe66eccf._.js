module.exports=[93695,(e,t,s)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},22734,(e,t,s)=>{t.exports=e.x("fs",()=>require("fs"))},30056,e=>e.a(async(t,s)=>{try{let t=await e.y("pg");e.n(t),s()}catch(e){s(e)}},!0),14747,(e,t,s)=>{t.exports=e.x("path",()=>require("path"))},70406,(e,t,s)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,s)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,s)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,s)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,s)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,s)=>{t.exports=e.x("util",()=>require("util"))},87769,(e,t,s)=>{t.exports=e.x("node:events",()=>require("node:events"))},874,(e,t,s)=>{t.exports=e.x("buffer",()=>require("buffer"))},27699,(e,t,s)=>{t.exports=e.x("events",()=>require("events"))},92509,(e,t,s)=>{t.exports=e.x("url",()=>require("url"))},49719,(e,t,s)=>{t.exports=e.x("assert",()=>require("assert"))},62562,(e,t,s)=>{t.exports=e.x("module",()=>require("module"))},50227,(e,t,s)=>{t.exports=e.x("node:path",()=>require("node:path"))},94346,e=>{e.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},37702,(e,t,s)=>{t.exports=e.x("worker_threads",()=>require("worker_threads"))},60526,(e,t,s)=>{t.exports=e.x("node:os",()=>require("node:os"))},77652,(e,t,s)=>{t.exports=e.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},62556,e=>{"use strict";let t=(0,e.i(50377).createLogger)({component:"CircuitBreaker"});class s{config;state;failures;successes;lastFailure;lastSuccess;openedAt;totalRequests;failedRequests;constructor(e){this.config=e,this.state="CLOSED",this.failures=[],this.successes=0,this.totalRequests=0,this.failedRequests=0}async execute(e){if(this.totalRequests++,"OPEN"===this.state)if(this.shouldAttemptReset())this.transitionTo("HALF_OPEN");else{if(this.failedRequests++,t.warn({circuit:this.config.name,state:this.state,openedAt:this.openedAt},"Circuit breaker is OPEN - failing fast"),this.config.fallback)return this.config.fallback();throw new r(`Circuit breaker ${this.config.name} is OPEN`,this.config.name)}try{let t=await this.executeWithTimeout(e);return this.onSuccess(),t}catch(e){throw this.onFailure(e),e}}async executeWithTimeout(e){return this.config.requestTimeout?Promise.race([e(),new Promise((e,t)=>setTimeout(()=>t(Error(`Request timeout after ${this.config.requestTimeout}ms`)),this.config.requestTimeout))]):e()}onSuccess(){this.lastSuccess=new Date,"HALF_OPEN"===this.state?(this.successes++,this.successes>=this.config.successThreshold&&this.transitionTo("CLOSED")):"CLOSED"===this.state&&this.pruneOldFailures()}onFailure(e){this.failedRequests++,this.lastFailure=new Date,this.failures.push({timestamp:Date.now()}),t.warn({circuit:this.config.name,state:this.state,error:e instanceof Error?e.message:"Unknown error",failureCount:this.failures.length},"Circuit breaker recorded failure"),"HALF_OPEN"===this.state?this.transitionTo("OPEN"):"CLOSED"===this.state&&(this.pruneOldFailures(),this.failures.length>=this.config.failureThreshold&&this.transitionTo("OPEN"))}shouldAttemptReset(){return!this.openedAt||Date.now()-this.openedAt.getTime()>=this.config.resetTimeout}pruneOldFailures(){let e=Date.now()-this.config.failureWindow;this.failures=this.failures.filter(t=>t.timestamp>e)}transitionTo(e){let s=this.state;this.state=e,t.info({circuit:this.config.name,from:s,to:e,failures:this.failures.length,successes:this.successes},"Circuit breaker state transition"),"OPEN"===e?this.openedAt=new Date:"CLOSED"===e?(this.failures=[],this.successes=0,this.openedAt=void 0):"HALF_OPEN"===e&&(this.successes=0)}getStats(){return{name:this.config.name,state:this.state,failures:this.failures.length,successes:this.successes,lastFailure:this.lastFailure,lastSuccess:this.lastSuccess,openedAt:this.openedAt,totalRequests:this.totalRequests,failedRequests:this.failedRequests,successRate:this.totalRequests>0?(this.totalRequests-this.failedRequests)/this.totalRequests:1}}reset(){this.transitionTo("CLOSED"),this.totalRequests=0,this.failedRequests=0,t.info({circuit:this.config.name},"Circuit breaker manually reset")}isAllowingRequests(){return"CLOSED"===this.state||"HALF_OPEN"===this.state||this.shouldAttemptReset()}}class r extends Error{circuitName;constructor(e,t){super(e),this.circuitName=t,this.name="CircuitBreakerError"}}let i=new Map;function a(e){let r=i.get(e.name);return r||(r=new s(e),i.set(e.name,r),t.info({circuit:e.name},"Created new circuit breaker")),r}function n(){return Array.from(i.values()).map(e=>e.getStats())}a({name:"x402scan",failureThreshold:3,successThreshold:2,resetTimeout:6e4,failureWindow:3e5,requestTimeout:3e4}),a({name:"scattering",failureThreshold:3,successThreshold:2,resetTimeout:6e4,failureWindow:3e5,requestTimeout:3e4}),a({name:"facilitator-probes",failureThreshold:5,successThreshold:3,resetTimeout:3e4,failureWindow:12e4,requestTimeout:1e4}),e.s(["getAllCircuitBreakerStats",()=>n,"getCircuitBreaker",()=>a])},2759,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__7ebfd264._.js","server/chunks/node_modules_@upstash_redis_nodejs_mjs_85cd95da._.js"].map(t=>e.l(t))).then(()=>t(58119)))},6538,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__bc7866ad._.js","server/chunks/[root-of-the-server]__bbbc7a9e._.js","server/chunks/node_modules_@ioredis_commands_built_commands_json_862661ff._.js"].map(t=>e.l(t))).then(()=>t(42512)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fe66eccf._.js.map