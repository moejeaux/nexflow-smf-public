module.exports=[22734,(e,t,a)=>{t.exports=e.x("fs",()=>require("fs"))},30056,e=>e.a(async(t,a)=>{try{let t=await e.y("pg");e.n(t),a()}catch(e){a(e)}},!0),93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},14747,(e,t,a)=>{t.exports=e.x("path",()=>require("path"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},54799,(e,t,a)=>{t.exports=e.x("crypto",()=>require("crypto"))},68237,e=>e.a(async(t,a)=>{try{var n=e.i(54799),i=e.i(24924),r=t([i]);function s(e){return n.default.createHash("sha256").update(e).digest("hex")}async function o(e){let t,a=(0,i.getDb)(),r=`key_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,o=(t=n.default.randomBytes(32).toString("base64url"),`nf_live_${t}`),l=s(o),d=new Date().toISOString(),u={id:r,keyHash:l,name:e.name,role:e.role||"user",userId:e.userId,rateLimit:e.rateLimit||1e3,expiresAt:e.expiresAt,createdAt:d,updatedAt:d};return await a.createApiKey(u),{...u,token:o}}async function l(e){let t=(0,i.getDb)();return await t.findApiKeyByHash(e)}async function d(e){let t=s(e);return await l(t)}async function u(e,t){let a=(0,i.getDb)();await a.updateApiKeyLastUsed(e,t)}async function c(e){let t=(0,i.getDb)();return await t.revokeApiKey(e)}async function p(e){let t=(0,i.getDb)();return await t.listApiKeys(e)}async function m(e,t,a){let n=(0,i.getDb)();await n.updateApiKeyX402DemoAllowance(e,t,a)}function y(e){let t=e.x402DemoCallsUsed||0,a=e.x402DemoCallsLimit||200,n=BigInt(e.x402DemoAmountUsed||"0"),i=BigInt(e.x402DemoAmountLimit||"1000000");return t>=a?{hasAllowance:!1,callsRemaining:0,amountRemaining:"0",reason:"Calls limit reached"}:n>=i?{hasAllowance:!1,callsRemaining:a-t,amountRemaining:"0",reason:"Amount limit reached"}:{hasAllowance:!0,callsRemaining:a-t,amountRemaining:(i-n).toString()}}async function h(e,t,a){let n=(0,i.getDb)();await n.updateApiKeyX402DemoLimits(e,t,a)}async function g(e){return(await p()).find(t=>t.id===e)||null}[i]=r.then?(await r)():r,e.s(["createApiKey",()=>o,"findApiKeyById",()=>g,"findApiKeyByToken",()=>d,"hasX402DemoAllowance",()=>y,"listApiKeys",()=>p,"revokeApiKey",()=>c,"updateApiKeyLastUsed",()=>u,"updateApiKeyX402DemoAllowance",()=>m,"updateApiKeyX402DemoLimits",()=>h]),a()}catch(e){a(e)}},!1),49741,e=>e.a(async(t,a)=>{try{var n=e.i(54799),i=e.i(24924),r=t([i]);async function s(e){var t;let a,r,s=(0,i.getDb)(),o=new Date().toISOString(),l=n.default.randomUUID(),d=(t=e.password,a=n.default.randomBytes(16).toString("hex"),r=n.default.pbkdf2Sync(t,a,1e5,64,"sha512").toString("hex"),`${a}:${r}`);await s.query(`
    INSERT INTO accounts (id, email, password_hash, name, status, email_verified, created_at, updated_at)
    VALUES ($1, $2, $3, $4, 'active', false, $5, $5)
  `,[l,e.email.toLowerCase(),d,e.name||null,o]);let u=(await s.query("SELECT daily_limit, monthly_limit FROM plans WHERE id = 'free'")).rows[0]||{daily_limit:1e3,monthly_limit:1e4};return await s.query(`
    INSERT INTO account_plans (account_id, plan_id, daily_limit, monthly_limit, started_at, is_current)
    VALUES ($1, 'free', $2, $3, $4, true)
  `,[l,u.daily_limit,u.monthly_limit,o]),{id:l,email:e.email.toLowerCase(),passwordHash:d,name:e.name,status:"active",emailVerified:!1,createdAt:o,updatedAt:o,plan:{name:"free",dailyLimit:u.daily_limit,monthlyLimit:u.monthly_limit}}}async function o(e){let t=(0,i.getDb)(),a=await t.query("SELECT * FROM accounts WHERE email = $1",[e.toLowerCase()]);if(0===a.rows.length)return null;let n=a.rows[0];return{id:n.id,email:n.email,passwordHash:n.password_hash,name:n.name||void 0,status:n.status,emailVerified:n.email_verified,createdAt:n.created_at,updatedAt:n.updated_at}}async function l(e){let t=(0,i.getDb)(),a=await t.query(`
    SELECT a.*, ap.plan_id, p.name as plan_name, ap.daily_limit, ap.monthly_limit
    FROM accounts a
    JOIN account_plans ap ON a.id = ap.account_id AND ap.is_current = true
    JOIN plans p ON ap.plan_id = p.id
    WHERE a.id = $1
  `,[e]);if(0===a.rows.length)return null;let n=a.rows[0];return{id:n.id,email:n.email,passwordHash:n.password_hash,name:n.name||void 0,status:n.status,emailVerified:n.email_verified,createdAt:n.created_at,updatedAt:n.updated_at,plan:{name:n.plan_name,dailyLimit:n.daily_limit,monthlyLimit:n.monthly_limit}}}async function d(e){let t=(0,i.getDb)(),a=n.default.randomUUID(),r=new Date().toISOString();return await t.query(`
    INSERT INTO usage_events (id, account_id, api_key_id, endpoint, method, status_code, billable_units, response_time_ms, ip_address, user_agent, timestamp)
    VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)
  `,[a,e.accountId,e.apiKeyId,e.endpoint,e.method,e.statusCode,e.billableUnits,e.responseTimeMs||null,e.ipAddress||null,e.userAgent||null,r]),{...e,id:a,timestamp:r}}async function u(e){let t=(0,i.getDb)(),a=await t.query(`
    SELECT p.name as plan_name, ap.daily_limit, ap.monthly_limit
    FROM account_plans ap
    JOIN plans p ON ap.plan_id = p.id
    WHERE ap.account_id = $1 AND ap.is_current = true
  `,[e]);if(0===a.rows.length)throw Error("Account plan not found");let n=a.rows[0],r=await t.query(`
    SELECT COALESCE(SUM(billable_units), 0) as count
    FROM usage_events
    WHERE account_id = $1 AND timestamp >= CURRENT_DATE
  `,[e]),s=await t.query(`
    SELECT COALESCE(SUM(billable_units), 0) as count
    FROM usage_events
    WHERE account_id = $1 AND timestamp >= DATE_TRUNC('month', CURRENT_DATE)
  `,[e]),o=parseInt(r.rows[0]?.count||"0",10),l=parseInt(s.rows[0]?.count||"0",10);return{today:{used:o,remaining:Math.max(0,n.daily_limit-o)},month:{used:l,remaining:Math.max(0,n.monthly_limit-l)},plan:{name:n.plan_name,dailyLimit:n.daily_limit,monthlyLimit:n.monthly_limit}}}[i]=r.then?(await r)():r,e.s(["createAccount",()=>s,"findAccountByEmail",()=>o,"getAccountWithPlan",()=>l,"getUsageSummary",()=>u,"logUsageEvent",()=>d]),a()}catch(e){a(e)}},!1),84394,e=>e.a(async(t,a)=>{try{var n=e.i(89171),i=e.i(22632),r=e.i(49741),s=e.i(68237),o=t([r,s]);[r,s]=o.then?(await o)():o;let u=i.z.object({email:i.z.string().email("Invalid email address"),password:i.z.string().min(8,"Password must be at least 8 characters").max(128,"Password must be at most 128 characters").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain at least one uppercase letter, one lowercase letter, and one number"),name:i.z.string().min(1).max(100).optional()});async function l(e){try{let t=await e.json(),a=u.safeParse(t);if(!a.success)return n.NextResponse.json({error:"Validation failed",code:"VALIDATION_ERROR",details:a.error.issues.map(e=>({field:e.path.join("."),message:e.message}))},{status:400});let{email:i,password:o,name:l}=a.data;if(await (0,r.findAccountByEmail)(i))return n.NextResponse.json({error:"Email already registered",code:"EMAIL_EXISTS"},{status:409});let d=await (0,r.createAccount)({email:i,password:o,name:l}),c=await (0,s.createApiKey)({name:"Default API Key",role:"user",userId:d.id,rateLimit:1e3});return n.NextResponse.json({success:!0,accountId:d.id,plan:{name:d.plan.name,dailyLimit:d.plan.dailyLimit,monthlyLimit:d.plan.monthlyLimit},apiKey:{id:c.id,name:c.name,token:c.token},message:"Account created successfully. Welcome to NexFlow!"},{status:201})}catch(e){if(console.error("[auth/signup] Error:",e),e.message?.includes("UNIQUE constraint")||"23505"===e.code)return n.NextResponse.json({error:"Email already registered",code:"EMAIL_EXISTS"},{status:409});return n.NextResponse.json({error:"Failed to create account",code:"INTERNAL_ERROR",details:void 0},{status:500})}}async function d(){return new n.NextResponse(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}e.s(["OPTIONS",()=>d,"POST",()=>l]),a()}catch(e){a(e)}},!1),65629,e=>e.a(async(t,a)=>{try{var n=e.i(47909),i=e.i(74017),r=e.i(96250),s=e.i(59756),o=e.i(61916),l=e.i(14444),d=e.i(37092),u=e.i(69741),c=e.i(16795),p=e.i(87718),m=e.i(95169),y=e.i(47587),h=e.i(66012),g=e.i(70101),w=e.i(26937),f=e.i(10372),A=e.i(93695);e.i(52474);var R=e.i(220),_=e.i(84394),E=t([_]);[_]=E.then?(await E)():E;let C=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/v1/auth/signup/route",pathname:"/api/v1/auth/signup",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/auth/signup/route.ts",nextConfigOutput:"standalone",userland:_}),{workAsyncStorage:S,workUnitAsyncStorage:N,serverHooks:b}=C;function x(){return(0,r.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:N})}async function v(e,t,a){C.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/v1/auth/signup/route";n=n.replace(/\/index$/,"")||"/";let r=await C.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!r)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:_,params:E,nextConfig:x,parsedUrl:v,isDraftMode:S,prerenderManifest:N,routerServerContext:b,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,resolvedPathname:O,clientReferenceManifest:D,serverActionsManifest:L}=r,$=(0,u.normalizeAppPath)(n),U=!!(N.dynamicRoutes[$]||N.routes[O]),P=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,v,!1):t.end("This page could not be found"),null);if(U&&!S){let e=!!N.routes[O],t=N.dynamicRoutes[$];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await P();throw new A.NoFallbackError}}let q=null;!U||C.isDev||S||(q=O,q="/index"===q?"/":q);let M=!0===C.isDev||!U,k=U&&!M;L&&D&&(0,l.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:D,serverActionsManifest:L,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:L})});let H=e.method||"GET",K=(0,o.getTracer)(),j=K.getActiveScopeSpan(),F={params:E,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>C.onRequestError(e,t,n,b)},sharedContext:{buildId:_}},B=new c.NodeNextRequest(e),V=new c.NodeNextResponse(t),W=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let r=async e=>C.handle(W,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=K.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let t=`${H} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${n}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var o,d;let u=async({previousCacheEntry:i})=>{try{if(!l&&T&&I&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await r(s);e.fetchMetrics=F.renderOpts.fetchMetrics;let o=F.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let d=F.renderOpts.collectedTags;if(!U)return await (0,h.sendResponse)(B,V,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,i=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,y.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:T})},b),t}},c=await C.handleResponse({req:e,nextConfig:x,cacheKey:q,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:l});if(!U)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",T?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&U||p.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,w.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(B,V,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};j?await d(j):await K.withPropagatedContext(e.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${H} ${n}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},d))}catch(t){if(t instanceof A.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:$,routeType:"route",revalidateReason:(0,y.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:T})}),U)throw t;return await (0,h.sendResponse)(B,V,new Response(null,{status:500})),null}}e.s(["handler",()=>v,"patchFetch",()=>x,"routeModule",()=>C,"serverHooks",()=>b,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>N]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__7120853b._.js.map