module.exports=[9883,e=>{"use strict";let t=[{id:"cdp-base-usdc",facilitatorId:"cdp",network:"eip155:8453",token:"USDC",desiredIntervalSeconds:parseInt(process.env.CDP_PROBE_INTERVAL_SECONDS||"30",10),enabled:!1},{id:"payai-base-usdc",facilitatorId:"payai",network:"eip155:8453",token:"USDC",desiredIntervalSeconds:parseInt(process.env.PAYAI_PROBE_INTERVAL_SECONDS||"120",10),enabled:!1},{id:"x402rs-base-usdc",facilitatorId:"x402rs",network:"eip155:8453",token:"USDC",desiredIntervalSeconds:parseInt(process.env.X402RS_PROBE_INTERVAL_SECONDS||"60",10),enabled:!1},{id:"x402rs-xdc-usdc",facilitatorId:"x402rs",network:"xdc:50",token:"USDC",desiredIntervalSeconds:parseInt(process.env.X402RS_PROBE_INTERVAL_SECONDS||"120",10),enabled:!1},{id:"dexter-solana-usdc",facilitatorId:"dexter",network:"solana:101",token:"USDC",desiredIntervalSeconds:parseInt(process.env.DEXTER_PROBE_INTERVAL_SECONDS||"60",10),enabled:!1},{id:"dexter-solana-devnet-usdc",facilitatorId:"dexter",network:"solana:102",token:"USDC",desiredIntervalSeconds:parseInt(process.env.DEXTER_PROBE_INTERVAL_SECONDS||"120",10),enabled:!1},{id:"cronos-mainnet-usdc",facilitatorId:"cronos",network:"eip155:25",token:"USDC",desiredIntervalSeconds:parseInt(process.env.CRONOS_PROBE_INTERVAL_SECONDS||"60",10),enabled:!1},{id:"cronos-testnet-usdc",facilitatorId:"cronos",network:"eip155:338",token:"USDC",desiredIntervalSeconds:parseInt(process.env.CRONOS_PROBE_INTERVAL_SECONDS||"120",10),enabled:!1}];function r(){return t.filter(e=>e.enabled)}e.s(["getEnabledProbeConfigs",()=>r])},92660,e=>{"use strict";let t=(0,e.i(50377).createLogger)({component:"RunSingleFacilitatorProbe"});async function r(r){let{facilitatorId:o,network:n,token:a}=r,i=Date.now();try{let{getFacilitatorRouter:s}=await e.A(89416),l=s().getFacilitators().find(e=>e.id===o);if(!l)return{ok:!1,errorCode:"facilitator_not_found",errorMessage:`Facilitator ${o} not found in router`,latencyMs:Date.now()-i};let{buildProbeRequirements:d}=await e.A(87838),c=d(o,n,a),u={signature:"0x0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",authorization:{from:"0x0000000000000000000000000000000000000000",to:"0x0000000000000000000000000000000000000000",value:"1000000",validAfter:Math.floor(Date.now()/1e3).toString(),validBefore:(Math.floor(Date.now()/1e3)+300).toString(),nonce:"0x"+"0".repeat(64)},network:n,isProbe:!0},p=JSON.stringify(u),f=Buffer.from(p,"utf-8").toString("base64"),v=`x402 ${f}`;t.info({component:"RunSingleFacilitatorProbe",probeConfigId:r.id,facilitatorId:o,network:n,token:a,paymentHeaderPreview:v.slice(0,80),paymentJsonPreview:p.slice(0,200),msg:"Built facilitator payment header for probe"});try{let e=Buffer.from(f,"base64").toString("utf-8");e!==p&&t.error({probeConfigId:r.id},"Payment header encoding verification failed - decoded value does not match original"),JSON.parse(e)}catch(e){t.error({error:e,probeConfigId:r.id,paymentHeaderPreview:f.slice(0,50)},"Failed to verify payment header encoding - header may be corrupted")}try{let e=await l.verify(v,c),r=Date.now()-i,s={success:e.success,valid:e.valid,error:e.error,errorDetails:e.errorDetails,facilitatorId:e.facilitatorId,httpStatus:e.errorDetails?.httpStatus,errorCode:e.errorDetails?.errorCode,errorType:e.errorDetails?.errorType,responseBody:e.errorDetails?.cdpResponse||e.errorDetails?.payaiResponse||e.errorDetails?.responseBody};if(e.success&&e.valid)return t.info({probeConfigId:`${o}-${n}-${a}`,facilitatorId:o,network:n,token:a,success:!0,valid:!0},"Facilitator verification SUCCESS"),console.log(`[PROBE SUCCESS] ${o}: Valid payment verified`),{ok:!0,latencyMs:r};let d=(e.error||"").toLowerCase();if(["invalid_payload","invalid_signature","invalid_exact_evm_payload","insufficient_funds","invalid_exact_evm_payload_authorization"].some(e=>d.includes(e)))return t.info({probeConfigId:`${o}-${n}-${a}`,facilitatorId:o,network:n,token:a,probeSuccess:!0,facilitatorResponse:e.error,msg:"PROBE HEALTHY - Facilitator rejected dummy signature as expected"}),console.log(`[PROBE SUCCESS] ${o}: Healthy (rejected dummy signature: ${e.error})`),{ok:!0,latencyMs:r,note:`Expected probe error: ${e.error}`};t.info({probeConfigId:`${o}-${n}-${a}`,facilitatorId:o,network:n,token:a,...s},"Facilitator verification response (unexpected)"),console.error(`[PROBE FAILURE] ${o}:`,JSON.stringify(s,null,2));{let t=(e.error||"").toLowerCase(),o="facilitator_error",n=e.error||"Unknown error";if(e.errorDetails){let t=JSON.stringify(e.errorDetails,null,2);n+=` | Response details: ${t}`}o=e.errorDetails?.errorCode?e.errorDetails.errorCode:t.includes("invalid json")||t.includes("invalid payment")||t.includes("malformed")||t.includes("parse error")||t.includes("unexpected token")||t.includes("not valid json")||t.includes("invalid_request")?"invalid_request":t.includes("timeout")||t.includes("network")||t.includes("econnrefused")||t.includes("network_error")?"network_error":t.includes("does not support")||t.includes("unsupported")||t.includes("not supported")?"invalid_request":t.includes("rate")||t.includes("429")||t.includes("too many requests")||t.includes("rate_limited")?"rate_limited":"facilitator_error";let a=e.errorDetails?.httpStatus,i=e.errorDetails?.errorCode||e.errorDetails?.code||e.errorDetails?.errorType||void 0;return{ok:!1,errorCode:o,errorMessage:n,facilitatorStatus:a,facilitatorErrorCode:i,latencyMs:r}}}catch(u){let e=Date.now()-i,r=u instanceof Error?u.message:"Unknown error",s=r.toLowerCase(),l=u instanceof Error?u.stack:void 0,d=u instanceof Error?u.name:void 0;t.error({error:u,errorMessage:r,errorStack:l,errorName:d,facilitatorId:o,network:n,token:a,probePayment:v},"Facilitator verification threw exception"),console.error(`[FACILITATOR EXCEPTION] ${o}:`,{message:r,name:d,stack:l,network:n,token:a});let c="probe_exception";return s.includes("timeout")||s.includes("timed out")?c="timeout":s.includes("rate")||s.includes("429")||s.includes("too many requests")?c="rate_limited":s.includes("network")||s.includes("econnrefused")||s.includes("connection")?c="network_error":s.includes("invalid json")||s.includes("invalid payment")||s.includes("malformed")||s.includes("parse error")?c="invalid_request":(s.includes("does not support")||s.includes("unsupported")||err.includes("not supported"))&&(c="invalid_request"),{ok:!1,errorCode:c,errorMessage:r,latencyMs:e}}}catch(s){let e=Date.now()-i,r=s instanceof Error?s.message:"Unknown error";return t.error({error:s,facilitatorId:o,network:n,token:a},"Probe execution error"),{ok:!1,errorCode:"probe_exception",errorMessage:r,latencyMs:e}}}e.s(["runSingleFacilitatorProbe",()=>r])},53155,e=>e.a(async(t,r)=>{try{e.i(9883);var o=e.i(60827),n=e.i(26436);e.i(92660);var a=e.i(50377),i=t([o,n]);[o,n]=i.then?(await i)():i,(0,a.createLogger)({component:"RunFacilitatorHealthProbes"}),e.s([]),r()}catch(e){r(e)}},!1),69918,e=>e.a(async(t,r)=>{try{var o=e.i(24924),n=e.i(50377),a=t([o]);[o]=a.then?(await a)():a,(0,n.createLogger)({component:"FacilitatorProbeStateRepo"}),e.s([]),r()}catch(e){r(e)}},!1),47062,e=>e.a(async(t,r)=>{try{var o=e.i(53155),n=e.i(69918),a=e.i(50377),i=e.i(7484),s=t([o,n,i]);[o,n,i]=s.then?(await s)():s;let d=(0,a.createLogger)({component:"FacilitatorProbesCron"});async function l(e,t){let{runId:r,requestId:o}=t;return d.info({runId:r,requestId:o,msg:"Skipping facilitator probes - HARD DISABLED in code"}),{ok:!0,skipped:!0,reason:"hard-disabled",message:"Facilitator probes are HARD DISABLED in code. Edit route.ts to re-enable."}}let c=(0,i.withCronJobTracking)(l,{jobId:"facilitator-probes",enabledEnvVar:"FACILITATOR_PROBES_ENABLED",timeout:55e3,minInterval:5e4});e.s(["GET",0,c,"dynamic",0,"force-dynamic","maxDuration",0,60]),r()}catch(e){r(e)}},!1),25628,e=>e.a(async(t,r)=>{try{var o=e.i(47909),n=e.i(74017),a=e.i(96250),i=e.i(59756),s=e.i(61916),l=e.i(14444),d=e.i(37092),c=e.i(69741),u=e.i(16795),p=e.i(87718),f=e.i(95169),v=e.i(47587),R=e.i(66012),E=e.i(70101),h=e.i(26937),m=e.i(10372),S=e.i(93695);e.i(52474);var g=e.i(220),C=e.i(47062),w=t([C]);[C]=w.then?(await w)():w;let b=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/cron/facilitator-probes/route",pathname:"/api/cron/facilitator-probes",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/cron/facilitator-probes/route.ts",nextConfigOutput:"standalone",userland:C}),{workAsyncStorage:I,workUnitAsyncStorage:D,serverHooks:x}=b;function y(){return(0,a.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:D})}async function _(e,t,r){b.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let o="/api/cron/facilitator-probes/route";o=o.replace(/\/index$/,"")||"/";let a=await b.prepare(e,t,{srcPage:o,multiZoneDraftMode:!1});if(!a)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:C,params:w,nextConfig:y,parsedUrl:_,isDraftMode:I,prerenderManifest:D,routerServerContext:x,isOnDemandRevalidate:A,revalidateOnlyGenerated:O,resolvedPathname:P,clientReferenceManifest:k,serverActionsManifest:N}=a,T=(0,c.normalizeAppPath)(o),U=!!(D.dynamicRoutes[T]||D.routes[P]),B=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,_,!1):t.end("This page could not be found"),null);if(U&&!I){let e=!!D.routes[P],t=D.dynamicRoutes[T];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await B();throw new S.NoFallbackError}}let L=null;!U||b.isDev||I||(L=P,L="/index"===L?"/":L);let $=!0===b.isDev||!U,F=U&&!$;N&&k&&(0,l.setReferenceManifestsSingleton)({page:o,clientReferenceManifest:k,serverActionsManifest:N,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:N})});let H=e.method||"GET",q=(0,s.getTracer)(),M=q.getActiveScopeSpan(),j={params:w,prerenderManifest:D,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,o)=>b.onRequestError(e,t,o,x)},sharedContext:{buildId:C}},V=new u.NodeNextRequest(e),K=new u.NodeNextResponse(t),X=p.NextRequestAdapter.fromNodeNextRequest(V,(0,p.signalFromNodeResponse)(t));try{let a=async e=>b.handle(X,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=q.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==f.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${o}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var s,d;let c=async({previousCacheEntry:n})=>{try{if(!l&&A&&O&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await a(i);e.fetchMetrics=j.renderOpts.fetchMetrics;let s=j.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let d=j.renderOpts.collectedTags;if(!U)return await (0,R.sendResponse)(V,K,o,j.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,E.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,n=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:o,routeType:"route",revalidateReason:(0,v.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:A})},x),t}},u=await b.handleResponse({req:e,nextConfig:y,cacheKey:L,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:D,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:O,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:l});if(!U)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",A?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,E.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&U||p.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,R.sendResponse)(V,K,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};M?await d(M):await q.withPropagatedContext(e.headers,()=>q.trace(f.BaseServerSpan.handleRequest,{spanName:`${H} ${o}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},d))}catch(t){if(t instanceof S.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,v.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:A})}),U)throw t;return await (0,R.sendResponse)(V,K,new Response(null,{status:500})),null}}e.s(["handler",()=>_,"patchFetch",()=>y,"routeModule",()=>b,"serverHooks",()=>x,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>D]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=_c8db7ecd._.js.map