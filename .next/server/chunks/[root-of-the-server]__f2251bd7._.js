module.exports=[93695,(e,t,s)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},22734,(e,t,s)=>{t.exports=e.x("fs",()=>require("fs"))},30056,e=>e.a(async(t,s)=>{try{let t=await e.y("pg");e.n(t),s()}catch(e){s(e)}},!0),14747,(e,t,s)=>{t.exports=e.x("path",()=>require("path"))},70406,(e,t,s)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,s)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,s)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,s)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,s)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,s)=>{t.exports=e.x("util",()=>require("util"))},87769,(e,t,s)=>{t.exports=e.x("node:events",()=>require("node:events"))},49719,(e,t,s)=>{t.exports=e.x("assert",()=>require("assert"))},27699,(e,t,s)=>{t.exports=e.x("events",()=>require("events"))},92509,(e,t,s)=>{t.exports=e.x("url",()=>require("url"))},874,(e,t,s)=>{t.exports=e.x("buffer",()=>require("buffer"))},62562,(e,t,s)=>{t.exports=e.x("module",()=>require("module"))},50227,(e,t,s)=>{t.exports=e.x("node:path",()=>require("node:path"))},94346,e=>{e.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},37702,(e,t,s)=>{t.exports=e.x("worker_threads",()=>require("worker_threads"))},60526,(e,t,s)=>{t.exports=e.x("node:os",()=>require("node:os"))},77652,(e,t,s)=>{t.exports=e.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},41500,e=>e.a(async(t,s)=>{try{var a=e.i(50377),r=e.i(87768),n=e.i(3004),o=t([r,n]);[r,n]=o.then?(await o)():o;let p=(0,a.createLogger)({component:"FacilitatorMetricsReader"}),u={maxDataAgeHours:parseFloat(process.env.METRICS_MAX_AGE_HOURS??"4"),minInvocationsHighConfidence:parseInt(process.env.METRICS_MIN_INVOCATIONS_HIGH??"1000",10),minInvocationsMinimum:parseInt(process.env.METRICS_MIN_INVOCATIONS??"100",10),lowConfidencePenalty:parseFloat(process.env.METRICS_LOW_CONFIDENCE_PENALTY??"0.5")},m=parseFloat(process.env.SCATTERING_SCORE_WEIGHT??"0.2"),h=parseInt(process.env.SCATTERING_MIN_TX_COUNT??"100",10),x=parseFloat(process.env.SCATTERING_MIN_VOLUME??"100"),f=1-m;async function i(e){let t=e.timeframe??"1d",s=[];try{let a,o,i,c,d,l,u=await (0,r.getSummary)(e.facilitatorId,t),g=50,v=0,y=1/0,I=0,F=!1;if(u){F=!0;let e=50*(v=1-u.overallErrorRate);s.push(`success-rate:${(100*v).toFixed(1)}%`);let t=30,r=u.avgP90LatencyMs??u.avgP99LatencyMs;if(void 0!==r){let e=Math.min(r,2e3)/2e3;t=(1-e)*30,s.push(`p95-latency:${r.toFixed(0)}ms`),o=u.avgP90LatencyMs}else t=15,s.push("latency:unknown");let n=Math.min(u.totalInvocations/1e3,1);I=u.totalInvocations,s.push(`x402scan:${u.totalInvocations}/${u.totalInvocations>=1e3?"high":u.totalInvocations>=100?"medium":"low"}-confidence`);let i=new Date(u.fetchedAt);y=(Date.now()-i.getTime())/36e5;let c=Math.max(0,1-y/24);g=e+t+10*n+10*c,a=u.avgP50LatencyMs}else s.push("x402scan:no-data");let w=0,k=!1,b=!1;try{let t=await (0,n.getScatteringMetricsForFacilitator)(e.facilitatorId);t?(b=!0,i=t.volumeUsd3d,c=t.txCount3d,d=t.uniqueBuyers3d,t.txCount3d<h&&t.volumeUsd3d<x?(k=!0,w=.1,s.push(`scattering-low-activity:${t.txCount3d}tx/$${t.volumeUsd3d.toFixed(0)}`)):(w=(0,n.computeActivityScore)(t),s.push(`scattering-activity:${w.toFixed(2)}`))):s.push("scattering:no-data")}catch(t){p.debug({error:t instanceof Error?t.message:"Unknown",facilitatorId:e.facilitatorId,msg:"Failed to fetch Scattering metrics for scoring"}),s.push("scattering:error")}l=F&&b?f*g+m*w*100:F?g:b?100*w:50;let M="none";return F?M=I>=1e3&&y<6?"high":I>=100&&y<24?"medium":"low":b&&!k&&(M=w>.5?"medium":"low"),{facilitatorId:e.facilitatorId,score:Math.round(l),successRate:v,avgLatencyMs:a,p95LatencyMs:o,totalInvocations:I,dataFreshness:y,confidence:M,reasons:s,scatteringActivityScore:b?w:void 0,scatteringVolume3d:i,scatteringTxCount3d:c,scatteringUniqueBuyers3d:d,scatteringLowActivity:k||void 0}}catch(t){return p.error({error:t instanceof Error?t.message:"Unknown error",facilitatorId:e.facilitatorId,msg:"Failed to get facilitator score"}),null}}async function c(e,t="1d",s=u){let a=[],r=[];for(let n of e){let e=await i({facilitatorId:n,timeframe:t});if(!e){r.push({id:n,reason:"no-data"});continue}let o=function(e,t,s=u){return e>s.maxDataAgeHours?{trust:!1,confidence:"none",reason:`data-stale:${e.toFixed(1)}h-old`}:t<s.minInvocationsMinimum?{trust:!1,confidence:"none",reason:`insufficient-data:${t}-invocations`}:t>=s.minInvocationsHighConfidence?{trust:!0,confidence:"high",reason:`high-confidence:${t}-invocations`}:{trust:!0,confidence:"medium",reason:`medium-confidence:${t}-invocations`}}(e.dataFreshness,e.totalInvocations,s);if(!o.trust){r.push({id:n,reason:o.reason}),a.push({...e,score:e.score*s.lowConfidencePenalty,confidence:"low",reasons:[...e.reasons,`untrusted:${o.reason}`]});continue}"medium"===o.confidence?a.push({...e,score:.9*e.score,confidence:"medium",reasons:[...e.reasons,o.reason]}):a.push({...e,reasons:[...e.reasons,o.reason]})}return r.length>0&&p.debug({untrusted:r,trusted:a.filter(e=>"low"!==e.confidence).map(e=>e.facilitatorId),msg:"Facilitator metrics trust check results"}),a.sort((e,t)=>t.score-e.score),{rankings:a,timestamp:new Date().toISOString(),timeframe:t}}async function d(e,t){let s,a=t?.timeframe??"1d",r=t?.trustConfig??u,n=await c(e,a,r),o=n.rankings.filter(e=>"low"!==e.confidence);if(0===o.length)return p.warn({candidates:e,rankings:n.rankings.map(e=>({id:e.facilitatorId,confidence:e.confidence,reasons:e.reasons})),msg:"No trusted x402scan data available, using fallback"}),{recommended:e[0]??null,ranking:n,reason:"No trusted x402scan data (stale or insufficient), using default order",usedFallback:!0};switch(t?.prioritize??"balanced"){case"latency":s=o.filter(e=>void 0!==e.p95LatencyMs).sort((e,t)=>(e.p95LatencyMs??1/0)-(t.p95LatencyMs??1/0))[0]??o[0];break;case"reliability":s=[...o].sort((e,t)=>t.successRate-e.successRate)[0];break;default:s=o[0]}return{recommended:s.facilitatorId,ranking:n,reason:`Selected ${s.facilitatorId} with score ${s.score} (${s.confidence} confidence, ${s.reasons.slice(0,3).join(", ")})`,usedFallback:!1}}async function l(e,t){let s=t?.timeframe??"1d",a=t?.wasSelected??!1,r=await i({facilitatorId:e,timeframe:s});if(!r)return{facilitatorId:e,selected:a,score:50,confidence:"low",shortReason:`${e}: no x402scan data available`,detailedReasons:["No observability data from x402scan"],metrics:{}};let n=(100*r.successRate).toFixed(1),o=r.p95LatencyMs?`${r.p95LatencyMs.toFixed(0)}ms p95`:"latency unknown",c=r.totalInvocations>=1e3?`${(r.totalInvocations/1e3).toFixed(1)}K invocations`:`${r.totalInvocations} invocations`,d=`${e}: ${n}% success, ${o}, ${r.confidence} confidence (${c})`,l=[];return r.successRate>=.99?l.push(`Excellent success rate: ${n}%`):r.successRate>=.95?l.push(`Good success rate: ${n}%`):r.successRate>=.9?l.push(`Acceptable success rate: ${n}%`):l.push(`⚠️ Low success rate: ${n}%`),void 0!==r.p95LatencyMs&&(r.p95LatencyMs<200?l.push(`Fast response times: ${r.p95LatencyMs.toFixed(0)}ms p95`):r.p95LatencyMs<500?l.push(`Moderate latency: ${r.p95LatencyMs.toFixed(0)}ms p95`):l.push(`⚠️ High latency: ${r.p95LatencyMs.toFixed(0)}ms p95`)),"high"===r.confidence?l.push(`High confidence: ${c}, data ${r.dataFreshness.toFixed(1)}h old`):"medium"===r.confidence?l.push(`Medium confidence: ${c}`):l.push(`Low confidence: limited data (${c})`),r.dataFreshness>12&&l.push(`⚠️ Data is ${r.dataFreshness.toFixed(1)} hours old`),{facilitatorId:e,selected:a,score:r.score,confidence:r.confidence,shortReason:d,detailedReasons:l,metrics:{successRate:r.successRate,errorRate:1-r.successRate,p95LatencyMs:r.p95LatencyMs,invocations:r.totalInvocations,dataAgeHours:r.dataFreshness}}}e.s(["getFacilitatorExplainer",()=>l,"getFacilitatorScore",()=>i,"getRecommendedFacilitator",()=>d,"rankFacilitators",()=>c]),s()}catch(e){s(e)}},!1),30344,e=>{"use strict";let t={cdp:{id:"cdp",name:"CDP x402 Facilitator",baseUrl:process.env.CDP_FACILITATOR_URL||"https://api.cdp.coinbase.com/platform/v2/x402",networks:["eip155:8453","solana:mainnet","eip155:84532","solana:devnet"],tokens:["USDC"],feeBps:0,priority:100},payai:{id:"payai",name:"PayAI Facilitator",baseUrl:process.env.PAYAI_FACILITATOR_URL||"https://facilitator.payai.network",networks:["eip155:1","eip155:8453","eip155:56","eip155:137","solana:mainnet"],tokens:["USDC"],feeBps:10,priority:200},x402rs:{id:"x402rs",name:"X402rs Facilitator",baseUrl:process.env.X402RS_FACILITATOR_URL||"https://facilitator.x402.rs",networks:["eip155:84532","eip155:8453","xdc:50"],tokens:["USDC"],feeBps:0,priority:150},dexter:{id:"dexter",name:"Dexter Facilitator",baseUrl:process.env.DEXTER_FACILITATOR_URL||"https://facilitator.dexter.cash",networks:["solana:101","solana:mainnet","solana:102","solana:devnet"],tokens:["USDC"],feeBps:0,priority:120},cronos:{id:"cronos",name:"Cronos x402 Facilitator",baseUrl:process.env.CRONOS_FACILITATOR_URL||"https://facilitator.cronoslabs.org",networks:["eip155:25","cronos","eip155:338","cronos-testnet"],tokens:["USDC","USDX"],feeBps:0,priority:130}};function s(){return Object.values(t)}function a(e){return Object.values(t).filter(t=>t.networks.includes(e))}e.s(["FACILITATORS",0,t,"getAllFacilitators",()=>s,"getFacilitatorsForNetwork",()=>a])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f2251bd7._.js.map