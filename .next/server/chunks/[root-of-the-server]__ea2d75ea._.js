module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},30056,e=>e.a(async(t,r)=>{try{let t=await e.y("pg");e.n(t),r()}catch(e){r(e)}},!0),14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},87769,(e,t,r)=>{t.exports=e.x("node:events",()=>require("node:events"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},49719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},62562,(e,t,r)=>{t.exports=e.x("module",()=>require("module"))},50227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},94346,e=>{e.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},37702,(e,t,r)=>{t.exports=e.x("worker_threads",()=>require("worker_threads"))},60526,(e,t,r)=>{t.exports=e.x("node:os",()=>require("node:os"))},77652,(e,t,r)=>{t.exports=e.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},68237,e=>e.a(async(t,r)=>{try{var n=e.i(54799),a=e.i(24924),o=t([a]);function i(e){return n.default.createHash("sha256").update(e).digest("hex")}async function s(e){let t,r=(0,a.getDb)(),o=`key_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,s=(t=n.default.randomBytes(32).toString("base64url"),`nf_live_${t}`),d=i(s),l=new Date().toISOString(),u={id:o,keyHash:d,name:e.name,role:e.role||"user",userId:e.userId,rateLimit:e.rateLimit||1e3,expiresAt:e.expiresAt,createdAt:l,updatedAt:l};return await r.createApiKey(u),{...u,token:s}}async function d(e){let t=(0,a.getDb)();return await t.findApiKeyByHash(e)}async function l(e){let t=i(e);return await d(t)}async function u(e,t){let r=(0,a.getDb)();await r.updateApiKeyLastUsed(e,t)}async function c(e){let t=(0,a.getDb)();return await t.revokeApiKey(e)}async function p(e){let t=(0,a.getDb)();return await t.listApiKeys(e)}async function h(e,t,r){let n=(0,a.getDb)();await n.updateApiKeyX402DemoAllowance(e,t,r)}function y(e){let t=e.x402DemoCallsUsed||0,r=e.x402DemoCallsLimit||200,n=BigInt(e.x402DemoAmountUsed||"0"),a=BigInt(e.x402DemoAmountLimit||"1000000");return t>=r?{hasAllowance:!1,callsRemaining:0,amountRemaining:"0",reason:"Calls limit reached"}:n>=a?{hasAllowance:!1,callsRemaining:r-t,amountRemaining:"0",reason:"Amount limit reached"}:{hasAllowance:!0,callsRemaining:r-t,amountRemaining:(a-n).toString()}}async function f(e,t,r){let n=(0,a.getDb)();await n.updateApiKeyX402DemoLimits(e,t,r)}async function m(e){return(await p()).find(t=>t.id===e)||null}[a]=o.then?(await o)():o,e.s(["createApiKey",()=>s,"findApiKeyById",()=>m,"findApiKeyByToken",()=>l,"hasX402DemoAllowance",()=>y,"listApiKeys",()=>p,"revokeApiKey",()=>c,"updateApiKeyLastUsed",()=>u,"updateApiKeyX402DemoAllowance",()=>h,"updateApiKeyX402DemoLimits",()=>f]),r()}catch(e){r(e)}},!1),79832,e=>e.a(async(t,r)=>{try{var n=e.i(89171),a=e.i(68237),o=t([a]);function i(e){let t=e.headers.get("x-api-key");if(t)return t.trim();let r=e.headers.get("authorization");return r?r.startsWith("Bearer ")?r.substring(7).trim():r.trim():null}async function s(e){let t=i(e);if(!t)return{error:"Authentication required",status:401};if(!t.startsWith("nf_live_")&&!t.startsWith("nf_test_"))return{error:"Invalid API key format",status:401};let r=await (0,a.findApiKeyByToken)(t);if(!r)return{error:"Invalid API key",status:401};if(r.expiresAt&&new Date(r.expiresAt)<new Date)return{error:"API key has expired",status:401};let n=e.ip||e.headers.get("x-forwarded-for")?.split(",")[0]?.trim()||e.headers.get("x-real-ip")||void 0;return(0,a.updateApiKeyLastUsed)(r.id,n).catch(e=>{console.error("[auth] Failed to update last used:",e)}),{apiKey:r}}async function d(e,t="user"){var r;let a,o=await s(e);return"error"in o?{response:n.NextResponse.json({error:o.error,code:"UNAUTHORIZED"},{status:o.status})}:(r=o.apiKey,(a={"read-only":1,user:2,admin:3})[r.role]>=a[t])?{apiKey:o.apiKey}:{response:n.NextResponse.json({error:"Insufficient permissions",code:"FORBIDDEN",details:`Required role: ${t}, your role: ${o.apiKey.role}`},{status:403})}}[a]=o.then?(await o)():o,e.s(["authenticateRequest",()=>s,"extractApiKey",()=>i,"requireAuth",()=>d]),r()}catch(e){r(e)}},!1),50848,e=>e.a(async(t,r)=>{try{var n=e.i(24924),a=t([n]);async function o(e,t=[]){let r=(0,n.getDb)();if("pool"in r&&"function"==typeof r.pool?.query){let n=r.pool;return(await n.query(e,t)).rows}if("db"in r&&"function"==typeof r.db?.prepare)return r.db.prepare(e).all(...t);if("function"==typeof r.query){let n=await r.query(e,t);return n.rows||n}if("function"==typeof r.prepare)return r.prepare(e).all(...t);throw Error("Unable to execute query: database adapter not recognized")}async function i(e,t=[]){let r=await o(e,t);return r.length>0?r[0]:null}async function s(e,t=[]){let r=(0,n.getDb)();if("pool"in r&&"function"==typeof r.pool?.query){let n=r.pool;return{rowCount:(await n.query(e,t)).rowCount}}if("db"in r&&"function"==typeof r.db?.prepare)return{changes:r.db.prepare(e).run(...t).changes};if("function"==typeof r.query)return{rowCount:(await r.query(e,t)).rowCount};if("function"==typeof r.prepare)return{changes:r.prepare(e).run(...t).changes};throw Error("Unable to execute update: database adapter not recognized")}[n]=a.then?(await a)():a,e.s(["executeQuery",()=>o,"executeQueryOne",()=>i,"executeUpdate",()=>s]),r()}catch(e){r(e)}},!1),193,e=>e.a(async(t,r)=>{try{var n=e.i(50848),a=t([n]);async function o(t){let r=`wd_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,{getDb:a}=await e.A(36784),o=a(),i="pool"in o||"function"==typeof o.pool?.query?`INSERT INTO webhook_deliveries (id, webhook_config_id, event_id, event_type, url, payload, signature, status, attempts, max_attempts, created_at)
       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)`:`INSERT INTO webhook_deliveries (id, webhook_config_id, event_id, event_type, url, payload, signature, status, attempts, max_attempts, created_at)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,s=[r,t.webhookConfigId,t.eventId,t.eventType,t.url,t.payload,t.signature,"pending",0,t.maxAttempts||3,new Date().toISOString()];return await (0,n.executeUpdate)(i,s),r}async function i(t,r,a){let{getDb:o}=await e.A(36784),i=o(),s="pool"in i||"function"==typeof i.pool?.query,d=a.nextRetryAt?"pending":"failed",l=s?`UPDATE webhook_deliveries 
       SET status = $1, attempts = $2, last_response_code = $3, last_response_body = $4, 
           error_message = $5, next_retry_at = $6, last_attempt_at = $7
       WHERE webhook_config_id = $8 AND event_id = $9`:`UPDATE webhook_deliveries 
       SET status = ?, attempts = ?, last_response_code = ?, last_response_body = ?, 
           error_message = ?, next_retry_at = ?, last_attempt_at = ?
       WHERE webhook_config_id = ? AND event_id = ?`;await (0,n.executeUpdate)(l,[d,a.attempt,a.statusCode||null,a.responseBody||null,a.errorMessage||null,a.nextRetryAt||null,new Date().toISOString(),t,r])}async function s(t){let{getDb:r}=await e.A(36784),a=r(),o="pool"in a||"function"==typeof a.pool?.query,i="SELECT * FROM webhook_deliveries WHERE 1=1",s=[],d=1;return t?.webhookConfigId&&(o?i+=` AND webhook_config_id = $${d++}`:i+=" AND webhook_config_id = ?",s.push(t.webhookConfigId)),t?.eventType&&(o?i+=` AND event_type = $${d++}`:i+=" AND event_type = ?",s.push(t.eventType)),t?.status&&(o?i+=` AND status = $${d++}`:i+=" AND status = ?",s.push(t.status)),i+=" ORDER BY created_at DESC",t?.limit?i+=` LIMIT ${t.limit}`:i+=" LIMIT 100",(0,n.executeQuery)(i,s)}async function d(e,t){return s({webhookConfigId:e,...t})}[n]=a.then?(await a)():a,e.s(["createDeliveryRecord",()=>o,"getDeliveryRecords",()=>d,"markDeliveryFailed",()=>i]),r()}catch(e){r(e)}},!1),21198,e=>e.a(async(t,r)=>{try{var n=e.i(54799),a=e.i(50377),o=e.i(193),i=t([o]);async function s(){try{let{enqueueWebhookDelivery:t}=await e.A(3441);return t}catch(e){return w.warn("Webhook queue not available (bullmq may not be installed)",{error:e}),null}}[o]=i.then?(await i)():i;let w=(0,a.createLogger)({component:"WebhookDelivery"}),g={maxAttempts:parseInt(process.env.WEBHOOK_MAX_ATTEMPTS||"5",10),baseDelay:parseInt(process.env.WEBHOOK_BASE_DELAY_MS||"1000",10),maxDelay:parseInt(process.env.WEBHOOK_MAX_DELAY_MS||"300000",10),requestTimeout:parseInt(process.env.WEBHOOK_TIMEOUT_MS||"10000",10),enableDLQ:"false"!==process.env.WEBHOOK_ENABLE_DLQ,jitterFactor:parseFloat(process.env.WEBHOOK_JITTER_FACTOR||"0.2")},b={delivered:0,failed:0,retried:0,dlqCount:0,byEndpoint:new Map,lastReset:Date.now()};function d(e,t,r=!1){Date.now()-b.lastReset>36e5&&(b.delivered=0,b.failed=0,b.retried=0,b.byEndpoint.clear(),b.lastReset=Date.now()),t?b.delivered++:b.failed++,r&&b.retried++;try{let r=new URL(e).hostname,n=b.byEndpoint.get(r)||{delivered:0,failed:0};t?n.delivered++:n.failed++,b.byEndpoint.set(r,n)}catch{}}function l(){let e=b.delivered+b.failed,t={};return b.byEndpoint.forEach((e,r)=>{let n=e.delivered+e.failed;t[r]={...e,successRate:n>0?(e.delivered/n*100).toFixed(2)+"%":"0%"}}),{delivered:b.delivered,failed:b.failed,retried:b.retried,dlqCount:b.dlqCount,successRate:e>0?(b.delivered/e*100).toFixed(2)+"%":"0%",byEndpoint:t,lastReset:new Date(b.lastReset).toISOString()}}function u(e,t){return n.default.createHmac("sha256",t).update(e).digest("hex")}async function c(e,t,r=1){let n=JSON.stringify(t),a=u(n,e.secret),o=r>1,i=Date.now();try{let l=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json","X-Webhook-Signature":a,"X-Webhook-Event":t.event,"X-Webhook-Timestamp":t.timestamp,"X-Webhook-Delivery-Id":t.id,"X-Webhook-Attempt":r.toString(),"User-Agent":"NexFlow-Webhooks/1.0"},body:n,signal:AbortSignal.timeout(g.requestTimeout)}),u=await l.text().catch(()=>""),c=Date.now()-i;if(l.ok)return d(e.url,!0,o),w.info({webhookConfigId:e.id,eventId:t.id,eventType:t.event,statusCode:l.status,latencyMs:c,attempt:r},"Webhook delivered successfully"),{success:!0,statusCode:l.status};{var s;let n=!!((s=l.status)>=500)&&!!(s<600)||408===s||429===s,a=n?p(r-1):void 0;return d(e.url,!1,o),w.warn({webhookConfigId:e.id,eventId:t.id,eventType:t.event,statusCode:l.status,responseBody:u.substring(0,200),latencyMs:c,attempt:r,retryable:n,retryDelay:a},"Webhook delivery failed"),{success:!1,statusCode:l.status,error:`HTTP ${l.status}: ${u.substring(0,100)}`,retryable:n,retryDelay:a}}}catch(c){let n,a=c instanceof Error?c.message:"Unknown error",s=c instanceof Error&&((n=c.message.toLowerCase()).includes("timeout")||n.includes("econnrefused")||n.includes("econnreset")||n.includes("enotfound")||n.includes("socket hang up")||n.includes("network")),l=s?p(r-1):void 0,u=Date.now()-i;return d(e.url,!1,o),w.error({webhookConfigId:e.id,eventId:t.id,eventType:t.event,error:a,latencyMs:u,attempt:r,retryable:s,retryDelay:l},"Webhook delivery error"),{success:!1,error:a,retryable:s,retryDelay:l}}}function p(e){let{baseDelay:t,maxDelay:r,jitterFactor:n}=g,a=t*Math.pow(2,e),o=Math.min(a,r),i=1+(Math.random()*n*2-n);return Math.round(o*i)}async function h(e,t){try{let r=JSON.stringify(t),n=u(r,e.secret);await o.createDeliveryRecord({webhookConfigId:e.id,eventId:t.id,eventType:t.event,url:e.url,payload:r,signature:n,maxAttempts:g.maxAttempts});let a=await s();a?(await a({webhookConfigId:e.id,eventId:t.id,eventType:t.event,url:e.url,payload:r,signature:n}),w.info({webhookConfigId:e.id,eventId:t.id,eventType:t.event,url:e.url,maxAttempts:g.maxAttempts},"Webhook queued for delivery")):(w.warn({webhookConfigId:e.id,eventId:t.id},"Webhook queue not available, delivering with inline retry"),await y(e,t))}catch(r){throw w.error({webhookConfigId:e.id,eventId:t.id,error:r},"Failed to queue webhook delivery"),r}}async function y(e,t){let r=1;for(;r<=g.maxAttempts;){let n=await c(e,t,r);if(n.success)return;if(!n.retryable||r>=g.maxAttempts){g.enableDLQ&&await f(e,t,n.error||"Unknown error",r),w.error({webhookConfigId:e.id,eventId:t.id,eventType:t.event,attempts:r,error:n.error,sentToDLQ:g.enableDLQ},"Webhook delivery failed permanently");return}let a=n.retryDelay||p(r-1);w.info({webhookConfigId:e.id,eventId:t.id,attempt:r,nextAttempt:r+1,delayMs:a},"Scheduling webhook retry"),await new Promise(e=>setTimeout(e,a)),r++}}async function f(e,t,r,n){b.dlqCount++;try{await o.markDeliveryFailed({eventId:t.id,webhookConfigId:e.id,error:r,attempts:n,sentToDLQ:!0}),w.warn({webhookConfigId:e.id,eventId:t.id,eventType:t.event,error:r,attempts:n},"Webhook sent to dead letter queue")}catch(r){w.error({webhookConfigId:e.id,eventId:t.id,dlqError:r},"Failed to send webhook to dead letter queue")}}async function m(t,r){try{let{getWebhookConfigs:n}=await e.A(97932);return(await n({endpointId:r||void 0,enabled:!0})).filter(e=>!!e.enabled&&!!e.events.includes(t)&&(!r||!e.endpointId||e.endpointId===r))}catch(e){return w.error("Failed to get webhook configs",{eventType:t,endpointId:r,error:e}),[]}}async function v(e,t,r){try{let n={id:`evt_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,event:e,timestamp:new Date().toISOString(),data:t},a=(await m(e,r)).filter(e=>e.enabled),o=r?a.filter(e=>!e.endpointId||e.endpointId===r):a.filter(e=>!e.endpointId);for(let e of o)await h(e,n);w.info("Webhooks triggered",{eventType:e,endpointId:r,configCount:o.length})}catch(t){w.error("Failed to trigger webhook",{eventType:e,endpointId:r,error:t})}}e.s(["WEBHOOK_CONFIG",0,g,"getWebhookMetrics",()=>l,"triggerWebhook",()=>v]),r()}catch(e){r(e)}},!1),70341,e=>e.a(async(t,r)=>{try{var n=e.i(89171),a=e.i(21198),o=e.i(79832),i=t([a,o]);async function s(e){if(!(await (0,o.requireAuth)(e,["admin","user"])).authorized)return n.NextResponse.json({error:"Unauthorized",code:"UNAUTHORIZED"},{status:401});let t=(0,a.getWebhookMetrics)();return n.NextResponse.json({success:!0,data:{metrics:t,config:{maxAttempts:a.WEBHOOK_CONFIG.maxAttempts,baseDelayMs:a.WEBHOOK_CONFIG.baseDelay,maxDelayMs:a.WEBHOOK_CONFIG.maxDelay,timeoutMs:a.WEBHOOK_CONFIG.requestTimeout,dlqEnabled:a.WEBHOOK_CONFIG.enableDLQ,jitterFactor:a.WEBHOOK_CONFIG.jitterFactor}},timestamp:new Date().toISOString()})}[a,o]=i.then?(await i)():i,e.s(["GET",()=>s]),r()}catch(e){r(e)}},!1),69713,e=>e.a(async(t,r)=>{try{var n=e.i(47909),a=e.i(74017),o=e.i(96250),i=e.i(59756),s=e.i(61916),d=e.i(14444),l=e.i(37092),u=e.i(69741),c=e.i(16795),p=e.i(87718),h=e.i(95169),y=e.i(47587),f=e.i(66012),m=e.i(70101),v=e.i(26937),w=e.i(10372),g=e.i(93695);e.i(52474);var b=e.i(220),x=e.i(70341),A=t([x]);[x]=A.then?(await A)():A;let E=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/metrics/webhooks/route",pathname:"/api/metrics/webhooks",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/metrics/webhooks/route.ts",nextConfigOutput:"standalone",userland:x}),{workAsyncStorage:R,workUnitAsyncStorage:I,serverHooks:D}=E;function _(){return(0,o.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:I})}async function k(e,t,r){E.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/metrics/webhooks/route";n=n.replace(/\/index$/,"")||"/";let o=await E.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:x,params:A,nextConfig:_,parsedUrl:k,isDraftMode:R,prerenderManifest:I,routerServerContext:D,isOnDemandRevalidate:C,revalidateOnlyGenerated:O,resolvedPathname:T,clientReferenceManifest:q,serverActionsManifest:S}=o,N=(0,u.normalizeAppPath)(n),$=!!(I.dynamicRoutes[N]||I.routes[T]),K=async()=>((null==D?void 0:D.render404)?await D.render404(e,t,k,!1):t.end("This page could not be found"),null);if($&&!R){let e=!!I.routes[T],t=I.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await K();throw new g.NoFallbackError}}let M=null;!$||E.isDev||R||(M=T,M="/index"===M?"/":M);let W=!0===E.isDev||!$,U=$&&!W;S&&q&&(0,d.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:q,serverActionsManifest:S,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:S})});let H=e.method||"GET",j=(0,s.getTracer)(),P=j.getActiveScopeSpan(),B={params:A,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:W,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>E.onRequestError(e,t,n,D)},sharedContext:{buildId:x}},F=new c.NodeNextRequest(e),L=new c.NodeNextResponse(t),X=p.NextRequestAdapter.fromNodeNextRequest(F,(0,p.signalFromNodeResponse)(t));try{let o=async e=>E.handle(X,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${n}`)}),d=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var s,l;let u=async({previousCacheEntry:a})=>{try{if(!d&&C&&O&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let s=B.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let l=B.renderOpts.collectedTags;if(!$)return await (0,f.sendResponse)(F,L,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);l&&(t[w.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,y.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:C})},D),t}},c=await E.handleResponse({req:e,nextConfig:_,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:O,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:d});if(!$)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});d||t.setHeader("x-nextjs-cache",C?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return d&&$||p.delete(w.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,v.getCacheControlHeader)(c.cacheControl)),await (0,f.sendResponse)(F,L,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};P?await l(P):await j.withPropagatedContext(e.headers,()=>j.trace(h.BaseServerSpan.handleRequest,{spanName:`${H} ${n}`,kind:s.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,y.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:C})}),$)throw t;return await (0,f.sendResponse)(F,L,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>_,"routeModule",()=>E,"serverHooks",()=>D,"workAsyncStorage",()=>R,"workUnitAsyncStorage",()=>I]),r()}catch(e){r(e)}},!1),36784,e=>{e.v(e=>Promise.resolve().then(()=>e(24924)))},3441,e=>{e.v(t=>Promise.all(["server/chunks/src_lib_webhook-queue_ts_cdea9e52._.js"].map(t=>e.l(t))).then(()=>t(29507)))},97932,e=>{e.v(t=>Promise.all(["server/chunks/src_bbbd1911._.js"].map(t=>e.l(t))).then(()=>t(18770)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ea2d75ea._.js.map