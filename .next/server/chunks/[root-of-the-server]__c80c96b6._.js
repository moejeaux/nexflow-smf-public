module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},30056,e=>e.a(async(t,r)=>{try{let t=await e.y("pg");e.n(t),r()}catch(e){r(e)}},!0),14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},87769,(e,t,r)=>{t.exports=e.x("node:events",()=>require("node:events"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},49719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},62562,(e,t,r)=>{t.exports=e.x("module",()=>require("module"))},50227,(e,t,r)=>{t.exports=e.x("node:path",()=>require("node:path"))},94346,e=>{e.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},37702,(e,t,r)=>{t.exports=e.x("worker_threads",()=>require("worker_threads"))},60526,(e,t,r)=>{t.exports=e.x("node:os",()=>require("node:os"))},77652,(e,t,r)=>{t.exports=e.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},60827,e=>e.a(async(t,r)=>{try{var a=e.i(24924),o=e.i(50377),n=t([a]);[a]=n.then?(await n)():n;let f=(0,o.createLogger)({component:"SMFDatabase"});async function s(e){let t=(0,a.getDb)(),r=crypto.randomUUID(),o=new Date().toISOString();return"pool"in t||"function"==typeof t.pool?.query?(await t.pool.query(`INSERT INTO routes (
        id, request_id, correlation_id, client_id, agent_id, network, token, amount,
        selected_facilitator_id, status, created_at, updated_at
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)
      RETURNING *`,[r,e.request_id,e.correlation_id,e.client_id,e.agent_id,e.network,e.token,e.amount,e.selected_facilitator_id,e.status,o,o])).rows[0]:(t.prepare(`
      INSERT INTO routes (
        id, request_id, correlation_id, client_id, agent_id, network, token, amount,
        selected_facilitator_id, status, created_at, updated_at
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(r,e.request_id,e.correlation_id,e.client_id,e.agent_id,e.network,e.token,e.amount,e.selected_facilitator_id,e.status,o,o),{id:r,...e,created_at:o,updated_at:o,completed_at:null})}async function i(e,t,r){let o=(0,a.getDb)(),n=new Date().toISOString();"pool"in o||"function"==typeof o.pool?.query?await o.pool.query("UPDATE routes SET status = $1, updated_at = $2, completed_at = $3 WHERE id = $4",[t,n,r||null,e]):o.prepare("UPDATE routes SET status = ?, updated_at = ?, completed_at = ? WHERE id = ?").run(t,n,r||null,e)}async function l(e){let t=(0,a.getDb)(),r=crypto.randomUUID(),o=new Date().toISOString();return"pool"in t||"function"==typeof t.pool?.query?(await t.pool.query(`INSERT INTO route_attempts (
        id, route_id, facilitator_id, phase, result, latency_ms, error_code, raw_status, is_probe, created_at
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)
      RETURNING *`,[r,e.route_id,e.facilitator_id,e.phase,e.result,e.latency_ms,e.error_code,e.raw_status,e.is_probe??!1,o])).rows[0]:(t.prepare(`
      INSERT INTO route_attempts (
        id, route_id, facilitator_id, phase, result, latency_ms, error_code, raw_status, is_probe, created_at
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(r,e.route_id,e.facilitator_id,e.phase,e.result,e.latency_ms,e.error_code,e.raw_status,e.is_probe??!1,o),{id:r,...e,created_at:o})}async function c(e,t,r){let o=(0,a.getDb)(),n="pool"in o||"function"==typeof o.pool?.query,s="SELECT * FROM facilitator_capabilities WHERE 1=1",i=[],l=1;return(e&&(n?s+=` AND facilitator_id = $${l++}`:s+=" AND facilitator_id = ?",i.push(e)),t&&(n?s+=` AND network = $${l++}`:s+=" AND network = ?",i.push(t)),r&&(n?s+=` AND token = $${l++}`:s+=" AND token = ?",i.push(r)),n)?(await o.pool.query(s,i)).rows:o.prepare(s).all(...i)}async function d(e,t,r){let o=(0,a.getDb)();return"pool"in o||"function"==typeof o.pool?.query?(await o.pool.query(`SELECT * FROM facilitator_health_snapshots
       WHERE facilitator_id = $1 AND network = $2 AND token = $3
       ORDER BY window_end DESC
       LIMIT 1`,[e,t,r])).rows[0]||null:o.prepare(`SELECT * FROM facilitator_health_snapshots
       WHERE facilitator_id = ? AND network = ? AND token = ?
       ORDER BY window_end DESC
       LIMIT 1`).get(e,t,r)||null}async function u(e,t,r,o,n,s=!0){let i=(0,a.getDb)(),l="pool"in i||"function"==typeof i.pool?.query,c=`probe-${e}-${t}-${r}%`;return l?(await i.pool.query(`SELECT ra.* FROM route_attempts ra
       LEFT JOIN routes r ON (ra.route_id::text = r.id::text AND ra.is_probe = false)
       WHERE ra.facilitator_id = $1
         AND (
           (ra.is_probe = true AND ra.route_id::text LIKE $2)
           OR (ra.is_probe = false AND r.network = $3 AND r.token = $4)
         )
         AND ra.created_at >= $5
         AND ra.created_at < $6
       ORDER BY ra.created_at`,[e,c,t,r,o,n])).rows:i.prepare(`SELECT ra.* FROM route_attempts ra
       LEFT JOIN routes r ON (ra.route_id = r.id AND ra.is_probe = 0)
       WHERE ra.facilitator_id = ?
         AND (
           (ra.is_probe = 1 AND ra.route_id LIKE ?)
           OR (ra.is_probe = 0 AND r.network = ? AND r.token = ?)
         )
         AND ra.created_at >= ?
         AND ra.created_at < ?
       ORDER BY ra.created_at`).all(e,c,t,r,o,n)}async function p(e){let t=(0,a.getDb)(),r=crypto.randomUUID(),o=new Date().toISOString();return"pool"in t||"function"==typeof t.pool?.query?(await t.pool.query(`INSERT INTO facilitator_health_snapshots (
        id, facilitator_id, network, token, window_start, window_end,
        success_rate, p50_latency_ms, p95_latency_ms, p99_latency_ms,
        error_rate, last_error_type, status, created_at
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14)
      ON CONFLICT (facilitator_id, network, token, window_end)
      DO UPDATE SET
        success_rate = EXCLUDED.success_rate,
        p50_latency_ms = EXCLUDED.p50_latency_ms,
        p95_latency_ms = EXCLUDED.p95_latency_ms,
        p99_latency_ms = EXCLUDED.p99_latency_ms,
        error_rate = EXCLUDED.error_rate,
        last_error_type = EXCLUDED.last_error_type,
        status = EXCLUDED.status
      RETURNING *`,[r,e.facilitator_id,e.network,e.token,e.window_start,e.window_end,e.success_rate,e.p50_latency_ms,e.p95_latency_ms,e.p99_latency_ms,e.error_rate,e.last_error_type,e.status,o])).rows[0]:(t.prepare(`
      INSERT INTO facilitator_health_snapshots (
        id, facilitator_id, network, token, window_start, window_end,
        success_rate, p50_latency_ms, p95_latency_ms, p99_latency_ms,
        error_rate, last_error_type, status, created_at
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).run(r,e.facilitator_id,e.network,e.token,e.window_start,e.window_end,e.success_rate,e.p50_latency_ms,e.p95_latency_ms,e.p99_latency_ms,e.error_rate,e.last_error_type,e.status,o),{id:r,...e,created_at:o})}async function _(e){let t=(0,a.getDb)();"pool"in t||"function"==typeof t.pool?.query?await t.pool.query(`INSERT INTO facilitator_probe_events (
        probe_config_id, facilitator_id, network, token, result,
        error_code, facilitator_status, facilitator_error_code, latency_ms
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)`,[e.probe_config_id,e.facilitator_id,e.network,e.token,e.result,e.error_code,e.facilitator_status,e.facilitator_error_code,e.latency_ms]):f.warn("facilitator_probe_events table not available in SQLite")}e.s(["createRoute",()=>s,"createRouteAttempt",()=>l,"getFacilitatorCapabilities",()=>c,"getLatestHealthSnapshot",()=>d,"getRouteAttemptsForHealth",()=>u,"recordFacilitatorProbeEvent",()=>_,"updateRouteStatus",()=>i,"upsertHealthSnapshot",()=>p]),r()}catch(e){r(e)}},!1),30344,e=>{"use strict";let t={cdp:{id:"cdp",name:"CDP x402 Facilitator",baseUrl:process.env.CDP_FACILITATOR_URL||"https://api.cdp.coinbase.com/platform/v2/x402",networks:["eip155:8453","solana:mainnet","eip155:84532","solana:devnet"],tokens:["USDC"],feeBps:0,priority:100},payai:{id:"payai",name:"PayAI Facilitator",baseUrl:process.env.PAYAI_FACILITATOR_URL||"https://facilitator.payai.network",networks:["eip155:1","eip155:8453","eip155:56","eip155:137","solana:mainnet"],tokens:["USDC"],feeBps:10,priority:200},x402rs:{id:"x402rs",name:"X402rs Facilitator",baseUrl:process.env.X402RS_FACILITATOR_URL||"https://facilitator.x402.rs",networks:["eip155:84532","eip155:8453","xdc:50"],tokens:["USDC"],feeBps:0,priority:150},dexter:{id:"dexter",name:"Dexter Facilitator",baseUrl:process.env.DEXTER_FACILITATOR_URL||"https://facilitator.dexter.cash",networks:["solana:101","solana:mainnet","solana:102","solana:devnet"],tokens:["USDC"],feeBps:0,priority:120},cronos:{id:"cronos",name:"Cronos x402 Facilitator",baseUrl:process.env.CRONOS_FACILITATOR_URL||"https://facilitator.cronoslabs.org",networks:["eip155:25","cronos","eip155:338","cronos-testnet"],tokens:["USDC","USDX"],feeBps:0,priority:130}};function r(){return Object.values(t)}function a(e){return Object.values(t).filter(t=>t.networks.includes(e))}e.s(["FACILITATORS",0,t,"getAllFacilitators",()=>r,"getFacilitatorsForNetwork",()=>a])},26436,e=>e.a(async(t,r)=>{try{var a=e.i(60827),o=e.i(24924),n=e.i(50377),s=e.i(30344),i=t([a,o]);[a,o]=i.then?(await i)():i;let m=(0,n.createLogger)({component:"FacilitatorProbes"}),h=new Map;async function l(e,t,r){let n=`${e}-${t}-${r}`;if(h.has(n))return h.get(n);try{let o=await (0,a.createRoute)({request_id:`probe-${n}`,correlation_id:null,client_id:"smf-probe-system",agent_id:null,network:t,token:r,amount:"1",selected_facilitator_id:e,status:"planned"});return h.set(n,o.id),o.id}catch(a){m.warn({error:a,facilitatorId:e,network:t,token:r},"Failed to create probe route, trying to find existing");try{let e=(0,o.getDb)();if("pool"in e||"function"==typeof e.pool?.query){let t=await e.pool.query("SELECT id FROM routes WHERE request_id = $1 LIMIT 1",[`probe-${n}`]);if(t.rows.length>0){let e=t.rows[0].id;return h.set(n,e),e}}}catch(e){m.error({queryError:e},"Failed to query for existing probe route")}throw Error(`Failed to create or find probe route for ${n}: ${a instanceof Error?a.message:"Unknown error"}`)}}let w=[{facilitatorId:"cdp",network:"eip155:8453",token:"USDC",intervalMs:3e4}],v=new Map;function c(e,t){return`${e}:${t}`}function d(e,t){let r=c(e,t),a=v.get(r);return!!a&&Date.now()<a.cooldownUntil}function u(e,t,r){let a=s.FACILITATORS[e];if(!a)throw Error(`Facilitator ${e} not found in registry`);let o=t;"eip155:8453"===t?o="base":t.startsWith("solana:")&&(o="solana");let n=r;return"eip155:8453"===t&&"USDC"===r&&(n="0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"),{scheme:"x402",network:o,asset:n,maxAmountRequired:"1",resource:`https://probe.nexflow.dev/health/${e}/${t}/${r}`,description:`Health probe for ${e} on ${t}`,mimeType:"application/json",payTo:a.baseUrl,maxTimeoutSeconds:10,settlementMode:"immediate"}}async function p(t){let{facilitatorId:r,network:o,token:n,intervalMs:s}=t;if(d(r,o))return void m.debug({facilitatorId:r,network:o},"Skipping probe - in rate limit cooldown");try{let{getFacilitatorRouter:t}=await e.A(89416),i=t().getFacilitators().find(e=>e.id===r);if(!i)return void m.warn({facilitatorId:r},"Facilitator not found in router, skipping probe");let d=u(r,o,n),p=`x402: version=2, scheme=x402, network=${o}, token=${n}, amount=1`,_=Date.now(),f="success",h=null,w=null;try{let e=await i.verify(p,d),t=Date.now()-_;if(e.success&&e.valid){f="success";let e=c(r,o),t=v.get(e);if(t&&t.currentInterval>s){let a=Math.max(s,Math.floor(.75*t.currentInterval));v.set(e,{facilitatorId:r,network:o,cooldownUntil:0,currentInterval:a})}else v.set(e,{facilitatorId:r,network:o,cooldownUntil:0,currentInterval:s})}else{let t=(e.error||"").toLowerCase();f=t.includes("timeout")||t.includes("network")||t.includes("econnrefused")?"network_error":t.includes("invalid json")||t.includes("invalid payment")||t.includes("malformed")||t.includes("parse error")||t.includes("does not support")||t.includes("unsupported")||t.includes("not supported")?"invalid_request":"failure",h=e.error||null}let u=await l(r,o,n);await (0,a.createRouteAttempt)({route_id:u,facilitator_id:r,phase:"verify",result:f,latency_ms:t,error_code:h,raw_status:w,is_probe:!0}),m.debug({facilitatorId:r,network:o,token:n,result:f,latency:t},"Probe completed")}catch(u){let e=Date.now()-_,t=u instanceof Error?u.message:"Unknown error",i=t.toLowerCase();if(i.includes("timeout")||i.includes("timed out"))f="timeout";else if(i.includes("rate")||i.includes("429")||i.includes("too many requests")){let e,t;f="rate_limited",w=429,e=c(r,o),t=2*s,v.set(e,{facilitatorId:r,network:o,cooldownUntil:Date.now()+3e5,currentInterval:t}),m.warn({facilitatorId:r,network:o,cooldownMs:3e5,newInterval:t},"Rate limit detected, entering cooldown period")}else f=i.includes("network")||i.includes("econnrefused")||i.includes("connection")?"network_error":i.includes("invalid json")||i.includes("invalid payment")||i.includes("malformed")||i.includes("parse error")||i.includes("does not support")||i.includes("unsupported")||i.includes("not supported")?"invalid_request":"failure";h=t;let d=await l(r,o,n);await (0,a.createRouteAttempt)({route_id:d,facilitator_id:r,phase:"verify",result:f,latency_ms:e,error_code:h,raw_status:w,is_probe:!0}),m.warn({facilitatorId:r,network:o,token:n,result:f,error:t},"Probe failed")}}catch(e){m.error({error:e,facilitatorId:r,network:o,token:n},"Probe execution error")}}async function _(){m.info({env:"production",probeCount:w.length,probes:w.map(e=>({facilitator:e.facilitatorId,network:e.network,token:e.token,intervalSeconds:e.intervalMs/1e3}))},"Starting facilitator probes");try{await e.A(87548),await e.A(6885),m.info("Required dependencies (@coinbase/cdp-sdk/auth, viem) are available")}catch(e){return m.warn({error:e instanceof Error?e.message:"Unknown error"},"Facilitator probes disabled - required dependencies (@coinbase/cdp-sdk/auth, viem) not available"),[]}let t=w.map(e=>{try{return function e(t){let{facilitatorId:r,network:a,token:o,intervalMs:n}=t;m.info({facilitatorId:r,network:a,token:o,intervalMs:n},"Starting facilitator probe"),p(t).catch(e=>{m.error({error:e,facilitatorId:r,network:a,token:o},"Initial probe failed")});let s=setInterval(()=>{let i,l,u=(i=c(r,a),(l=v.get(i))&&l.currentInterval>n?l.currentInterval:n);if(d(r,a))return void m.debug({facilitatorId:r,network:a},"Skipping probe - in cooldown");if(u!==n){clearInterval(s),e({...t,intervalMs:u});return}p(t).catch(e=>{m.error({error:e,facilitatorId:r,network:a,token:o},"Scheduled probe failed")})},n);return s}(e)}catch(t){return m.error({error:t,config:e},"Failed to start probe scheduler for config"),null}}).filter(e=>null!==e);return m.info({started:t.length,total:w.length},"Facilitator probes started"),t}function f(e){e.forEach(e=>clearInterval(e)),m.info("Stopped all facilitator probes")}e.s(["PROBE_CONFIG",0,w,"buildProbeRequirements",()=>u,"getOrCreateProbeRoute",()=>l,"startFacilitatorProbes",()=>_,"stopFacilitatorProbes",()=>f]),r()}catch(e){r(e)}},!1),29825,e=>e.a(async(t,r)=>{try{var a=e.i(89171),o=e.i(26436),n=t([o]);async function s(){let t="true"===process.env.ENABLE_FACILITATOR_PROBES,r=t&&!0,n=!1,s=null;try{await e.A(87548),await e.A(6885),n=!0}catch(e){s=e instanceof Error?e.message:"Unknown error"}let i=0;try{let{getDb:t}=await e.A(36784),r=t();if("pool"in r||"function"==typeof r.pool?.query){let e=new Date(Date.now()-36e5),t=await r.pool.query("SELECT COUNT(*) as count FROM route_attempts WHERE is_probe = true AND created_at >= $1",[e.toISOString()]);i=parseInt(t.rows[0].count,10)}}catch(e){}return a.NextResponse.json({enabled:r,running:r&&n&&i>0,environment:{nodeEnv:"production",isProduction:!0,isTest:!1,nextRuntime:"nodejs",enableProbesFlag:t},dependencies:{available:n,error:s},activity:{recentProbeCount:i,lastHour:i,hasActivity:i>0},configuration:r?{probeCount:o.PROBE_CONFIG.length,probes:o.PROBE_CONFIG.map(e=>({facilitatorId:e.facilitatorId,network:e.network,token:e.token,intervalSeconds:e.intervalMs/1e3,intervalMs:e.intervalMs}))}:null,message:r?n?i>0?"Probes are enabled and running (detected recent activity)":"Probes are enabled but no recent activity detected - check server logs":"Probes enabled but dependencies unavailable":t?"Probes disabled: unknown reason":'Probes disabled: ENABLE_FACILITATOR_PROBES not set to "true"',troubleshooting:{steps:[null,!t?"Set ENABLE_FACILITATOR_PROBES=true in Vercel environment variables":null,!n?`Install missing dependencies: ${s}`:null,r&&!i?"Check server startup logs for probe initialization errors":null,"Ensure instrumentation.ts is running (should see [SMF] logs on startup)"].filter(Boolean)},timestamp:new Date().toISOString()})}[o]=n.then?(await n)():n,e.s(["GET",()=>s,"dynamic",0,"force-dynamic"]),r()}catch(e){r(e)}},!1),27964,e=>e.a(async(t,r)=>{try{var a=e.i(47909),o=e.i(74017),n=e.i(96250),s=e.i(59756),i=e.i(61916),l=e.i(14444),c=e.i(37092),d=e.i(69741),u=e.i(16795),p=e.i(87718),_=e.i(95169),f=e.i(47587),m=e.i(66012),h=e.i(70101),w=e.i(26937),v=e.i(10372),y=e.i(93695);e.i(52474);var b=e.i(220),E=e.i(29825),g=t([E]);[E]=g.then?(await g)():g;let x=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/v1/smf/probes/status/route",pathname:"/api/v1/smf/probes/status",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/smf/probes/status/route.ts",nextConfigOutput:"standalone",userland:E}),{workAsyncStorage:A,workUnitAsyncStorage:D,serverHooks:I}=x;function k(){return(0,n.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:D})}async function R(e,t,r){x.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/v1/smf/probes/status/route";a=a.replace(/\/index$/,"")||"/";let n=await x.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:E,params:g,nextConfig:k,parsedUrl:R,isDraftMode:A,prerenderManifest:D,routerServerContext:I,isOnDemandRevalidate:$,revalidateOnlyGenerated:S,resolvedPathname:T,clientReferenceManifest:C,serverActionsManifest:N}=n,O=(0,d.normalizeAppPath)(a),U=!!(D.dynamicRoutes[O]||D.routes[T]),q=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,R,!1):t.end("This page could not be found"),null);if(U&&!A){let e=!!D.routes[T],t=D.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(k.experimental.adapterPath)return await q();throw new y.NoFallbackError}}let L=null;!U||x.isDev||A||(L=T,L="/index"===L?"/":L);let F=!0===x.isDev||!U,P=U&&!F;N&&C&&(0,l.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:C,serverActionsManifest:N,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:N})});let j=e.method||"GET",M=(0,i.getTracer)(),H=M.getActiveScopeSpan(),B={params:g,prerenderManifest:D,renderOpts:{experimental:{authInterrupts:!!k.experimental.authInterrupts},cacheComponents:!!k.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:k.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>x.onRequestError(e,t,a,I)},sharedContext:{buildId:E}},X=new u.NodeNextRequest(e),W=new u.NodeNextResponse(t),V=p.NextRequestAdapter.fromNodeNextRequest(X,(0,p.signalFromNodeResponse)(t));try{let n=async e=>x.handle(V,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==_.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${j} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${a}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),c=async s=>{var i,c;let d=async({previousCacheEntry:o})=>{try{if(!l&&$&&S&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=B.renderOpts.fetchMetrics;let i=B.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let c=B.renderOpts.collectedTags;if(!U)return await (0,m.sendResponse)(X,W,a,B.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[v.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,o=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==o?void 0:o.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:P,isOnDemandRevalidate:$})},I),t}},u=await x.handleResponse({req:e,nextConfig:k,cacheKey:L,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:D,isRoutePPREnabled:!1,isOnDemandRevalidate:$,revalidateOnlyGenerated:S,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:l});if(!U)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",$?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&U||p.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,w.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(X,W,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};H?await c(H):await M.withPropagatedContext(e.headers,()=>M.trace(_.BaseServerSpan.handleRequest,{spanName:`${j} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},c))}catch(t){if(t instanceof y.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:P,isOnDemandRevalidate:$})}),U)throw t;return await (0,m.sendResponse)(X,W,new Response(null,{status:500})),null}}e.s(["handler",()=>R,"patchFetch",()=>k,"routeModule",()=>x,"serverHooks",()=>I,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>D]),r()}catch(e){r(e)}},!1),89416,e=>{e.v(t=>Promise.all(["server/chunks/_fc530d32._.js","server/chunks/[root-of-the-server]__a765e8f6._.js","server/chunks/_05a3425a._.js","server/chunks/src_integrations_x402_75d3e0c5._.js","server/chunks/node_modules_viem__esm_6afb56d2._.js","server/chunks/node_modules_@coinbase_cdp-sdk__esm_auth_utils_jwt_83481f05.js","server/chunks/src_services_b76bdbea._.js","server/chunks/src_ab5eb711._.js"].map(t=>e.l(t))).then(()=>t(57729)))},87548,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__f95ab0e5._.js","server/chunks/[root-of-the-server]__d6352941._.js","server/chunks/node_modules_@coinbase_cdp-sdk__esm_auth_utils_jwt_83481f05.js"].map(t=>e.l(t))).then(()=>t(87111)))},6885,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_cbdd5cab._.js","server/chunks/[root-of-the-server]__0322765b._.js","server/chunks/node_modules_viem__esm_fc430adf._.js","server/chunks/node_modules_viem__esm_fa025007._.js","server/chunks/node_modules_viem__esm_7be986f3._.js","server/chunks/node_modules_viem__esm_index_2539e189.js","server/chunks/node_modules_073df2c7._.js","server/chunks/node_modules_viem_1d205ba3._.js","server/chunks/node_modules_bc74a3ae._.js","server/chunks/node_modules_viem__esm_fa967896._.js"].map(t=>e.l(t))).then(()=>t(56030)))},36784,e=>{e.v(e=>Promise.resolve().then(()=>e(24924)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c80c96b6._.js.map