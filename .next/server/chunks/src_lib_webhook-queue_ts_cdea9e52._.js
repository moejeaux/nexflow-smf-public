module.exports=[29507,e=>{"use strict";let o,t,n=(0,e.i(50377).createLogger)({component:"WebhookQueue"}),a=null;async function l(){if(!o)try{let e=await import("bullmq").catch(()=>null);if(!e)throw Error("bullmq package not installed");o=e.Queue,t=e.QueueOptions}catch(e){throw n.warn({error:e},"bullmq not available - webhook queue features will be disabled"),Error("bullmq package not installed")}return{Queue:o,QueueOptions:t}}async function r(){if(!a)try{let{Queue:e,QueueOptions:o}=await l(),t={host:process.env.REDIS_HOST||"localhost",port:parseInt(process.env.REDIS_PORT||"6379"),password:process.env.REDIS_PASSWORD,...process.env.REDIS_URL?{url:process.env.REDIS_URL}:{}};a=new e("webhook-delivery",{connection:t,defaultJobOptions:{attempts:3,backoff:{type:"exponential",delay:2e3},removeOnComplete:{age:86400,count:1e3},removeOnFail:{age:604800}}})}catch(e){return n.warn({error:e},"Failed to initialize webhook queue"),null}return a}async function u(e){try{let o=await r();if(!o)throw Error("Webhook queue not available (bullmq not installed or Redis not configured)");let t=await o.add("deliver",e,{jobId:`webhook_${e.webhookConfigId}_${e.eventId}_${Date.now()}`});return n.info("Webhook delivery job enqueued",{jobId:t.id,webhookConfigId:e.webhookConfigId,eventId:e.eventId,url:e.url}),t.id}catch(o){throw n.error("Failed to enqueue webhook delivery",{webhookConfigId:e.webhookConfigId,eventId:e.eventId,error:o}),o}}async function i(){let e=await r();if(!e)return{waiting:0,active:0,completed:0,failed:0,delayed:0,total:0,available:!1};let[o,t,n,a,l]=await Promise.all([e.getWaitingCount(),e.getActiveCount(),e.getCompletedCount(),e.getFailedCount(),e.getDelayedCount()]);return{waiting:o,active:t,completed:n,failed:a,delayed:l,total:o+t+n+a+l,available:!0}}async function c(){try{let e=await r();if(!e)return void n.warn("Cannot cleanup queue - webhook queue not available");await e.clean(864e5,1e3,"completed"),await e.clean(6048e5,1e3,"failed"),n.info("Queue cleanup completed")}catch(e){n.error("Failed to cleanup queue",{error:e})}}e.s(["cleanupQueue",()=>c,"enqueueWebhookDelivery",()=>u,"getQueueStats",()=>i,"webhookQueue",0,{get instance(){return a}}])}];

//# sourceMappingURL=src_lib_webhook-queue_ts_cdea9e52._.js.map