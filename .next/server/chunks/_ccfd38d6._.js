module.exports=[54273,e=>{"use strict";async function t(t){try{let{createAuditLog:a}=await e.A(75150);await a(t)}catch(e){a.warn({error:e},"Failed to create audit log (DB may not be available)")}}let a=(0,e.i(50377).createLogger)({component:"InsurancePool"}),n={SETTLEMENT_TIMEOUT:100,INVALID_PROOF:500,INSUFFICIENT_ESCROW:200,REPEATED_FAILURES:300,DOUBLE_SPEND:1e3,GOVERNANCE_PENALTY:0};class i{state;pendingClaims;slashingHistory;constructor(){this.state={balances:new Map,totalClaimsPaid:new Map,totalSlashingCollected:new Map,coverageRatio:0,lastUpdated:new Date},this.pendingClaims=new Map,this.slashingHistory=[]}async allocateFees(e,t,n){let i=BigInt(0),s=this.state.balances.get(t)??BigInt(0);return this.state.lastUpdated=new Date,a.debug({batchId:n,tokenAddress:t,allocation:"0",newBalance:s.toString(),notice:"Insurance pool deprecated - Protected Payments now active"},"Insurance allocation skipped (deprecated)"),{insuranceAllocation:i,newPoolBalance:s}}getPoolBalance(e){return this.state.balances.get(e)??BigInt(0)}getTotalPoolBalance(){return new Map(this.state.balances)}async applySlashing(e,i,s,r,o,l,c){let d=n[i],u=c??s*BigInt(d)/BigInt(1e4),g={id:`slash_${Date.now()}_${Math.random().toString(36).slice(2)}`,facilitatorId:e,reason:i,amountSlashed:u,tokenAddress:r,network:o,batchId:l,details:{escrow_balance_before:s.toString(),slashing_bps:d,reason_description:this.getSlashingReasonDescription(i)},createdAt:new Date};this.slashingHistory.push(g);let p=this.state.totalSlashingCollected.get(r)??BigInt(0);this.state.totalSlashingCollected.set(r,p+u);let m=this.state.balances.get(r)??BigInt(0);return this.state.balances.set(r,m+u),await t({batch_id:l,action:"slashing_applied",amount_wei:u,previous_balance_wei:s,new_balance_wei:s-u,actor:"insurance_pool",details:{facilitator_id:e,reason:i,slashing_bps:d}}),a.warn({facilitatorId:e,reason:i,amount:u.toString(),tokenAddress:r},"Slashing applied"),g}getSlashingReasonDescription(e){return({SETTLEMENT_TIMEOUT:"Failed to settle batch within agreed SLA timeframe",INVALID_PROOF:"Submitted an invalid Merkle proof for settlement",INSUFFICIENT_ESCROW:"Had insufficient escrow balance during settlement attempt",REPEATED_FAILURES:"Multiple consecutive settlement failures",DOUBLE_SPEND:"Attempted to settle the same payment multiple times",GOVERNANCE_PENALTY:"Penalty applied by governance decision"})[e]}getSlashingHistory(e){return e?this.slashingHistory.filter(t=>t.facilitatorId===e):[...this.slashingHistory]}async submitClaim(e){let t=`claim_${Date.now()}_${Math.random().toString(36).slice(2)}`,n=this.getPoolBalance(e.tokenAddress)*BigInt(Math.floor(2500))/BigInt(1e4);if(e.amountRequested>n)throw Error(`Claim amount ${e.amountRequested} exceeds maximum ${n}`);let i={...e,claimId:t,status:"pending",createdAt:new Date};return this.pendingClaims.set(t,i),a.info({claimId:t,claimantId:e.claimantId,amount:e.amountRequested.toString()},"Insurance claim submitted"),i}async approveClaim(e,n){let i=this.pendingClaims.get(e);if(!i)throw Error(`Claim ${e} not found`);if("pending"!==i.status)throw Error(`Claim ${e} is not pending (status: ${i.status})`);return i.status="approved",i.resolvedAt=new Date,await t({batch_id:i.batchId,action:"fee_captured",amount_wei:i.amountRequested,actor:n,details:{claim_id:e,claimant_id:i.claimantId,claim_action:"approved",reason:i.reason}}),a.info({claimId:e,approvedBy:n,amount:i.amountRequested.toString()},"Insurance claim approved"),i}async payoutClaim(e){let t=this.pendingClaims.get(e);if(!t)throw Error(`Claim ${e} not found`);if("approved"!==t.status)throw Error(`Claim ${e} is not approved (status: ${t.status})`);let n=this.getPoolBalance(t.tokenAddress);if(n<t.amountRequested)throw Error(`Insufficient pool balance: ${n} < ${t.amountRequested}`);let i=n-t.amountRequested;this.state.balances.set(t.tokenAddress,i);let s=this.state.totalClaimsPaid.get(t.tokenAddress)??BigInt(0);return this.state.totalClaimsPaid.set(t.tokenAddress,s+t.amountRequested),t.status="paid",t.resolvedAt=new Date,a.info({claimId:e,amount:t.amountRequested.toString(),newPoolBalance:i.toString()},"Insurance claim paid"),{claim:t,newPoolBalance:i}}async rejectClaim(e,t,n){let i=this.pendingClaims.get(e);if(!i)throw Error(`Claim ${e} not found`);return i.status="rejected",i.resolvedAt=new Date,a.info({claimId:e,rejectedBy:t,reason:n},"Insurance claim rejected"),i}getPendingClaims(){return Array.from(this.pendingClaims.values()).filter(e=>"pending"===e.status)}getCoverageInfo(e,t,a){let n=this.getPoolBalance(t),i=n*BigInt(Math.floor(2500))/BigInt(1e4),s=Math.min(100,20*this.getSlashingHistory(e).length),r=n>BigInt(0)?Number(a*BigInt(100)/n)/100:0,o=r>1?i:i*BigInt(Math.floor(1e4*r))/BigInt(1e4),l=Math.min(50,s/2);return{facilitatorId:e,tokenAddress:t,coverageAmount:o,maxClaimable:i,riskScore:s,premiumBps:l,status:s>60?"suspended":s>30?"at_risk":"active"}}getState(){return{balances:new Map(this.state.balances),totalClaimsPaid:new Map(this.state.totalClaimsPaid),totalSlashingCollected:new Map(this.state.totalSlashingCollected),coverageRatio:this.state.coverageRatio,lastUpdated:this.state.lastUpdated}}calculateCoverageRatio(e,t){let a=this.getPoolBalance(t);return e===BigInt(0)?1:Number(a*BigInt(1e4)/e)/1e4}generatePoolSummary(){let e=new Map;for(let t of this.getPendingClaims()){let a=BigInt(e.get(t.tokenAddress)??"0");e.set(t.tokenAddress,(a+t.amountRequested).toString())}let t=e=>{let t=new Map;for(let[a,n]of e)t.set(a,n.toString());return t};return{totalBalance:t(this.state.balances),totalClaimsPaid:t(this.state.totalClaimsPaid),totalSlashingCollected:t(this.state.totalSlashingCollected),pendingClaimsCount:this.getPendingClaims().length,pendingClaimsTotal:e,slashingEventsCount:this.slashingHistory.length}}}let s=null;function r(){return s||(s=new i),s}e.s(["getInsurancePool",()=>r])},47562,e=>e.a(async(t,a)=>{try{var n=e.i(50377),i=e.i(19502),s=t([i]);[i]=s.then?(await s)():s;let o=(0,n.createLogger)({component:"FeeManager"});class l{config;constructor(e={}){this.config={max_batch_size:e.max_batch_size??100,min_batch_size:e.min_batch_size??10,max_batch_delay_ms:e.max_batch_delay_ms??6e4,min_batch_value_wei:e.min_batch_value_wei??BigInt("1000000"),platform_fee_bps:Math.min(e.platform_fee_bps??25,25),max_retry_attempts:e.max_retry_attempts??3,retry_delay_ms:e.retry_delay_ms??3e4,escrow_buffer_ratio:e.escrow_buffer_ratio??1.1}}calculateFee(e,t){let a=Math.min(t??this.config.platform_fee_bps,25),n=e*BigInt(a)/BigInt(1e4);return{grossAmount:e,feeAmount:n,netAmount:e-n,feeBps:a}}calculateBatchFees(e,t){let a=e.map(e=>this.calculateFee(e,t));return{calculations:a,totalGross:a.reduce((e,t)=>e+t.grossAmount,BigInt(0)),totalFees:a.reduce((e,t)=>e+t.feeAmount,BigInt(0)),totalNet:a.reduce((e,t)=>e+t.netAmount,BigInt(0))}}breakdownFee(e){return{totalFee:e,insuranceAllocation:BigInt(0),operationsAllocation:e,treasuryAllocation:BigInt(0)}}validateFee(e,t,a){let n=[],i=[];a>25&&n.push(`Fee rate ${a} bps exceeds maximum 25 bps`);let s=e*BigInt(a)/BigInt(1e4),r=BigInt(1);return(t<s-r||t>s+r)&&n.push(`Fee amount ${t} doesn't match expected ${s} for ${a} bps`),e===BigInt(0)&&i.push("Zero payment amount"),t===BigInt(0)&&e>BigInt(0)&&i.push("Zero fee on non-zero payment"),{valid:0===n.length,errors:n,warnings:i}}async captureFee(e){let t=this.validateFee(e.payment_amount_wei,e.fee_amount_wei,e.fee_bps);if(!t.valid)throw Error(`Fee validation failed: ${t.errors.join(", ")}`);for(let a of t.warnings)o.warn({warning:a,input:e},"Fee capture warning");let a=await (0,i.createPlatformFee)(e);return await (0,i.createAuditLog)({batch_id:e.batch_id,action:"fee_captured",amount_wei:e.fee_amount_wei,actor:"fee_manager",details:{payment_id:e.payment_id,facilitator_id:e.facilitator_id,fee_bps:e.fee_bps,payment_amount:e.payment_amount_wei.toString()}}),o.info({feeId:a.id,batchId:e.batch_id,amount:e.fee_amount_wei.toString(),feeBps:e.fee_bps},"Fee captured"),a}async captureBatchFees(e,t,a,n,i){let s=[],r=BigInt(0);for(let o of i){let i=this.calculateFee(o.amount),l=await this.captureFee({batch_id:e,payment_id:o.paymentId,facilitator_id:t,network:a,token_address:n,fee_amount_wei:i.feeAmount,fee_bps:i.feeBps,payment_amount_wei:o.amount});s.push(l),r+=i.feeAmount}let l=this.breakdownFee(r);return o.info({batchId:e,paymentCount:i.length,totalFees:r.toString(),insuranceAllocation:l.insuranceAllocation.toString()},"Batch fees captured"),{fees:s,totalFees:r,breakdown:l}}async markFeeWithdrawn(e,t){await (0,i.updatePlatformFeeStatus)(e,"withdrawn",t),o.info({feeId:e,txHash:t},"Fee marked as withdrawn")}async markFeeRefunded(e){await (0,i.updatePlatformFeeStatus)(e,"refunded"),o.info({feeId:e},"Fee marked as refunded")}async getFee(e){return(0,i.getPlatformFee)(e)}async getBatchFees(e){return(0,i.getPlatformFeesByBatch)(e)}async getFacilitatorFees(e,t){return(0,i.getPlatformFeesByFacilitator)(e,t)}async getTotalFees(e){return(0,i.getTotalFeesByToken)(e)}async generateFeeSummary(e){let t=new Map,a=new Map;return{totalFeesCollected:BigInt(0),totalFeesPending:BigInt(0),totalFeesWithdrawn:BigInt(0),byToken:t,byFacilitator:a,recordCount:0}}getConfig(){return{...this.config}}getFeeBps(){return this.config.platform_fee_bps}updateConfig(e){if(void 0!==e.platform_fee_bps&&e.platform_fee_bps>25)throw Error(`Fee rate ${e.platform_fee_bps} exceeds maximum 25 bps`);this.config={...this.config,...e},o.info({config:this.config},"Fee config updated")}}let c=null;function r(){return c||(c=new l),c}e.s(["getFeeManager",()=>r]),a()}catch(e){a(e)}},!1),53695,e=>e.a(async(t,a)=>{try{var n=e.i(89171),i=e.i(19502),s=e.i(54273),r=e.i(47562),o=e.i(50377),l=t([i,r]);[i,r]=l.then?(await l)():l;let _=(0,o.createLogger)({component:"AuditTrailAPI"});function c(e){return{id:e.id,batch_id:e.batch_id,escrow_id:e.escrow_id,action:e.action,amount_wei:e.amount_wei?.toString()??null,previous_balance_wei:e.previous_balance_wei?.toString()??null,new_balance_wei:e.new_balance_wei?.toString()??null,actor:e.actor,transaction_hash:e.transaction_hash,details:e.details,created_at:e.created_at.toISOString()}}function d(e){let t={};for(let[a,n]of e)t[a]=n;return t}async function u(e){try{let{searchParams:t}=new URL(e.url),a=t.get("view")||"logs";switch(a){case"logs":return g(t);case"fees":return p(t);case"insurance":return m();case"dashboard":return h(t);default:return n.NextResponse.json({success:!1,error:`Invalid view: ${a}`},{status:400})}}catch(e){return _.error({error:e},"Audit trail API error"),n.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function g(e){let t,a=e.get("action"),s=e.get("batch_id"),r=e.get("start_date"),o=e.get("end_date"),l=Math.min(parseInt(e.get("limit")||"50"),1e3),d=parseInt(e.get("offset")||"0"),u=r?new Date(r):void 0,g=o?new Date(o):void 0,p=(t=s?await (0,i.getBatchAuditLogs)(s):a?await (0,i.getAuditLogsByAction)(a,{startDate:u,endDate:g,limit:l+1}):await (0,i.getAllAuditLogs)({action:a??void 0,startDate:u,endDate:g,limit:l+1,offset:d})).length>l;return p&&(t=t.slice(0,l)),n.NextResponse.json({success:!0,data:{auditLogs:t.map(c),pagination:{limit:l,offset:d,hasMore:p}}})}async function p(e){let t=e.get("token_address");e.get("facilitator_id");let a=(0,r.getFeeManager)().getFeeBps(),s={},o=BigInt(0),l=BigInt(0),c=BigInt(0);for(let e of t?[t]:["0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48","0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913","0xdAC17F958D2ee523a2206206994597C13D831ec7"]){let t=await (0,i.getTotalFeesByToken)(e);s[e]={total:t.total.toString(),pending:t.pending.toString(),captured:t.captured.toString(),withdrawn:t.withdrawn.toString()},o+=t.total,l+=t.pending,c+=t.withdrawn}return n.NextResponse.json({success:!0,data:{totalFeesCollected:o.toString(),totalFeesPending:l.toString(),totalFeesWithdrawn:c.toString(),feeRateBps:a,feeRatePercent:`${(a/100).toFixed(2)}%`,byToken:s,lastUpdated:new Date().toISOString()}})}async function m(){let e=(0,s.getInsurancePool)().generatePoolSummary();return n.NextResponse.json({success:!0,data:{balances:d(e.totalBalance),totalClaimsPaid:d(e.totalClaimsPaid),totalSlashingCollected:d(e.totalSlashingCollected),pendingClaimsCount:e.pendingClaimsCount,pendingClaimsTotal:d(e.pendingClaimsTotal),slashingEventsCount:e.slashingEventsCount,coverageInfo:{minCoverageRatio:.05,maxClaimRatio:.25},lastUpdated:new Date().toISOString()}})}async function h(e){let t=(0,r.getFeeManager)(),a=(0,s.getInsurancePool)(),o=await (0,i.getTotalPendingFees)(),l=a.generatePoolSummary(),d=BigInt(0);for(let[,e]of l.totalBalance)d+=BigInt(e);let u=BigInt(0);for(let[,e]of l.totalClaimsPaid)u+=BigInt(e);let g=await (0,i.getAllAuditLogs)({limit:10});return n.NextResponse.json({success:!0,data:{fees:{totalCollected:"0",totalPending:o.toString(),feeRateBps:t.getFeeBps()},insurance:{poolBalance:d.toString(),claimsPaid:u.toString(),pendingClaims:l.pendingClaimsCount,slashingEvents:l.slashingEventsCount},recentActivity:g.map(c),governanceDecisions:[]}})}async function f(e){try{let t=await e.json(),{action:a}=t;switch(a){case"submit_claim":{let{claimant_id:e,amount:a,token_address:i,network:r,reason:o,evidence:l,batch_id:c}=t;if(!e||!a||!i||!r||!o)return n.NextResponse.json({success:!1,error:"Missing required fields for claim submission"},{status:400});let d=(0,s.getInsurancePool)(),u=await d.submitClaim({claimantId:e,amountRequested:BigInt(a),tokenAddress:i,network:r,reason:o,evidence:l||{},batchId:c});return n.NextResponse.json({success:!0,data:{claimId:u.claimId,status:u.status,createdAt:u.createdAt.toISOString()}})}case"approve_claim":{let{claim_id:e,approved_by:a}=t;if(!e||!a)return n.NextResponse.json({success:!1,error:"Missing claim_id or approved_by"},{status:400});let i=(0,s.getInsurancePool)(),r=await i.approveClaim(e,a);return n.NextResponse.json({success:!0,data:{claimId:r.claimId,status:r.status,resolvedAt:r.resolvedAt?.toISOString()}})}case"reject_claim":{let{claim_id:e,rejected_by:a,reason:i}=t;if(!e||!a||!i)return n.NextResponse.json({success:!1,error:"Missing required fields for claim rejection"},{status:400});let r=(0,s.getInsurancePool)(),o=await r.rejectClaim(e,a,i);return n.NextResponse.json({success:!0,data:{claimId:o.claimId,status:o.status,resolvedAt:o.resolvedAt?.toISOString()}})}default:return n.NextResponse.json({success:!1,error:`Unknown action: ${a}`},{status:400})}}catch(e){return _.error({error:e},"Audit trail POST error"),n.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Internal server error"},{status:500})}}e.s(["GET",()=>u,"POST",()=>f]),a()}catch(e){a(e)}},!1),45364,e=>e.a(async(t,a)=>{try{var n=e.i(47909),i=e.i(74017),s=e.i(96250),r=e.i(59756),o=e.i(61916),l=e.i(14444),c=e.i(37092),d=e.i(69741),u=e.i(16795),g=e.i(87718),p=e.i(95169),m=e.i(47587),h=e.i(66012),f=e.i(70101),_=e.i(26937),w=e.i(10372),I=e.i(93695);e.i(52474);var C=e.i(220),v=e.i(53695),R=t([v]);[v]=R.then?(await R)():R;let S=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/v1/settlement/audit-trail/route",pathname:"/api/v1/settlement/audit-trail",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/v1/settlement/audit-trail/route.ts",nextConfigOutput:"standalone",userland:v}),{workAsyncStorage:A,workUnitAsyncStorage:E,serverHooks:B}=S;function b(){return(0,s.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:E})}async function y(e,t,a){S.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/v1/settlement/audit-trail/route";n=n.replace(/\/index$/,"")||"/";let s=await S.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:b,parsedUrl:y,isDraftMode:A,prerenderManifest:E,routerServerContext:B,isOnDemandRevalidate:P,revalidateOnlyGenerated:F,resolvedPathname:x,clientReferenceManifest:N,serverActionsManifest:T}=s,M=(0,d.normalizeAppPath)(n),D=!!(E.dynamicRoutes[M]||E.routes[x]),O=async()=>((null==B?void 0:B.render404)?await B.render404(e,t,y,!1):t.end("This page could not be found"),null);if(D&&!A){let e=!!E.routes[x],t=E.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await O();throw new I.NoFallbackError}}let k=null;!D||S.isDev||A||(k=x,k="/index"===k?"/":k);let $=!0===S.isDev||!D,U=D&&!$;T&&N&&(0,l.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:N,serverActionsManifest:T,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:T})});let j=e.method||"GET",q=(0,o.getTracer)(),H=q.getActiveScopeSpan(),L={params:R,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>S.onRequestError(e,t,n,B)},sharedContext:{buildId:v}},K=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),V=g.NextRequestAdapter.fromNodeNextRequest(K,(0,g.signalFromNodeResponse)(t));try{let s=async e=>S.handle(V,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=q.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=a.get("next.route");if(i){let t=`${j} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${n}`)}),l=!!(0,r.getRequestMeta)(e,"minimalMode"),c=async r=>{var o,c;let d=async({previousCacheEntry:i})=>{try{if(!l&&P&&F&&!i)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(r);e.fetchMetrics=L.renderOpts.fetchMetrics;let o=L.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let c=L.renderOpts.collectedTags;if(!D)return await (0,h.sendResponse)(K,G,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[w.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,i=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:C.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:i}}}}catch(t){throw(null==i?void 0:i.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})},B),t}},u=await S.handleResponse({req:e,nextConfig:b,cacheKey:k,routeKind:i.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:F,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:l});if(!D)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==C.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&D||g.delete(w.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,_.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(K,G,new Response(u.value.body,{headers:g,status:u.value.status||200})),null};H?await c(H):await q.withPropagatedContext(e.headers,()=>q.trace(p.BaseServerSpan.handleRequest,{spanName:`${j} ${n}`,kind:o.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},c))}catch(t){if(t instanceof I.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:P})}),D)throw t;return await (0,h.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>y,"patchFetch",()=>b,"routeModule",()=>S,"serverHooks",()=>B,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>E]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=_ccfd38d6._.js.map