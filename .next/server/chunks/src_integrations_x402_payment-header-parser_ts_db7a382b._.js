module.exports=[71556,e=>{"use strict";var r=e.i(56036);function a(e){try{let r,a;if(!e||0===e.trim().length)return{valid:!1,error:"Payment header is empty"};if(e.includes("<your_payment_header>")||e.includes("<placeholder>"))return{valid:!1,error:"Payment header contains placeholder value. Please provide a real x402 payment header."};let t=e.startsWith("x402 ")?e.slice(5).trim():e.trim();if(0===t.length)return{valid:!1,error:"Payment header value is empty after removing prefix"};try{r=Buffer.from(t,"base64").toString("utf-8")}catch(e){return{valid:!1,error:`Invalid base64 encoding: ${e instanceof Error?e.message:"Failed to decode base64"}`}}try{a=JSON.parse(r)}catch(e){return{valid:!1,error:`Invalid JSON in payment header: ${e instanceof Error?e.message:"Failed to parse JSON"}. Decoded value: ${r.substring(0,100)}`}}if(!a.signature)return{valid:!1,error:"Missing signature in payment header"};if(!a.authorization)return{valid:!1,error:"Missing authorization in payment header"};let n=a.authorization;if(!n.from||!n.to||!n.value||!n.nonce)return{valid:!1,error:"Incomplete authorization fields"};return{valid:!0,parsed:{invoiceId:a.invoiceId||n.nonce,txHash:a.txHash,signature:a.signature,authorization:{from:n.from,to:n.to,value:n.value,validAfter:n.validAfter||Math.floor(Date.now()/1e3).toString(),validBefore:n.validBefore||(Math.floor(Date.now()/1e3)+300).toString(),nonce:n.nonce},network:a.network||"base"}}}catch(e){return{valid:!1,error:e instanceof Error?e.message:"Failed to parse payment header"}}}async function t(e){try{let t=a(e);if(!t.valid||!t.parsed)return{valid:!1,error:t.error||"Invalid payment header format"};let n=t.parsed,i={payment:e,paymentPayload:{x402Version:1,scheme:"x402",network:n.network||"base",payload:{signature:n.signature,authorization:n.authorization}}},o=(0,r.getCDPFacilitator)(),s=await o.verifyPayment(i);if(!s.valid||!s.success)return{valid:!1,error:s.error||"Payment verification failed"};return{valid:!0,payment:n,transactionHash:s.transactionHash}}catch(e){return{valid:!1,error:e instanceof Error?e.message:"Unknown error"}}}e.s(["parseAndVerifyPaymentHeader",()=>t,"parseX402Header",()=>a])}];

//# sourceMappingURL=src_integrations_x402_payment-header-parser_ts_db7a382b._.js.map