module.exports=[81176,e=>e.a(async(t,a)=>{try{var n=e.i(89171),r=e.i(50377),o=e.i(30344),i=e.i(41500),s=e.i(3004),l=t([i,s]);[i,s]=l.then?(await l)():l;let g=(0,r.createLogger)({component:"DebugSMFFacilitators"});function d(e){return e?e.volumeUsd3d>=1e4||e.txCount3d>=1e5?"high":e.volumeUsd3d>=1e3||e.txCount3d>=1e4?"medium":e.volumeUsd3d>0||e.txCount3d>0?"low":"none":"none"}function c(e){if(e)return{volumeUsd3d:e.volumeUsd3d,txCount3d:e.txCount3d,uniqueBuyers3d:e.uniqueBuyers3d,uniqueSellers3d:e.uniqueSellers3d,volumeChangeRate:e.volumeChangeRate,activityLevel:d(e),activityScore:Math.round(100*(0,s.computeActivityScore)(e)),fetchedAt:e.fetchedAt}}function u(e){let t={},a={cdp:"coinbase",payai:"payai",dexter:"dexter",x402rs:"x402rs"};return a[e]&&(t.x402scan=`https://www.x402scan.com/facilitator/${a[e]}`),t.scattering="https://scattering.io/x402",t}async function p(e){try{let t,{searchParams:a}=new URL(e.url),r=a.get("network")||null,l=a.get("timeframe")||"1d";if(!["1d","7d","30d"].includes(l))return n.NextResponse.json({ok:!1,error:`Invalid timeframe: ${l}. Must be 1d, 7d, or 30d.`},{status:400});if(r){if(t=(0,o.getFacilitatorsForNetwork)(r),0===t.length)return n.NextResponse.json({ok:!0,network:r,timeframe:l,usedFallback:!0,recommended:null,recommendationReason:`No facilitators support network: ${r}`,facilitators:[],dataFreshness:{x402scan:{ageHours:null,lastUpdated:null,isStale:!0},scattering:{ageHours:null,lastUpdated:null,isStale:!0},nexflow:{ageHours:null,lastUpdated:null,isStale:!0}},timestamp:new Date().toISOString()})}else t=(0,o.getAllFacilitators)();let p=t.map(e=>e.id),m=await (0,s.getScatteringMetricsForFacilitators)(p),v=await (0,i.getRecommendedFacilitator)(p,{network:r??void 0,timeframe:l,prioritize:"balanced"}),R=null,x=null,w=null,C=null,S=[];for(let e=0;e<v.ranking.rankings.length;e++){let a=v.ranking.rankings[e],n=t.find(e=>e.id===a.facilitatorId),r=m.get(a.facilitatorId)??null,o=null;try{o=await (0,i.getFacilitatorExplainer)(a.facilitatorId,{timeframe:l,wasSelected:a.facilitatorId===v.recommended})}catch(e){g.debug({error:e,facilitatorId:a.facilitatorId},"Failed to get explanation")}if(o?.metrics?.dataAgeHours!==void 0&&(null===R||o.metrics.dataAgeHours>R)&&(R=o.metrics.dataAgeHours,x=new Date(Date.now()-60*o.metrics.dataAgeHours*6e4).toISOString()),r?.fetchedAt){let e=function(e){if(!e)return null;let t=new Date(e).getTime(),a=Date.now();return Math.round((a-t)/36e5*10)/10}(r.fetchedAt);null!==e&&(null===w||e>w)&&(w=e,C=r.fetchedAt)}let s=o?.shortReason;if(r&&!o?.shortReason?.includes("success")){let e=d(r);s=`${a.facilitatorId}: ${e} activity, $${f(r.volumeUsd3d)} 3d vol, ${h(r.txCount3d)} txns`}let p={id:a.facilitatorId,name:n?.name??a.facilitatorId,baseUrl:n?.baseUrl??"unknown",networks:n?.networks??[],score:Math.round(10*a.score)/10,rank:e+1,selected:a.facilitatorId===v.recommended,x402scanScore:o?.score??a.score,confidence:a.confidence,shortReason:s,metrics:o?.metrics?{successRate:o.metrics.successRate,errorRate:o.metrics.errorRate,p95LatencyMs:o.metrics.p95LatencyMs,invocations:o.metrics.invocations,dataAgeHours:Math.round(10*o.metrics.dataAgeHours)/10}:void 0,scattering:c(r),nexflowTraffic:{last24hInvocations:0,last24hDogfoodInvocations:0,last24hExternalInvocations:0},reasons:a.reasons,externalLinks:u(a.facilitatorId)};S.push(p)}for(let e of t)if(!S.some(t=>t.id===e.id)){let t=m.get(e.id)??null,a=d(t),n="No x402scan data available";t&&(n=`${e.id}: ${a} activity, $${f(t.volumeUsd3d)} 3d vol, ${h(t.txCount3d)} txns`),S.push({id:e.id,name:e.name,baseUrl:e.baseUrl,networks:e.networks,score:0,rank:S.length+1,selected:!1,confidence:"none",shortReason:n,scattering:c(t),nexflowTraffic:{last24hInvocations:0,last24hDogfoodInvocations:0,last24hExternalInvocations:0},reasons:["no-x402scan-data"],externalLinks:u(e.id)})}let A={x402scan:{ageHours:R,lastUpdated:x,isStale:null===R||R>4},scattering:{ageHours:w,lastUpdated:C,isStale:null===w||w>24},nexflow:{ageHours:null,lastUpdated:null,isStale:!0}};g.info({network:r,timeframe:l,usedFallback:v.usedFallback,recommended:v.recommended,facilitatorCount:S.length,x402scanStale:A.x402scan.isStale,scatteringStale:A.scattering.isStale,topFacilitator:S[0]?{id:S[0].id,score:S[0].score,confidence:S[0].confidence}:null,msg:"SMF facilitator debug request"});let E={ok:!0,network:r,timeframe:l,usedFallback:v.usedFallback,recommended:v.recommended,recommendationReason:v.reason,facilitators:S,dataFreshness:A,timestamp:new Date().toISOString()};return n.NextResponse.json(E)}catch(t){let e=t instanceof Error?t.message:"Unknown error";return g.error({error:e,stack:t instanceof Error?t.stack:void 0,msg:"SMF facilitator debug route error"}),n.NextResponse.json({ok:!1,error:e},{status:500})}}function f(e){return e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toFixed(0)}function h(e){return e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(0)}K`:e.toString()}async function m(){return new n.NextResponse(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}e.s(["GET",()=>p,"OPTIONS",()=>m]),a()}catch(e){a(e)}},!1),47747,e=>e.a(async(t,a)=>{try{var n=e.i(47909),r=e.i(74017),o=e.i(96250),i=e.i(59756),s=e.i(61916),l=e.i(14444),d=e.i(37092),c=e.i(69741),u=e.i(16795),p=e.i(87718),f=e.i(95169),h=e.i(47587),m=e.i(66012),g=e.i(70101),v=e.i(26937),R=e.i(10372),x=e.i(93695);e.i(52474);var w=e.i(220),C=e.i(81176),S=t([C]);[C]=S.then?(await S)():S;let y=new n.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/debug/smf-facilitators/route",pathname:"/api/debug/smf-facilitators",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/debug/smf-facilitators/route.ts",nextConfigOutput:"standalone",userland:C}),{workAsyncStorage:b,workUnitAsyncStorage:k,serverHooks:I}=y;function A(){return(0,o.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:k})}async function E(e,t,a){y.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/debug/smf-facilitators/route";n=n.replace(/\/index$/,"")||"/";let o=await y.prepare(e,t,{srcPage:n,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:C,params:S,nextConfig:A,parsedUrl:E,isDraftMode:b,prerenderManifest:k,routerServerContext:I,isOnDemandRevalidate:U,revalidateOnlyGenerated:N,resolvedPathname:F,clientReferenceManifest:T,serverActionsManifest:H}=o,M=(0,c.normalizeAppPath)(n),O=!!(k.dynamicRoutes[M]||k.routes[F]),$=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,E,!1):t.end("This page could not be found"),null);if(O&&!b){let e=!!k.routes[F],t=k.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await $();throw new x.NoFallbackError}}let P=null;!O||y.isDev||b||(P=F,P="/index"===P?"/":P);let D=!0===y.isDev||!O,_=O&&!D;H&&T&&(0,l.setReferenceManifestsSingleton)({page:n,clientReferenceManifest:T,serverActionsManifest:H,serverModuleMap:(0,d.createServerModuleMap)({serverActionsManifest:H})});let q=e.method||"GET",L=(0,s.getTracer)(),j=L.getActiveScopeSpan(),K={params:S,prerenderManifest:k,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n)=>y.onRequestError(e,t,n,I)},sharedContext:{buildId:C}},B=new u.NodeNextRequest(e),G=new u.NodeNextResponse(t),V=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let o=async e=>y.handle(V,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=L.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==f.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${q} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${n}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var s,d;let c=async({previousCacheEntry:r})=>{try{if(!l&&U&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(i);e.fetchMetrics=K.renderOpts.fetchMetrics;let s=K.renderOpts.pendingWaitUntil;s&&a.waitUntil&&(a.waitUntil(s),s=void 0);let d=K.renderOpts.collectedTags;if(!O)return await (0,m.sendResponse)(B,G,n,K.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,r=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==r?void 0:r.isStale)&&await y.onRequestError(e,t,{routerKind:"App Router",routePath:n,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:U})},I),t}},u=await y.handleResponse({req:e,nextConfig:A,cacheKey:P,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:U,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:l});if(!O)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",U?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&O||p.delete(R.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,v.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(B,G,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};j?await d(j):await L.withPropagatedContext(e.headers,()=>L.trace(f.BaseServerSpan.handleRequest,{spanName:`${q} ${n}`,kind:s.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},d))}catch(t){if(t instanceof x.NoFallbackError||await y.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:U})}),O)throw t;return await (0,m.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>E,"patchFetch",()=>A,"routeModule",()=>y,"serverHooks",()=>I,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>k]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=_d5902e52._.js.map