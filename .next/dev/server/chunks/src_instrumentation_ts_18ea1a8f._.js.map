{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/meaux/CascadeProjects/my%20second%20project/CascadeProjects/windsurf-project/nexflow-deploy/src/instrumentation.ts"],"sourcesContent":["// =============================================================================\n// NEXT.JS INSTRUMENTATION\n// =============================================================================\n// This file runs once when the Next.js server starts\n// Used to:\n// 1. Validate environment configuration (fail fast in production)\n// 2. Initialize background jobs like facilitator probes\n\nexport async function register() {\n  if (process.env.NEXT_RUNTIME === 'nodejs') {\n    // Only run in Node.js runtime (not Edge)\n    \n    // 1. Run production environment validation\n    try {\n      const { runStartupValidation } = await import('@/lib/startup/validate-env');\n      runStartupValidation();\n    } catch (error) {\n      console.error('[FATAL] Startup validation failed:', error);\n      // In production, this prevents the app from starting with bad config\n      if (process.env.NODE_ENV === 'production') {\n        throw error;\n      }\n    }\n    \n    // 2. Determine if we should start probes\n    const env = process.env.NODE_ENV || 'development';\n    // Support both env var names for backwards compatibility\n    const enableProbes = process.env.FACILITATOR_PROBES_ENABLED === 'true' || \n                         process.env.ENABLE_FACILITATOR_PROBES === 'true';\n    const isProduction = env === 'production';\n    const isTest = env === 'test';\n    \n    // Probes only run in production when explicitly enabled\n    // Never run in local dev (next dev) or test environments\n    if (isTest) {\n      console.log('[SMF] Probes disabled: test environment');\n      return;\n    }\n    \n    if (!isProduction) {\n      console.log('[SMF] Probes disabled: not in production environment');\n      console.log(`[SMF] Current NODE_ENV: ${env}`);\n      console.log('[SMF] Probes will run in production when FACILITATOR_PROBES_ENABLED=true is set');\n      return;\n    }\n    \n    if (!enableProbes) {\n      console.log('[SMF] Probes disabled: FACILITATOR_PROBES_ENABLED not set to \"true\"');\n      console.log('[SMF] Set FACILITATOR_PROBES_ENABLED=true in Vercel environment variables to enable');\n      return;\n    }\n    \n    // Production + FACILITATOR_PROBES_ENABLED=true: Probes handled by Vercel Cron\n    // Tiered probe system:\n    // - Light probes: /api/cron/facilitator-probes (every 5 minutes)\n    // - Deep probes: /api/cron/facilitator-probes-deep (every 15 minutes)\n    console.log('[SMF] ========================================');\n    console.log('[SMF] Tiered Facilitator Probes (Vercel Cron)');\n    console.log(`[SMF] Environment: ${env}`);\n    console.log(`[SMF] FACILITATOR_PROBES_ENABLED: ${enableProbes}`);\n    console.log('[SMF] Light probes: /api/cron/facilitator-probes (*/5 * * * *)');\n    console.log('[SMF] Deep probes: /api/cron/facilitator-probes-deep (*/15 * * * *)');\n    console.log('[SMF] Check /api/v1/smf/probes/status for probe status');\n    console.log('[SMF] ========================================');\n  }\n}\n"],"names":[],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;AAC1B,gFAAgF;AAChF,qDAAqD;AACrD,WAAW;AACX,kEAAkE;AAClE,wDAAwD;;;;;AAEjD,eAAe;IACpB,wCAA2C;QACzC,yCAAyC;QAEzC,2CAA2C;QAC3C,IAAI;YACF,MAAM,EAAE,oBAAoB,EAAE,GAAG;YACjC;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sCAAsC;YACpD,qEAAqE;YACrE,IAAI,oDAAyB,cAAc;gBACzC,MAAM;YACR;QACF;QAEA,yCAAyC;QACzC,MAAM,MAAM,mDAAwB;QACpC,yDAAyD;QACzD,MAAM,eAAe,QAAQ,GAAG,CAAC,0BAA0B,KAAK,UAC3C,QAAQ,GAAG,CAAC,yBAAyB,KAAK;QAC/D,MAAM,eAAe,QAAQ;QAC7B,MAAM,SAAS,QAAQ;QAEvB,wDAAwD;QACxD,yDAAyD;QACzD;;QAKA,wCAAmB;YACjB,QAAQ,GAAG,CAAC;YACZ,QAAQ,GAAG,CAAC,CAAC,wBAAwB,EAAE,KAAK;YAC5C,QAAQ,GAAG,CAAC;YACZ;QACF;;;IAoBF;AACF"}}]
}