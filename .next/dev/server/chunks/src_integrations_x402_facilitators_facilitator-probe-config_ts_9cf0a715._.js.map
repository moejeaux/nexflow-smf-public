{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/meaux/CascadeProjects/my%20second%20project/CascadeProjects/windsurf-project/nexflow-deploy/src/integrations/x402/facilitators/facilitator-probe-config.ts"],"sourcesContent":["// =============================================================================\r\n// FACILITATOR PROBE CONFIGURATION\r\n// =============================================================================\r\n// Configuration for tiered facilitator health probes:\r\n// - Light probes (5 min): quick availability + basic latency\r\n// - Deep probes (15 min): richer metrics for SLOs and routing/bandit quality\r\n\r\n/**\r\n * Probe tier type\r\n * - light: Fast health check (ping/quote endpoint)\r\n * - deep: Performance check (approximates real routing flow)\r\n */\r\nexport type ProbeTier = 'light' | 'deep';\r\n\r\nexport interface FacilitatorProbeConfig {\r\n  id: string; // e.g. \"cdp-base-usdc-light\"\r\n  facilitatorId: string; // \"cdp\"\r\n  network: string; // e.g. \"eip155:8453\"\r\n  token: string; // e.g. \"USDC\"\r\n  tier: ProbeTier; // light or deep\r\n  desiredIntervalSeconds: number; // 300 for light, 900 for deep\r\n  enabled: boolean;\r\n}\r\n\r\n// =============================================================================\r\n// TIERED PROBE SCHEDULE\r\n// =============================================================================\r\n// Light probes: 5 minutes (300s) - availability + basic latency\r\n// Deep probes: 15 minutes (900s) - richer metrics for SLOs\r\nconst LIGHT_INTERVAL_SECONDS = parseInt(process.env.PROBE_LIGHT_INTERVAL_SECONDS || '300', 10); // 5 min\r\nconst DEEP_INTERVAL_SECONDS = parseInt(process.env.PROBE_DEEP_INTERVAL_SECONDS || '900', 10); // 15 min\r\n\r\n// =============================================================================\r\n// MASTER SWITCH AND HARD DISABLE\r\n// =============================================================================\r\n// HARD_DISABLE_PROBES = true means probes are OFF regardless of env vars\r\n// To re-enable: set HARD_DISABLE_PROBES = false AND set FACILITATOR_PROBES_ENABLED=true in env\r\nconst HARD_DISABLE_PROBES = false; // Re-enabled for tiered probe system\r\n\r\n// Master switch for all probes\r\nconst PROBES_MASTER_ENABLED = !HARD_DISABLE_PROBES && process.env.FACILITATOR_PROBES_ENABLED === 'true';\r\n\r\n// Per-tier enable flags (defaults to master switch)\r\nconst LIGHT_PROBES_ENABLED = PROBES_MASTER_ENABLED && process.env.LIGHT_PROBES_ENABLED !== 'false';\r\nconst DEEP_PROBES_ENABLED = PROBES_MASTER_ENABLED && process.env.DEEP_PROBES_ENABLED !== 'false';\r\n\r\n// =============================================================================\r\n// FACILITATOR PROBE CONFIGURATIONS\r\n// =============================================================================\r\n// Each facilitator gets both a light and deep probe configuration\r\n\r\nexport const FACILITATOR_PROBE_CONFIGS: FacilitatorProbeConfig[] = [\r\n  // ==========================================================================\r\n  // CDP Facilitator (Coinbase Developer Platform)\r\n  // Primary x402 facilitator for Base network\r\n  // ==========================================================================\r\n  {\r\n    id: 'cdp-base-usdc-light',\r\n    facilitatorId: 'cdp',\r\n    network: 'eip155:8453', // Base mainnet\r\n    token: 'USDC',\r\n    tier: 'light',\r\n    desiredIntervalSeconds: LIGHT_INTERVAL_SECONDS,\r\n    enabled: LIGHT_PROBES_ENABLED,\r\n  },\r\n  {\r\n    id: 'cdp-base-usdc-deep',\r\n    facilitatorId: 'cdp',\r\n    network: 'eip155:8453', // Base mainnet\r\n    token: 'USDC',\r\n    tier: 'deep',\r\n    desiredIntervalSeconds: DEEP_INTERVAL_SECONDS,\r\n    enabled: DEEP_PROBES_ENABLED,\r\n  },\r\n\r\n  // ==========================================================================\r\n  // PayAI Facilitator\r\n  // Multi-chain x402 facilitator\r\n  // ==========================================================================\r\n  {\r\n    id: 'payai-base-usdc-light',\r\n    facilitatorId: 'payai',\r\n    network: 'eip155:8453', // Base mainnet\r\n    token: 'USDC',\r\n    tier: 'light',\r\n    desiredIntervalSeconds: LIGHT_INTERVAL_SECONDS,\r\n    enabled: LIGHT_PROBES_ENABLED,\r\n  },\r\n  {\r\n    id: 'payai-base-usdc-deep',\r\n    facilitatorId: 'payai',\r\n    network: 'eip155:8453', // Base mainnet\r\n    token: 'USDC',\r\n    tier: 'deep',\r\n    desiredIntervalSeconds: DEEP_INTERVAL_SECONDS,\r\n    enabled: DEEP_PROBES_ENABLED,\r\n  },\r\n\r\n  // ==========================================================================\r\n  // X402rs Facilitator\r\n  // Rust-based community facilitator\r\n  // ==========================================================================\r\n  {\r\n    id: 'x402rs-base-usdc-light',\r\n    facilitatorId: 'x402rs',\r\n    network: 'eip155:8453', // Base mainnet\r\n    token: 'USDC',\r\n    tier: 'light',\r\n    desiredIntervalSeconds: LIGHT_INTERVAL_SECONDS,\r\n    enabled: LIGHT_PROBES_ENABLED && process.env.X402RS_ENABLED !== 'false',\r\n  },\r\n  {\r\n    id: 'x402rs-base-usdc-deep',\r\n    facilitatorId: 'x402rs',\r\n    network: 'eip155:8453', // Base mainnet\r\n    token: 'USDC',\r\n    tier: 'deep',\r\n    desiredIntervalSeconds: DEEP_INTERVAL_SECONDS,\r\n    enabled: DEEP_PROBES_ENABLED && process.env.X402RS_ENABLED !== 'false',\r\n  },\r\n  {\r\n    id: 'x402rs-xdc-usdc-light',\r\n    facilitatorId: 'x402rs',\r\n    network: 'xdc:50', // XDC mainnet\r\n    token: 'USDC',\r\n    tier: 'light',\r\n    desiredIntervalSeconds: LIGHT_INTERVAL_SECONDS,\r\n    enabled: LIGHT_PROBES_ENABLED && process.env.X402RS_XDC_PROBE_ENABLED === 'true',\r\n  },\r\n  {\r\n    id: 'x402rs-xdc-usdc-deep',\r\n    facilitatorId: 'x402rs',\r\n    network: 'xdc:50', // XDC mainnet\r\n    token: 'USDC',\r\n    tier: 'deep',\r\n    desiredIntervalSeconds: DEEP_INTERVAL_SECONDS,\r\n    enabled: DEEP_PROBES_ENABLED && process.env.X402RS_XDC_PROBE_ENABLED === 'true',\r\n  },\r\n\r\n  // ==========================================================================\r\n  // Dexter Facilitator\r\n  // Solana-native x402 facilitator\r\n  // ==========================================================================\r\n  {\r\n    id: 'dexter-solana-usdc-light',\r\n    facilitatorId: 'dexter',\r\n    network: 'solana:101', // Solana mainnet (CAIP-2)\r\n    token: 'USDC',\r\n    tier: 'light',\r\n    desiredIntervalSeconds: LIGHT_INTERVAL_SECONDS,\r\n    enabled: LIGHT_PROBES_ENABLED && process.env.DEXTER_ENABLED !== 'false',\r\n  },\r\n  {\r\n    id: 'dexter-solana-usdc-deep',\r\n    facilitatorId: 'dexter',\r\n    network: 'solana:101', // Solana mainnet (CAIP-2)\r\n    token: 'USDC',\r\n    tier: 'deep',\r\n    desiredIntervalSeconds: DEEP_INTERVAL_SECONDS,\r\n    enabled: DEEP_PROBES_ENABLED && process.env.DEXTER_ENABLED !== 'false',\r\n  },\r\n  {\r\n    id: 'dexter-solana-devnet-usdc-light',\r\n    facilitatorId: 'dexter',\r\n    network: 'solana:102', // Solana devnet\r\n    token: 'USDC',\r\n    tier: 'light',\r\n    desiredIntervalSeconds: LIGHT_INTERVAL_SECONDS,\r\n    enabled: LIGHT_PROBES_ENABLED && process.env.DEXTER_DEVNET_PROBE_ENABLED === 'true',\r\n  },\r\n  {\r\n    id: 'dexter-solana-devnet-usdc-deep',\r\n    facilitatorId: 'dexter',\r\n    network: 'solana:102', // Solana devnet\r\n    token: 'USDC',\r\n    tier: 'deep',\r\n    desiredIntervalSeconds: DEEP_INTERVAL_SECONDS,\r\n    enabled: DEEP_PROBES_ENABLED && process.env.DEXTER_DEVNET_PROBE_ENABLED === 'true',\r\n  },\r\n\r\n  // ==========================================================================\r\n  // Cronos x402 Facilitator\r\n  // Official Cronos Labs facilitator\r\n  // Rate limits: 5 requests per minute per IP for settle/verify\r\n  // ==========================================================================\r\n  {\r\n    id: 'cronos-mainnet-usdc-light',\r\n    facilitatorId: 'cronos',\r\n    network: 'eip155:25', // Cronos mainnet\r\n    token: 'USDC',\r\n    tier: 'light',\r\n    desiredIntervalSeconds: LIGHT_INTERVAL_SECONDS,\r\n    enabled: LIGHT_PROBES_ENABLED && process.env.CRONOS_ENABLED !== 'false',\r\n  },\r\n  {\r\n    id: 'cronos-mainnet-usdc-deep',\r\n    facilitatorId: 'cronos',\r\n    network: 'eip155:25', // Cronos mainnet\r\n    token: 'USDC',\r\n    tier: 'deep',\r\n    desiredIntervalSeconds: DEEP_INTERVAL_SECONDS,\r\n    enabled: DEEP_PROBES_ENABLED && process.env.CRONOS_ENABLED !== 'false',\r\n  },\r\n  {\r\n    id: 'cronos-testnet-usdc-light',\r\n    facilitatorId: 'cronos',\r\n    network: 'eip155:338', // Cronos testnet\r\n    token: 'USDC',\r\n    tier: 'light',\r\n    desiredIntervalSeconds: LIGHT_INTERVAL_SECONDS,\r\n    enabled: LIGHT_PROBES_ENABLED && process.env.CRONOS_TESTNET_PROBE_ENABLED === 'true',\r\n  },\r\n  {\r\n    id: 'cronos-testnet-usdc-deep',\r\n    facilitatorId: 'cronos',\r\n    network: 'eip155:338', // Cronos testnet\r\n    token: 'USDC',\r\n    tier: 'deep',\r\n    desiredIntervalSeconds: DEEP_INTERVAL_SECONDS,\r\n    enabled: DEEP_PROBES_ENABLED && process.env.CRONOS_TESTNET_PROBE_ENABLED === 'true',\r\n  },\r\n];\r\n\r\n// =============================================================================\r\n// HELPER FUNCTIONS\r\n// =============================================================================\r\n\r\n/**\r\n * Get all enabled probe configurations\r\n */\r\nexport function getEnabledProbeConfigs(): FacilitatorProbeConfig[] {\r\n  return FACILITATOR_PROBE_CONFIGS.filter((c) => c.enabled);\r\n}\r\n\r\n/**\r\n * Get enabled probe configurations by tier\r\n */\r\nexport function getEnabledProbeConfigsByTier(tier: ProbeTier): FacilitatorProbeConfig[] {\r\n  return FACILITATOR_PROBE_CONFIGS.filter((c) => c.enabled && c.tier === tier);\r\n}\r\n\r\n/**\r\n * Get probe config by ID\r\n */\r\nexport function getProbeConfigById(id: string): FacilitatorProbeConfig | undefined {\r\n  return FACILITATOR_PROBE_CONFIGS.find((c) => c.id === id);\r\n}\r\n\r\n/**\r\n * Get all probe configs for a specific facilitator\r\n */\r\nexport function getProbeConfigsForFacilitator(facilitatorId: string): FacilitatorProbeConfig[] {\r\n  return FACILITATOR_PROBE_CONFIGS.filter((c) => c.facilitatorId === facilitatorId);\r\n}\r\n\r\n/**\r\n * Get the probe interval in seconds for a tier\r\n */\r\nexport function getProbeIntervalForTier(tier: ProbeTier): number {\r\n  return tier === 'light' ? LIGHT_INTERVAL_SECONDS : DEEP_INTERVAL_SECONDS;\r\n}\r\n\r\n/**\r\n * Get probe schedule summary for logging/display\r\n */\r\nexport function getProbeScheduleSummary(): {\r\n  lightInterval: number;\r\n  deepInterval: number;\r\n  enabledLight: number;\r\n  enabledDeep: number;\r\n  totalEnabled: number;\r\n} {\r\n  const enabledLight = getEnabledProbeConfigsByTier('light').length;\r\n  const enabledDeep = getEnabledProbeConfigsByTier('deep').length;\r\n  return {\r\n    lightInterval: LIGHT_INTERVAL_SECONDS,\r\n    deepInterval: DEEP_INTERVAL_SECONDS,\r\n    enabledLight,\r\n    enabledDeep,\r\n    totalEnabled: enabledLight + enabledDeep,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}}]
}