{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/meaux/CascadeProjects/my%20second%20project/CascadeProjects/windsurf-project/nexflow-deploy/src/lib/sentry.ts"],"sourcesContent":["// =============================================================================\r\n// Sentry Error Tracking\r\n// =============================================================================\r\n// Initializes Sentry for error tracking and monitoring\r\n// Only initializes if SENTRY_DSN is set\r\n\r\nlet Sentry: any = null;\r\ntry {\r\n  Sentry = require('@sentry/nextjs');\r\n} catch (e) {\r\n  // Sentry not installed, will use no-op functions\r\n}\r\n\r\nlet initialized = false;\r\n\r\n/**\r\n * Initialize Sentry if DSN is configured\r\n */\r\nexport function initSentry() {\r\n  if (initialized) {\r\n    return;\r\n  }\r\n\r\n  if (!Sentry) {\r\n    // Sentry not installed, skip initialization\r\n    return;\r\n  }\r\n\r\n  const dsn = process.env.SENTRY_DSN;\r\n  if (!dsn) {\r\n    console.log('[sentry] SENTRY_DSN not set, skipping Sentry initialization');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    Sentry.init({\r\n      dsn,\r\n      environment: process.env.NODE_ENV || 'development',\r\n      tracesSampleRate: process.env.NODE_ENV === 'production' ? 0.1 : 1.0, // 10% in prod, 100% in dev\r\n      debug: process.env.NODE_ENV === 'development',\r\n      \r\n      // Filter out sensitive data\r\n      beforeSend(event, hint) {\r\n        // Remove sensitive headers\r\n        if (event.request?.headers) {\r\n          const sensitiveHeaders = ['authorization', 'x-api-key', 'x-payment', 'cookie'];\r\n          sensitiveHeaders.forEach(header => {\r\n            if (header in event.request.headers) {\r\n              delete event.request.headers[header];\r\n            }\r\n          });\r\n        }\r\n        \r\n        // Remove sensitive data from request body\r\n        if (event.request?.data) {\r\n          const sensitiveFields = ['apiKey', 'token', 'paymentHeader', 'x-payment', 'cardNumber', 'cvv'];\r\n          sensitiveFields.forEach(field => {\r\n            if (field in event.request.data) {\r\n              delete event.request.data[field];\r\n            }\r\n          });\r\n        }\r\n        \r\n        return event;\r\n      },\r\n      \r\n      // Ignore certain errors\r\n      ignoreErrors: [\r\n        // Browser extensions\r\n        'ResizeObserver loop limit exceeded',\r\n        'Non-Error promise rejection captured',\r\n        // Network errors that are expected\r\n        'NetworkError',\r\n        'Failed to fetch',\r\n      ],\r\n    });\r\n    \r\n    initialized = true;\r\n    console.log('[sentry] Sentry initialized successfully');\r\n  } catch (error) {\r\n    console.error('[sentry] Failed to initialize Sentry:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Set user context for Sentry\r\n */\r\nexport function setSentryUser(userId?: string, apiKeyId?: string) {\r\n  if (!initialized || !Sentry) return;\r\n  \r\n  Sentry.setUser({\r\n    id: userId || apiKeyId,\r\n    apiKeyId,\r\n  });\r\n}\r\n\r\n/**\r\n * Set request context for Sentry\r\n */\r\nexport function setSentryContext(context: {\r\n  requestId?: string;\r\n  apiKeyId?: string;\r\n  endpoint?: string;\r\n  endpointId?: string;\r\n  method?: string;\r\n  statusCode?: number;\r\n  ip?: string;\r\n  userAgent?: string;\r\n  extra?: Record<string, any>;\r\n}) {\r\n  if (!initialized || !Sentry) return;\r\n  \r\n  Sentry.setContext('request', {\r\n    requestId: context.requestId,\r\n    apiKeyId: context.apiKeyId,\r\n    endpoint: context.endpoint,\r\n    endpointId: context.endpointId,\r\n    method: context.method,\r\n    statusCode: context.statusCode,\r\n    ip: context.ip,\r\n    userAgent: context.userAgent,\r\n    ...(context.extra || {}),\r\n  });\r\n}\r\n\r\n/**\r\n * Capture exception with context\r\n */\r\nexport function captureException(error: Error, context?: {\r\n  requestId?: string;\r\n  apiKeyId?: string;\r\n  endpoint?: string;\r\n  endpointId?: string;\r\n  method?: string;\r\n  statusCode?: number;\r\n  ip?: string;\r\n  userAgent?: string;\r\n  tags?: Record<string, string>;\r\n  extra?: Record<string, any>;\r\n}) {\r\n  if (!initialized || !Sentry) return;\r\n  \r\n  if (context) {\r\n    setSentryContext({\r\n      requestId: context.requestId,\r\n      apiKeyId: context.apiKeyId,\r\n      endpoint: context.endpoint,\r\n      method: context.method,\r\n      statusCode: context.statusCode,\r\n    });\r\n    \r\n    if (context.tags) {\r\n      Sentry.setTags(context.tags);\r\n    }\r\n    \r\n    // Add extra context\r\n    if (context.extra || context.endpointId || context.ip || context.userAgent) {\r\n      Sentry.setContext('request_details', {\r\n        endpointId: context.endpointId,\r\n        ip: context.ip,\r\n        userAgent: context.userAgent,\r\n        ...(context.extra || {}),\r\n      });\r\n    }\r\n  }\r\n  \r\n  Sentry.captureException(error);\r\n}\r\n\r\n/**\r\n * Capture message with context\r\n */\r\nexport function captureMessage(message: string, level: any = 'info', context?: {\r\n  requestId?: string;\r\n  apiKeyId?: string;\r\n  endpoint?: string;\r\n  endpointId?: string;\r\n  method?: string;\r\n  statusCode?: number;\r\n  tags?: Record<string, string>;\r\n  extra?: Record<string, any>;\r\n}) {\r\n  if (!initialized || !Sentry) return;\r\n  \r\n  if (context) {\r\n    setSentryContext({\r\n      requestId: context.requestId,\r\n      apiKeyId: context.apiKeyId,\r\n      endpoint: context.endpoint,\r\n      method: context.method,\r\n      statusCode: context.statusCode,\r\n    });\r\n    \r\n    if (context.tags) {\r\n      Sentry.setTags(context.tags);\r\n    }\r\n    \r\n    // Add extra context\r\n    if (context.extra || context.endpointId) {\r\n      Sentry.setContext('request_details', {\r\n        endpointId: context.endpointId,\r\n        ...(context.extra || {}),\r\n      });\r\n    }\r\n  }\r\n  \r\n  Sentry.captureMessage(message, level);\r\n}\r\n\r\n// Auto-initialize on import (for Next.js API routes)\r\nif (typeof window === 'undefined') {\r\n  initSentry();\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}